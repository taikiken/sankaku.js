/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/06/20 - 11:55

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 delaunay
 original: https://github.com/ironwallaby/delaunay

 canvas-toBlob.js
 A canvas.toBlob() implementation.
 2011-07-13

 By Eli Grey, http://eligrey.com and Devin Samarin, https://github.com/eboyjr
 License: X11/MIT
   See LICENSE.md
 @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js

 FileSaver.js
 A saveAs() FileSaver implementation.
 2014-05-27

 By Eli Grey, http://eligrey.com
 License: X11/MIT
   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js

 hosted on
 https://github.com/taikiken/sankaku.js
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/07/20 - 20:31

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.
*/
var Sankaku={version:"0.2.8"};
(function(k){k.console||(k.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}});Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var c=0,h=["ms","moz","webkit","o"],g=0;g<h.length&&!k.requestAnimationFrame;++g)k.requestAnimationFrame=k[h[g]+"RequestAnimationFrame"],k.cancelAnimationFrame=k[h[g]+"CancelAnimationFrame"]||k[h[g]+"CancelRequestAnimationFrame"];void 0===k.requestAnimationFrame&&void 0!==k.setTimeout&&
(k.requestAnimationFrame=function(f){var b=Date.now(),d=Math.max(0,16-(b-c)),a=k.setTimeout(function(){f(b+d)},d);c=b+d;return a});void 0===k.cancelAnimationFrame&&void 0!==k.clearTimeout&&(k.cancelAnimationFrame=function(f){k.clearTimeout(f)});Object.create||(Object.create=function(){function f(){}return function(b){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");f.prototype=b;return new f}}());Array.isArray||(Array.isArray=function(f){return"[object Array]"===
Object.prototype.toString.call(f)});Array.prototype.indexOf||(Array.prototype.indexOf=function(f,b){var d;d=b?b:0;var a;if(!this)throw new TypeError;a=this.length;if(0===a||d>=a)return-1;for(0>d&&(d=a-Math.abs(d));d<a;d++)if(this[d]===f)return d;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(f,b){var d,a;d=0;for(a=this.length;d<a;++d)d in this&&f.call(b,this[d],d,this)});Function.prototype.bind||(Function.prototype.bind=function(f){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var b=Array.prototype.slice.call(arguments,1),d=this,a=function(){},e=function(){return d.apply(this instanceof a&&f?this:f,b.concat(Array.prototype.slice.call(arguments)))};a.prototype=this.prototype;e.prototype=new a;return e});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL})()})(window.self);(function(k){k.Sankaku.extend=function(c,h){h.prototype=Object.create(c.prototype);h.prototype.constructor=h}})(window);
(function(k){var c=k.Uint8Array;k=k.HTMLCanvasElement;var h=/\s*;\s*base64\s*(?:;|$)/i,g;c&&(g=new c([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]));k&&!k.prototype.toBlob&&(k.prototype.toBlob=function(f,b){b||(b="image/png");if(this.mozGetAsFile)f(this.mozGetAsFile("canvas",b));else{var d=Array.prototype.slice.call(arguments,
1),a=this.toDataURL.apply(this,d),e=a.indexOf(","),d=a.substring(e+1),a=h.test(a.substring(0,e)),m;if(Blob.fake)m=new Blob,m.encoding=a?"base64":"URI",m.data=d,m.size=d.length;else if(c)if(a){m=Blob;for(var a=d.length,e=new c(a/4*3|0),p=0,s=0,l=[0,0],v=0,k=0,r,q;a--;)q=d.charCodeAt(p++),r=g[q-43],255!==r&&void 0!==r&&(l[1]=l[0],l[0]=q,k=k<<6|r,v++,4===v&&(e[s++]=k>>>16,61!==l[1]&&(e[s++]=k>>>8),61!==l[0]&&(e[s++]=k),v=0));m=new m([new c(e.buffer)],{type:b})}else m=new Blob([new c(decodeURIComponent(d))],
{type:b});f(m)}})})(self);
(function(k){k.EventDispatcher=function(){function c(){}var h=c.prototype;h.constructor=k.EventDispatcher;h.addEventListener=function(g,f){"undefined"===typeof this._listeners&&(this._listeners={});var b=this._listeners;"undefined"===typeof b[g]&&(b[g]=[]);-1===b[g].indexOf(f)&&b[g].push(f)};h.hasEventListener=function(g,f){var b=this._listeners;return"undefined"!==typeof b&&"undefined"!==typeof f[g]&&-1!==b[g].indexOf(f)?!0:!1};h.removeEventListener=function(g,f){if("undefined"!==typeof this._listeners){var b=
this._listeners[g],d;"undefined"!==typeof b&&(d=b.indexOf(f),-1!==d&&b.splice(d,1))}};h.dispatchEvent=function(g){var f=this._listeners,b,d;if("undefined"!==typeof f&&"undefined"!==typeof g.type&&(f=f[g.type],"undefined"!==typeof f))for(g.target=this,b=0,d=f.length;b<d;b++)f[b].call(this,g)};c.initialize=function(g){g.addEventListener=h.addEventListener;g.hasEventListener=h.hasEventListener;g.removeEventListener=h.removeEventListener;g.dispatchEvent=h.dispatchEvent};return c}()})(window.Sankaku);
(function(k){var c=k.Sankaku;c.LoadImage=function(){function h(f){this._path=f}h.COMPLETE="load_image_complete";h.ERROR="load_image_error";var g=h.prototype;g.constructor=c.LoadImage;c.EventDispatcher.initialize(g);g.load=function(){function f(){e.removeEventListener("load",b);e.removeEventListener("error",d);return!0}function b(){f();m.dispatchEvent({type:h.COMPLETE,currentTarget:m,path:a,img:e})}function d(){f();m.dispatchEvent({type:h.ERROR,currentTarget:m,path:a})}var a=this._path,e=new Image,
m=this;e.addEventListener("load",b,!1);e.addEventListener("error",d,!1);e.src=a};return h}()})(window);
(function(k){function c(){}var h=k.Sankaku,g=g||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(f){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=f.document,d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),a=!f.externalHost&&"download"in d,e=function(a){var e=b.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,f,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(e)},m=f.webkitRequestFileSystem,
p=f.requestFileSystem||m||f.mozRequestFileSystem,g=function(a){(f.setImmediate||f.setTimeout)(function(){throw a;},0)},h=0,v=[],c=function(){for(var a=v.length;a--;){var e=v[a];"string"===typeof e?(f.URL||f.webkitURL||f).revokeObjectURL(e):e.remove()}v.length=0},r=function(a,e,d){e=[].concat(e);for(var m=e.length;m--;){var b=a["on"+e[m]];if("function"===typeof b)try{b.call(a,d||a)}catch(f){g(f)}}},q=function(b,g){var c=this,s=b.type,u=!1,n,q,t=function(){var a=(f.URL||f.webkitURL||f).createObjectURL(b);
v.push(a);return a},A=function(){r(c,["writestart","progress","write","writeend"])},y=function(){if(u||!n)n=t(b);q?q.location.href=n:k.open(n,"_blank");c.readyState=c.DONE;A()},z=function(a){return function(){if(c.readyState!==c.DONE)return a.apply(this,arguments)}},B={create:!0,exclusive:!1},C;c.readyState=c.INIT;g||(g="download");if(a)n=t(b),d.href=n,d.download=g,e(d),c.readyState=c.DONE,A();else{f.chrome&&s&&"application/octet-stream"!==s&&(C=b.slice||b.webkitSlice,b=C.call(b,0,b.size,"application/octet-stream"),
u=!0);m&&"download"!==g&&(g+=".download");if("application/octet-stream"===s||m)q=f;p?(h+=b.size,p(f.TEMPORARY,h,z(function(a){a.root.getDirectory("saved",B,z(function(a){var e=function(){a.getFile(g,B,z(function(a){a.createWriter(z(function(e){e.onwriteend=function(e){q.location.href=a.toURL();v.push(a);c.readyState=c.DONE;r(c,"writeend",e)};e.onerror=function(){var a=e.error;a.code!==a.ABORT_ERR&&y()};["writestart","progress","write","abort"].forEach(function(a){e["on"+a]=c["on"+a]});e.write(b);
c.abort=function(){e.abort();c.readyState=c.DONE};c.readyState=c.WRITING}),y)}),y)};a.getFile(g,{create:!1},z(function(a){a.remove();e()}),z(function(a){a.code===a.NOT_FOUND_ERR?e():y()}))}),y)}),y)):y()}},n=q.prototype,t=function(a,e){return new q(a,e)};n.abort=function(){this.readyState=this.DONE;r(this,"abort")};n.readyState=n.INIT=0;n.WRITING=1;n.DONE=2;n.error=n.onwritestart=n.onprogress=n.onwrite=n.onabort=n.onerror=n.onwriteend=null;f.addEventListener("unload",c,!1);t.unload=function(){c();
f.removeEventListener("unload",c,!1)};return t}}("undefined"!==typeof self&&self||"undefined"!==typeof k&&k||this.content);c.prototype.constructor=h.FileSave;c.saveAs=g;h.FileSave=c})(window);
(function(k){k.Sankaku.Iro=function(){function c(){throw Error("Iro can't create instance");}c.rgb2hsl=function(c,g,f){c/=255;g/=255;f/=255;var b=Math.max(c,g,f),d=Math.min(c,g,f),a,e,m;e=(b+d)/2;if(b===d)a=d=0;else{m=b-d;d=0.5<e?m/(2-b-d):m/(b+d);switch(b){case c:a=(g-f)/m+(g<f?6:0);break;case g:a=(f-c)/m+2;break;case f:a=(c-g)/m+4}a/=6}return{h:a,s:d,l:e}};c.hsl2rgb=function(c,g,f){function b(a,d,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(d-a)*b:0.5>b?d:b<2/3?a+(d-a)*(2/3-b)*6:a}if(0===g)f=g=
c=f;else{var d=0.5>f?f*(1+g):f+g-f*g,a=2*f-d;f=b(a,d,c+1/3);g=b(a,d,c);c=b(a,d,c-1/3)}return{r:255*f,g:255*g,b:255*c}};c.rgb2hsv=function(c,g,f){c/=255;g/=255;f/=255;var b=Math.max(c,g,f),d=Math.min(c,g,f),a,e=b-d;if(b===d)a=0;else{switch(b){case c:a=(g-f)/e+(g<f?6:0);break;case g:a=(f-c)/e+2;break;case f:a=(c-g)/e+4}a/=6}return{h:a,s:0===b?0:e/b,v:b}};c.hsv2rgb=function(c,g,f){var b,d,a,e=Math.floor(6*c),m=6*c-e;c=f*(1-g);var p=f*(1-m*g);g=f*(1-(1-m)*g);switch(e%6){case 0:b=f;d=g;a=c;break;case 1:b=
p;d=f;a=c;break;case 2:b=c;d=f;a=g;break;case 3:b=c;d=p;a=f;break;case 4:b=g;d=c;a=f;break;case 5:b=f,d=c,a=p}return{r:255*b,g:255*d,b:255*a}};c.hex2rgb=function(c){if("string"!==typeof c)return null;c=c.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(c,f,b,d){return f+f+b+b+d+d});return(c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c))?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null};c.rgb2hex=function(c,g,f){function b(d){d=d.toString(16);return 1===d.length?"0"+d:d}
return"#"+b(c)+b(g)+b(f)};c.int2hex=function(c){c=Math.floor(c);c=c.toString(16);if(6>c.length)for(var g=6-c.length;g;)c="0"+c,--g;return"#"+c};return c}()})(window);
(function(k){k.Sankaku.List=function(){function c(){throw Error("List can't create instance");}var h=Math.random,g=Math.floor,f=Math.max;c.word=function(b,d){var a=[],e;for(e=0;e<b;e++)a[e]=d;return a};c.zero=function(b){return this.word(b,0)};c.shuffle=function(b){for(var d=[],a=b.length,e;a;)e=g(h()*b.length),e in b&&(d.push(b[e]),delete b[e],--a);return d};c.max=function(b){return f.apply(null,b)};return c}()})(window);
(function(k){k.Sankaku.Num=function(){function c(){throw Error("Num can't create instance");}var h=k.parseFloat,g=Math.random,f=Math.floor,b=Math.PI;c.ONE_DEG=b/180;c.FORTY_FIVE=b/4;c.NINETY=b/2;c.ONE_EIGHTY=b;c.THREE_SIXTY=2*b;c.is=function(d){return!isNaN(h(d))&&isFinite(d)};c.random=function(d,a){c.is(a)||(a=d,d=0);return d+f(g()*(a-d+1))};c.deg2rad=function(d){return d*c.ONE_DEG};return c}()})(window);
(function(k){k.Sankaku.Distribute=function(){function c(){throw Error("Distribute can't create instance");}var h=Math.sqrt,g=Math.sin,f=Math.cos,b=Math.random,d=2*Math.PI;c.circle=function(a,e,m){var c;a*=h(b());c=b()*d;return{x:0.5*e+f(c)*a,y:0.5*m+g(c)*a}};return c}()})(window);
(function(k){var c=k.Sankaku;c.Vector2D=function(){function h(a,e){this.x=a||0;this.y=e||0}var g=Math.floor,f=Math.ceil,b=Math.round,d=Math.cos,a=Math.sin,e=Math.atan2,m=Math.sqrt,p=Math.min,s=Math.acos,l=h.prototype;l.constructor=c.Vector2D;l.draw=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.x,this.y);a.closePath();return this};l.clone=function(){return new h(this.x,this.y)};l.zero=function(){this.y=this.x=0;return this};l.isZero=function(){return 0===this.x&&0===this.y};l.set=function(a,
e){this.x=a;this.y=e;return this};l.setX=function(a){this.x=a;return this};l.setY=function(a){this.y=a;return this};l.copy=function(a){this.x=a.x;this.y=a.y;return this};l.add=function(a){this.x+=a.x;this.y+=a.y;return this};l.addScalar=function(a){this.x+=a;this.y+=a;return this};l.addNew=function(a){return new h(this.x+a.x,this.y+a.y)};l.addVector=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;return this};l.sub=function(a){this.x-=a.x;this.y-=a.y;return this};l.subNew=function(a){return new h(this.x-
a.x,this.y-a.y)};l.subVector=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;return this};l.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};l.multiplyScalar=function(a){this.x*=a;this.y*=a;return this};l.multiplyNew=function(a){return new h(this.x*a.x,this.y*a.y)};l.divide=function(a){this.x/=a.x;this.y/=a.y;return this};l.divideScalar=function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this};l.divideNew=function(a){return new h(this.x/a.x,this.y/a.y)};l.min=function(a){this.x>
a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this};l.max=function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this};l.clamp=function(a,e){this.min(a);this.max(e);return this};l.clampScalar=function(a,e){var d,b;d=new h;b=new h;d.set(a,a);b.set(e,e);return this.clamp(d,b)};l.floor=function(){this.x=g(this.x);this.y=g(this.y);return this};l.ceil=function(){this.x=f(this.x);this.y=f(this.y);return this};l.round=function(){this.x=b(this.x);this.y=b(this.y);return this};l.roundToZero=
function(){this.x=0>this.x?f(this.x):g(this.x);this.y=0>this.y?f(this.y):g(this.y);return this};l.negate=function(){return this.multiplyScalar(-1)};l.dot=function(a){return this.x*a.x+this.y*a.y};l.lengthSq=function(){return this.x*this.x+this.y*this.y};l.length=function(){return m(this.lengthSq())};l.setLength=function(a){var e=this.length();0!==e&&a!==e&&this.multiplyScalar(a/e);return this};l.setAngle=function(e){var b=this.length(),b=b||0.001;this.x=d(e)*b;this.y=a(e)*b;return this};l.angle=function(){return e(this.y,
this.x)};l.normalize=function(){return this.divideScalar(this.length())};l.distanceSq=function(a){var e=this.x-a.x;a=this.y-a.y;return e*e+a*a};l.distance=function(a){return m(this.distanceSq(a))};l.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;return this};l.equals=function(a){return a.x===this.x&&a.y===this.y};l.fromArray=function(a){this.x=a[0];this.y=a[1];return this};l.toArray=function(){return[this.x,this.y]};l.truncate=function(a){a=p(a,this.length());return this.setLength(a)};
l.reverse=function(){this.negate();return this};l.isNormalize=function(){return 1===this.length()};l.perpendicular=function(){return new h(-this.y,this.x)};l.sign=function(a){return 0>this.perpendicular().dot(a)?-1:1};h.angleBetween=function(a,e){a.isNormalize()||(a=a.clone().normalize());e.isNormalize()||(e=e.clone().normalize());return s(a.dot(e))};return h}()})(window);
(function(k){var c=Math.abs,h=Math.min,g=Math.max,f=Math.round,b=k.Sankaku;b.Triangle=function(){function d(a,d,b){this.a=a;this.b=d;this.c=b;var f=d.x-a.x,l=d.y-a.y,k=b.x-a.x,u=b.y-a.y,r=f*(a.x+d.x)+l*(a.y+d.y),q=k*(a.x+b.x)+u*(a.y+b.y),n=2*(f*(b.y-d.y)-l*(b.x-d.x));1E-6>c(n)?(k=h(a.x,d.x,b.x),r=h(a.y,d.y,b.y),f=0.5*(g(a.x,d.x,b.x)-k),a=0.5*(g(a.y,d.y,b.y)-r),this.x=k+f,this.y=r+a):(d=(u*r-l*q)/n,b=(f*q-k*r)/n,f=d-a.x,a=b-a.y,this.x=d,this.y=b);this.r=f*f+a*a}var a=d.prototype;a.constructor=b.Triangle;
a.draw=function(a){var d=this.a,b=this.b,c=this.c;a.beginPath();a.moveTo(d.x,d.y);a.lineTo(b.x,b.y);a.lineTo(c.x,c.y);a.closePath()};a.centroid=function(){return{x:f((this.a.x+this.b.x+this.c.x)/3),y:f((this.a.y+this.b.y+this.c.y)/3)}};return d}()})(window);
(function(k){k=k.Sankaku;var c=k.Triangle;k.Delaunay=function(){function h(){throw Error("Sankaku can't create instance.");}h.triangulate=function(g){if(3>g.length)return[];var f,b,d,a,e,m,p,s,l,h=function(a){var e=a.length,d,b,m,c,f;a:for(;e;)for(b=a[--e],d=a[--e],m=e;m;)if(f=a[--m],c=a[--m],d===c&&b===f||d===f&&b===c){a.splice(e,2);a.splice(m,2);e-=2;continue a}};g.sort(function(a,e){return e.x-a.x});b=g.length-1;f=g[b];d=f.x;a=g[0].x;for(m=e=f.y;b--;)f.y<e&&(e=f.y),f.y>m&&(m=f.y);p=a-d;s=m-e;b=
p>s?p:s;f=0.5*(a+d);p=0.5*(m+e);m=[new c({x:f-20*b,y:p-b,__sentinel:!0},{x:f,y:p+20*b,__sentinel:!0},{x:f+20*b,y:p-b,__sentinel:!0})];e=[];d=[];for(b=g.length;b--;){d.length=0;a=m.length;for(f=g[b];a--;)l=m[a],p=f.x-l.x,0<p&&p*p>l.r?(e.push(l),m.splice(a,1)):(s=f.y-l.y,p*p+s*s>l.r||(d.push(l.a,l.b,l.b,l.c,l.c,l.a),m.splice(a,1)));h(d);for(a=d.length;a;)s=d[--a],p=d[--a],m.push(new c(p,s,f))}Array.prototype.push.apply(e,m);for(b=e.length;b--;)g=e[b],(g.a.__sentinel||g.b.__sentinel||g.c.__sentinel)&&
e.splice(b,1);return e};return h}()})(window);
(function(k){var c=k.Sankaku,h=c.Vector2D,g=c.Num,f=c.Iro;c.Object2D=function(){function b(){this._position=new h;this.rotation=this.y=this.x=0;this.width=20;this.height=10;this.scale=1;this.parent=this.scene=null;this.children=[];this.visible=!0;this._alpha=1}var d=Math.cos,a=Math.sin,e=b.prototype;e.constructor=c.Object2D;c.EventDispatcher.initialize(e);e.clone=function(){return this._clone()};e._clone=function(){var a=new b;a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;
a.rotation=this.rotation;a.scale=this.scale;a.parent=parent&&parent.clone();a._alpha=this._alpha;a.visible=this.visible;a.children=this.children.splice();a.setColor(this._color);return a};e.setColor=function(a){this._color=a;this._rgb=f.hex2rgb(a);this._rgb.a=this._alpha;return this};e.rgba=function(){return this._rgb};e.setAlpha=function(a){this._alpha=a;return this.setColor(this._color)};e.alpha=function(){return this._alpha};e.setPosition=function(a){this._position=a;this.x=a.x;this.y=a.y;return this};
e.position=function(){return this._position};e.setX=function(a){this.x=a;this._position.x=a;return this};e.setY=function(a){this.y=a;this._position.y=a;return this};e.bounding=function(){var e=this.parent,b=this.x,c=this.y,f=this.width*this.scale,g=this.height*this.scale,f=0.5*f,g=0.5*g,h=this.rotation,k,q,n,t,w,x;q={scale:this.scale,rotation:this.rotation,alpha:this._alpha,x:this.x,y:this.y};e&&this.scene!==e&&(b*=e.scale,c*=e.scale,f=this.width*e.scale,g=this.height*e.scale,f*=0.5,g*=0.5,h=e.rotation+
this.rotation,k=e.x+b*d(e.rotation)-c*a(e.rotation),c=e.y+b*a(e.rotation)+c*d(e.rotation),b=k,q.scale=e.scale*this.scale,q.alpha=e.alpha()*this._alpha,q.rotation=h);e=a(h);w=d(h);h=-f;k=-g;n=f;t=g;f=w*h;g=w*k;k*=e;h*=e;x=w*n;w*=t;n*=e;t*=e;e={x:f-k+b,y:g+h+c};g={x:x-k+b,y:g+n+c};k={x:x-t+b,y:w+n+c};f={x:f-t+b,y:w+h+c};q.x=b;q.y=c;return this._bounding=b={a:e,b:g,c:k,d:f,e:q}};e.setRotate=function(a){this.rotation=g.deg2rad(a);return this};e.add=function(a){if(a===this)return this;a.parent&&a.parent.remove(a);
a.parent=this;this.children.push(a);var e=this.scene;e&&e.addChild(a);return this};e.remove=function(a){var e;e=this.children.indexOf(a);if(-1===e)return this;a.parent=null;this.children.splice(e,1);(e=this.scene)&&e.removeChild(a);return this};e.draw=function(a){this.visible&&0<this._alpha&&this._draw(a);var e=this.children,b,d;b=0;for(d=e.length;b<d;b++)e[b].draw(a);return this};e._draw=function(a){};e.inside=function(a,e){this.visible&&(e=this._inside(a,e));var b=this.children,d,c;d=0;for(c=b.length;d<
c;d++)e=b[d].inside(a,e);return e};e._area=function(a,e,b){return b.x*e.y-e.x*b.y-(b.x*a.y-a.x*b.y)+(e.x*a.y-a.x*e.y)};e._inside=function(a,e){var b=this.bounding();0<this._area(b.a,b.b,a)||0<this._area(b.b,b.c,a)||0<this._area(b.c,b.d,a)||0<this._area(b.d,b.a,a)||e.push(this);return e};e.swap=function(a,e){var b=this.children,d=b.indexOf(a),c=b.indexOf(e);-1!==d&&-1!==c&&(b[c]=a,b[d]=e);return this};e.highest=function(a){var e=this.children,b=e.indexOf(a);-1!==b&&(e.splice(b,1),e.push(a));return this};
e.render=function(a,e){this.beginRender(a,e);var b=this.children,d,c;d=0;for(c=b.length;d<c;d++)b[d].render(a,e);return this};e.beginRender=function(a,e){this.prepareRender(a,e)};e.prepareRender=function(a,e){};e._rgba=function(a,e){return{r:a.r,g:a.g,b:a.b,a:a.a*e}};return b}()})(window);
(function(k){var c=k.Sankaku,h=c.Object2D;c.Scene=function(){function g(){h.call(this);this.scene=this}c.extend(h,g);var f=g.prototype;f.constructor=c.Scene;f.addChild=function(b){b.scene=this};f.removeChild=function(b){b.scene=null};f.inside=function(b,d){var a=this.children,e,c;e=0;for(c=a.length;e<c;e++)d=a[e].inside(b,d);return d};return g}()})(window);
(function(k){var c=k.Sankaku,h=c.Object2D,g=c.Vector2D,f=c.Iro;c.Shape=function(){function b(a,e,d,c,f,g){h.call(this);this.setX(a);this.setY(e);this.width=d||20;this.height=c||10;this._fill=g||b.STROKE;this._line=1;this._rgb={r:0,g:0,b:0};this._color=f=f||"#000000";this.setColor(f);this.setBorder(this.setLine,this._color)}c.extend(h,b);b.FILL="shape_fill";b.STROKE="shape_stroke";b.BOTH="shape_both";var d=b.prototype;d.constructor=c.Shape;d.clone=function(){var a=new b(this.x,this.y,this.width,this.height,
this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={setLine:this._border.setLine,rgb:this._border.rgb};return a};d.radius=function(){var a=this.bounding(),e=a.a,a=a.c;return 0.5*(new g(e.x,e.y)).distance(new g(a.x,a.y))};d.setBorder=function(a,e){var b=f.hex2rgb(e);b.a=this._alpha;this._border={setLine:a,rgb:b};return this};d.setMode=function(a){this._fill=a;return this};d.mode=function(){return this._fill};
d.setLine=function(a){this._line=a;return this};d.line=function(){return this._line};d._draw=function(a){var e=this.paint(a),d=this._rgba(this._rgb,e.e.alpha);switch(this._fill){case b.STROKE:this.stroke(a,this._line,d);break;case b.FILL:this.fill(a,d);break;case b.BOTH:e=this._rgba(this._border._rgb,e.e.alpha),this.stroke(a,this._border._line,e),this.fill(a,d)}};d.fill=function(a,e){a.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";a.fill()};d.stroke=function(a,e,b){a.lineWidth=e;a.strokeStyle=
"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";a.stroke()};d.paint=function(a){var e=this.bounding(),b=e.a,d=e.b,c=e.c,f=e.d;a.beginPath();a.moveTo(b.x,b.y);a.lineTo(d.x,d.y);a.lineTo(c.x,c.y);a.lineTo(f.x,f.y);a.lineTo(b.x,b.y);a.closePath();return e};return b}()})(window);
(function(k){var c=k.Sankaku,h=c.Shape;c.Circle=function(){function g(a,e,b,d,c){h.call(this,a,e,2*b,2*b,d,c);this._radius=b||this.width}var f=2*Math.PI,b=Math.pow;c.extend(h,g);var d=g.prototype;d.constructor=c.Circle;d.radius=function(){return this._radius*this.scale};d.clone=function(){var a=new g(this.x,this.y,this._radius,this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={line:this._border.line,
rgb:this._border.rgb};return a};d.paint=function(a){var e=this.bounding(),b=e.e;a.beginPath();a.arc(b.x,b.y,this._radius*b.scale,0,f,!1);a.closePath();return e};d._inside=function(a,e){var d=this._radius;b(this.x-a.x,2)+b(this.y-a.y,2)<d*d&&e.push(this);return e};d.contain=function(a){var e=[];this._inside(a,e);return 0<e.length};return g}()})(window);
(function(k){var c=k.Sankaku,h=c.Shape;c.Tripod=function(){function g(b,d,a,e,c,f){h.call(this,b,d,a,e,c,f)}c.extend(h,g);var f=g.prototype;f.constructor=c.Tripod;f.clone=function(){var b=new g(this.x,this.y,this.width,this.height,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={line:this._border.line,rgb:this._border.rgb};return b};f.paint=function(b){var d=this.bounding(),a=d.a,e=d.b,c=d.c,f=d.d;
b.beginPath();b.moveTo(a.x,a.y);b.lineTo(0.5*(e.x+c.x),0.5*(e.y+c.y));b.lineTo(f.x,f.y);b.lineTo(a.x,a.y);b.closePath();return d};f._inside=function(b,d){var a=this.bounding(),e=a.b,c=a.c,e={x:0.5*(e.x+c.x),y:0.5*(e.y+c.y)};0<this._area(a.a,e,b)||0<this._area(e,a.d,b)||0<this._area(a.d,a.a,b)||d.push(this);return d};return g}()})(window);
(function(k){var c=k.Sankaku,h=c.Shape,g=c.Num;c.Star=function(){function f(a,b,d,c,f,g,k){h.call(this,a,b,d,d,c,f);this._radius=d||this.width;this._points=g||5;this._inner=k||0.475*d}var b=Math.sin,d=Math.cos;c.extend(h,f);var a=f.prototype;a.constructor=c.Star;a.radius=function(){return this._radius};a.clone=function(){var a=new f(this.x,this.y,this._radius,this._color,this._fill,this._points);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=
this._line;a._border={line:this._border.line,rgb:this._border.rgb};return a};a.paint=function(a){var c=this.bounding(),f=c.e,h=this._points,k=2*h,h=g.ONE_EIGHTY/h,v=g.NINETY,u=f.scale,r=this._radius*u,u=this._inner*u,q=f.x,n=f.y,f=f.rotation,t,w,x;a.beginPath();for(t=0;t<=k;++t)w=t*h-v+f,x=t%2?u:r,a.lineTo(q+x*d(w),n+x*b(w));a.closePath();return c};return f}()})(window);
(function(k){var c=k.Sankaku,h=c.Object2D,g=c.Shape;c.Line=function(){function f(b,a,e,c){h.call(this);this._v1=b;this._v2=a;this._fill=g.STROKE;this._line=c||1;this._rgb={r:0,g:0,b:0};this._color=e=e||"#000000";this.setColor(e)}c.extend(h,f);var b=f.prototype;b.constructor=c.Line;b._clone=function(){var b=new f(this._v1,this._v2,this._color,this._line);b.setAlpha(this._alpha);b.scale=this.scale;b.visible=this.visible;b.setColor(this._color);return b};b.setPosition=function(b){return this};b.setX=
function(b){return this};b.setY=function(b){return this};b.setRotate=function(b){return this};b.add=function(b){return this};b.remove=function(){return this};b.bounding=function(){var b=this.parent,a;a={scale:this.scale,rotation:this.rotation,alpha:this._alpha,x:this.x,y:this.y};b&&this.scene!==b&&(a.scale=b.scale*this.scale,a.alpha=b.alpha()*this._alpha);return this._bounding=b={e:a,a:this._v1.bounding().e,b:this._v2.bounding().e}};b._inside=function(b,a){return a};b._draw=function(b){var a=this.paint(b),
a=this._rgba(this._rgb,a.e.alpha);this.stroke(b,this._line,a)};b.stroke=function(b,a,e){b.lineWidth=a;b.strokeStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";b.stroke()};b.paint=function(b){var a=this._v1.bounding().e,e=this._v2.bounding().e,c=this.bounding();b.beginPath();b.lineTo(a.x,a.y);b.lineTo(e.x,e.y);b.closePath();return c};return f}()})(window);
(function(k){var c=k.Sankaku,h=c.Shape,g=c.LoadImage;c.Bitmap=function(){function f(b,a,e,c,f){h.call(this,b,a,e,c);b=this.onLoad.bind(this);a=this.onError.bind(this);f.addEventListener(g.COMPLETE,b);f.addEventListener(g.ERROR,a);this._boundLoad=b;this._boundError=a;this._fill=h.FILL;this._img=f;this._bitmap=null;f.load()}c.extend(h,f);var b=f.prototype;b.constructor=f;b.dispose=function(){var b=this._img;b.removeEventListener(g.COMPLETE,this._boundLoad);b.removeEventListener(g.ERROR,this._boundError)};
b.onLoad=function(){this.dispose();this._bitmap=this._img};b.onError=function(){this.dispose()};b.clone=function(){};b.setMode=function(){};b._draw=function(b){if(this._bitmap){var a=this.bounding();this.fill(b,a)}};b.fill=function(b,a){var e=a.e,c=e.alpha,f=e.rotation,g=e.scale;if(1>c||0!==f)b.save(),1>c&&(b.globalAlpha=c),0!==f&&(b.setTransform(1,0,0,1,0,0),b.translate(e.x,e.y),b.rotate(f));b.drawImage(this._bitmap,e.x-this.width*g*0.5,e.y-this.height*g*0.5);(1>c||0!==f)&&b.restore()};return f}()})(window);
(function(k){var c=k.Sankaku,h=c.Vector2D,g=c.Object2D,f=c.Tripod;c.Vehicle=function(){function b(a){g.call(this);this._velocity=new h;this._mass=1;this._speed=10;this._behavior=b.BOUNCE;this.bottom=this.right=this.top=this.left=0;this.setView(a||new f(this.x,this.y,this.width,this.height))}var d=Math.abs;c.extend(g,b);b.WRAP="vehicle_wrap";b.BOUNCE="vehicle_bounce";var a=b.prototype;a.constructor=c.Vehicle;c.EventDispatcher.initialize(a);a.setView=function(a){a.setPosition(this._position);this.width=
a.width;this.height=a.height;this.rotation=a.rotation;a.scale=this.scale;this._view=a};a.view=function(){return this._view};a.clone=function(){var a=new b(this._view.clone());a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;return a};a.setPadding=function(a,b,d,c){this.top=a;this.right=b||a;this.bottom=d||a;this.left=c||a;return this};
a.setMass=function(a){this._mass=a;return this};a.mass=function(){return this._mass};a.setSpeed=function(a){this._speed=a;return this};a.speed=function(){return this._speed};a.setBehavior=function(a){this._behavior=a;return this};a.behavior=function(){return this._behavior};a.setVelocity=function(a){this._velocity=a;return this};a.velocity=function(){return this._velocity};a.draw=function(a){this.visible&&0<this._alpha&&this._view.draw(a)};a.update=function(a,b){this._update(a,b)};a._update=function(a,
c){var f=this._velocity,g=this._position,h=this._view;a-=this.right;c-=this.bottom;f.truncate(d(this._speed));g.add(f);switch(this._behavior){case b.WRAP:this.wrap(a,c);break;default:this.bounce(a,c)}this.x=g.x;this.y=g.y;this.rotation=f.angle();h.x=g.x;h.y=g.y;h.rotation=f.angle();h.width=this.width;h.height=this.height};a.wrap=function(a,b){var d=this._position,c=!1,f=this.left,g=this.top;d.x>a&&(d.x=f,c=!0);d.x<f&&(d.x=a,c=!0);d.y>b&&(d.y=g,c=!0);d.y<g&&(d.y=b,c=!0);c&&this.dispatchEvent({type:"wrap",
currentTarget:this})};a.bounce=function(a,b){var d=this._velocity,c=this._position,f=!1,g=this.left,h=this.top;c.x>a?(c.x=a,d.x*=-1,f=!0):c.x<g&&(c.x=g,d.x*=-1,f=!0);c.y>b?(c.y=b,d.y*=-1,f=!0):c.y<h&&(c.y=h,d.y*=-1,f=!0);f&&this.dispatchEvent({type:"bounce",currentTarget:this})};a.beginRender=function(a,b){this.prepareRender();this.update(a,b)};return b}()})(window);
(function(k){var c=k.Sankaku,h=c.Vehicle,g=c.Vector2D;c.SteeredVehicle=function(){function f(a){h.call(this,a);this._force=new g;this._force_max=1;this._force_arrival=100;this._avoid_distance=300;this._avoid_buffer=20;this._avoid_insight=200;this._avoid_close=60}var b=0.5*Math.PI;c.extend(h,f);var d=f.prototype;d.constructor=c.SteeredVehicle;d.clone=function(){var a=Object.create(this);a.setView(this._view.clone());a._force=this._force.clone();a.setPosition(this._position.clone());return a};d.max=
function(){return this._force_max};d.setMax=function(a){this._force_max=a;return this};d.arrival=function(){return this._force_arrival};d.setArrival=function(a){this._force_arrival=a;return this};d.setForce=function(a){this._force=a;return this};d.force=function(){return this._force};d.setBuffer=function(a){this._avoid_buffer=a;return this};d.buffer=function(){return this._avoid_buffer};d.setInsight=function(a){this._avoid_insight=a;return this};d.insight=function(){return this._avoid_insight};d.setClose=
function(a){this._avoid_close=a;return this};d.close=function(){return this._avoid_close};d.setAvoidDistance=function(a){this._avoid_distance=a;return this};d.avoidDistance=function(){return this._avoid_distance};d.update=function(a,b){this._force.truncate(this._force_max).divideScalar(this._mass);this._velocity.add(this._force);this._force=new g;this._update(a,b)};d.seek=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.add(a)};d.flee=
function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.sub(a)};d.arrive=function(a){var b=a.subNew(this._position),d=this._force_arrival;b.normalize();a=this._position.distance(a);a>d?b.multiplyScalar(this._speed):b.multiplyScalar(this._speed*a/d);b.sub(this._velocity);this._force.add(b)};d.pursue=function(a){var b=this._position.distance(a.position()),d=a.position().clone();d.add(a._velocity.multiplyNew(b));this.seek(d)};d.evade=function(a){var b=
this._position.distance(a.position())/this._speed,d=a.position().clone();d.sub(a._velocity.multiplyNew(b));this.flee(d)};d.avoid=function(a){var d,c,f,g,h,k,u,r;u=0;for(r=a.length;u<r;u++)d=a[u],c=this._velocity.clone().normalize(),f=d.position().subNew(this._position),g=f.dot(c),0<g&&(h=c.clone(),h.multiplyScalar(this._avoid_distance),k=c.clone(),k.multiplyScalar(g),g=k.subNew(f).length(),g<d.radius()+this._avoid_buffer&&k.length()<h.length()&&(d=c.clone(),d.multiplyScalar(this._speed),d.setAngle(d.angle()+
f.sign(this._velocity)*b),f=k.length()/h.length(),d.multiplyScalar(1-f),this._force.add(d),this._velocity.multiplyScalar(f)))};return f}()})(window);
(function(k){var c=k.Sankaku,h=c.SteeredVehicle,g=c.Vector2D;c.Wander=function(){function f(a){h.call(this,a);this._wander_angle=0;this._wander_distance=10;this._wnder_radius=5;this._wander_range=1;this._wander_range2=0.5*this._wander_range}var b=Math.random;c.extend(h,f);var d=f.prototype;d.constructor=c.Wander;d.clone=function(){var a=Object.create(this);a.setView(this._view.clone());return a};d.setWanderAngle=function(a){this._wander_angle=a;return this};d.wanderAngle=function(){return this._wander_angle};
d.setWanderDistance=function(a){this._wander_distance=a;return this};d.wanderDistance=function(){return this._wander_distance};d.setWanderRadius=function(a){this._wnder_radius=a;return this};d.wanderRadius=function(){return this._wnder_radius};d.setWanderRange=function(a){this._wander_range=a;this._wander_range2=0.5*a;return this};d.wanderRange=function(){return this._wander_range};d.wander=function(){var a=this._velocity.clone().normalize().multiplyScalar(this._wander_distance),d=new g;d.setLength(this._wnder_radius);
d.setAngle(this._wander_angle);this._wander_angle+=b()*this._wander_range-this._wander_range2;a.add(d);this._force.add(a)};d.beginRender=function(a,b){this.prepareRender();this.wander(this._paths,this._loop);this.update(a,b)};return f}()})(window);
(function(k){var c=k.Sankaku,h=c.SteeredVehicle,g=c.Vector2D;c.Flock=function(){function f(b){h.call(this,b);this._flock_flockInsight=200;this._flock_flockClose=60}c.extend(h,f);var b=f.prototype;b.constructor=c.Flock;b.clone=function(){var b=Object.create(this);b.setView(this._view.clone());b.position(this._position.clone());b._velocity=this._velocity.clone();b._force=this._force.clone();return b};b.setFlockInsight=function(b){this._flock_flockInsight=b;return this};b.flockInsight=function(){return this._flock_flockInsight};
b.setFlockClose=function(b){this._flock_flockClose=b;return this};b.flockClose=function(){return this._flock_flockClose};b.flock=function(b){var a=this._velocity.clone(),c=new g,f=0,h,k,l;k=0;for(l=b.length;k<l;k++)h=b[k],h!==this&&this.tooInsight(h)&&(a.add(h.velocity()),c.add(h.position()),this.tooClose(h)&&this.flee(h.position()),++f);0<f&&(a.divideScalar(f),c.divideScalar(f),this.seek(c),this._force.add(a.sub(this._velocity)))};b.tooInsight=function(b){var a;if(this._position.distance(b._position)>
this._flock_flockInsight)return!1;a=this._velocity.clone().normalize();return 0>b._position.subNew(this._position).dot(a)};b.tooClose=function(b){return this._position.distance(b._position)<this._flock_flockClose};b.setFlocks=function(b){this._flocks=b;return this};b.beginRender=function(b,a){this.prepareRender();this.flock(this._flocks);this.update(b,a)};return f}()})(window);
(function(k){var c=k.Sankaku,h=c.SteeredVehicle;c.FollowPath=function(){function g(b){h.call(this,b);this._index=0;this._threshold=20}c.extend(h,g);var f=g.prototype;f.constructor=c.FollowPath;f.clone=function(){var b=Object.create(this);b.setView(this._view.clone());b.position(this._position.clone());b._velocity=this._velocity.clone();b._force=this._force.clone();return b};f.follow=function(b,c){c=!!c;var a=b[this._index],e;a&&(e=b.length-1,this._position.distance(a)<this._threshold&&(this._index>=
e?c&&(this._index=0):this._index++),this._index>=e&&!c?this.arrive(a):this.seek(a))};f.setPath=function(b){this._paths=b;return this};f.setLoop=function(b){this._loop=b;return this};f.beginRender=function(b,c){this.prepareRender();this.follow(this._paths,this._loop);this.update(b,c)};return g}()})(window);
(function(k){var c=k.Sankaku;c.Zanzo=function(){function h(c){this._limit=c;this._objects=[]}var g=h.prototype;g.constructor=c.Zanzo;g.limit=function(c){this._limit=c};g.add=function(c){var b=this._objects,d=[],a,e;0<this._limit&&b.length>=this._limit&&b.shift();a=0;for(e=c.length;a<e;a++)b=c[a],d.push(b.clone());this._objects.push(d)};g.draw=function(c,b){var d=this._objects,a,e,g,h,k,l,v;k=d.length;g=1/(k+1);c.save();for(h=0;h<k;h++)for(a=d[h],e=g*(h+1),c.globalAlpha=e,l=0,v=a.length;l<v;l++)e=
a[l],e.draw(c),b&&b.call(c);c.restore()};g.length=function(){return this._objects.length};return h}()})(window);(function(k){var c=k.Sankaku;c.Inside=function(){function h(c){this._scene=c;this._contains=[]}var g=h.prototype;g.constructor=c.Inside;g.check=function(c){var b=this._contains;b.length=0;b=this._scene.inside(c,b);return b.reverse()};return h}()})(window);

/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/06/20 - 11:55

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 delaunay
 original: https://github.com/ironwallaby/delaunay

 hosted on
 https://github.com/taikiken/sankaku.js
*/
var Sankaku={version:"0.2.3"};
(function(k){k.console||(k.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}});Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var h=0,f=["ms","moz","webkit","o"],g=0;g<f.length&&!k.requestAnimationFrame;++g)k.requestAnimationFrame=k[f[g]+"RequestAnimationFrame"],k.cancelAnimationFrame=k[f[g]+"CancelAnimationFrame"]||k[f[g]+"CancelRequestAnimationFrame"];void 0===k.requestAnimationFrame&&void 0!==k.setTimeout&&
(k.requestAnimationFrame=function(e){var d=Date.now(),c=Math.setMax(0,16-(d-h)),b=k.setTimeout(function(){e(d+c)},c);h=d+c;return b});void 0===k.cancelAnimationFrame&&void 0!==k.clearTimeout&&(k.cancelAnimationFrame=function(e){k.clearTimeout(e)});Object.create||(Object.create=function(){function e(){}return function(d){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");e.prototype=d;return new e}}());Array.isArray||(Array.isArray=function(e){return"[object Array]"===
Object.prototype.toString.call(e)});Array.prototype.indexOf||(Array.prototype.indexOf=function(e,d){var c;c=d?d:0;var b;if(!this)throw new TypeError;b=this.length;if(0===b||c>=b)return-1;for(0>c&&(c=b-Math.abs(c));c<b;c++)if(this[c]===e)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(e,d){var c,b;c=0;for(b=this.length;c<b;++c)c in this&&e.call(d,this[c],c,this)});Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var d=Array.prototype.slice.call(arguments,1),c=this,b=function(){},a=function(){return c.apply(this instanceof b&&e?this:e,d.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;a.prototype=new b;return a});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL})()})(window.self);(function(k){k.Sankaku.extend=function(h,f){f.prototype=Object.create(h.prototype);f.prototype.constructor=f}})(window);
(function(k){k.EventDispatcher=function(){function h(){}var f=h.prototype;f.constructor=k.EventDispatcher;f.addEventListener=function(g,e){"undefined"===typeof this._listeners&&(this._listeners={});var d=this._listeners;"undefined"===typeof d[g]&&(d[g]=[]);-1===d[g].indexOf(e)&&d[g].push(e)};f.hasEventListener=function(g,e){var d=this._listeners;return"undefined"!==typeof d&&"undefined"!==typeof e[g]&&-1!==d[g].indexOf(e)?!0:!1};f.removeEventListener=function(g,e){if("undefined"!==typeof this._listeners){var d=
this._listeners[g],c;"undefined"!==typeof d&&(c=d.indexOf(e),-1!==c&&d.splice(c,1))}};f.dispatchEvent=function(g){var e=this._listeners,d,c;if("undefined"!==typeof e&&"undefined"!==typeof g.type&&(e=e[g.type],"undefined"!==typeof e))for(g.target=this,d=0,c=e.length;d<c;d++)e[d].call(this,g)};h.initialize=function(g){g.addEventListener=f.addEventListener;g.hasEventListener=f.hasEventListener;g.removeEventListener=f.removeEventListener;g.dispatchEvent=f.dispatchEvent};return h}()})(window.Sankaku);
(function(k){k.Sankaku.Iro=function(){function h(){throw Error("Iro can't create instance");}h.rgb2hsl=function(f,g,e){f/=255;g/=255;e/=255;var d=Math.setMax(f,g,e),c=Math.min(f,g,e),b,a,q;a=(d+c)/2;if(d===c)b=c=0;else{q=d-c;c=0.5<a?q/(2-d-c):q/(d+c);switch(d){case f:b=(g-e)/q+(g<e?6:0);break;case g:b=(e-f)/q+2;break;case e:b=(f-g)/q+4}b/=6}return{h:b,s:c,l:a}};h.hsl2rgb=function(f,g,e){function d(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}if(0===g)e=
g=f=e;else{var c=0.5>e?e*(1+g):e+g-e*g,b=2*e-c;e=d(b,c,f+1/3);g=d(b,c,f);f=d(b,c,f-1/3)}return{r:255*e,g:255*g,b:255*f}};h.rgb2hsv=function(f,g,e){f/=255;g/=255;e/=255;var d=Math.setMax(f,g,e),c=Math.min(f,g,e),b,a=d-c;if(d===c)b=0;else{switch(d){case f:b=(g-e)/a+(g<e?6:0);break;case g:b=(e-f)/a+2;break;case e:b=(f-g)/a+4}b/=6}return{h:b,s:0===d?0:a/d,v:d}};h.hsv2rgb=function(f,g,e){var d,c,b,a=Math.floor(6*f),q=6*f-a;f=e*(1-g);var m=e*(1-q*g);g=e*(1-(1-q)*g);switch(a%6){case 0:d=e;c=g;b=f;break;
case 1:d=m;c=e;b=f;break;case 2:d=f;c=e;b=g;break;case 3:d=f;c=m;b=e;break;case 4:d=g;c=f;b=e;break;case 5:d=e,c=f,b=m}return{r:255*d,g:255*c,b:255*b}};h.hex2rgb=function(f){if("string"!==typeof f)return null;f=f.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(g,e,d,c){return e+e+d+d+c+c});return(f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f))?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:null};h.rgb2hex=function(f,g,e){function d(c){c=c.toString(16);return 1===c.length?
"0"+c:c}return"#"+d(f)+d(g)+d(e)};h.int2hex=function(f){f=Math.floor(f);f=f.toString(16);if(6>f.length)for(var g=6-f.length;g;)f="0"+f,--g;return"#"+f};return h}()})(window);
(function(k){k.Sankaku.List=function(){function h(){throw Error("List can't create instance");}var f=Math.random,g=Math.floor,e=Math.setMax;h.word=function(d,c){var b=[],a;for(a=0;a<d;a++)b[a]=c;return b};h.zero=function(d){return this.word(d,0)};h.shuffle=function(d){for(var c=[],b=d.length,a;b;)a=g(f()*d.length),a in d&&(c.push(d[a]),delete d[a],--b);return c};h.setMax=function(d){return e.apply(null,d)};return h}()})(window);
(function(k){k.Sankaku.Num=function(){function h(){throw Error("Num can't create instance");}var f=k.parseFloat,g=Math.random,e=Math.floor,d=Math.PI;h.ONE_DEG=d/180;h.FORTY_FIVE=d/4;h.NINETY=d/2;h.ONE_EIGHTY=d;h.THREE_SIXTY=2*d;h.is=function(c){return!isNaN(f(c))&&isFinite(c)};h.random=function(c,b){h.is(b)||(b=c,c=0);return c+e(g()*(b-c+1))};h.deg2rad=function(c){return c*h.ONE_DEG};return h}()})(window);
(function(k){k.Sankaku.Distribute=function(){function h(){throw Error("Distribute can't create instance");}var f=Math.sqrt,g=Math.sin,e=Math.cos,d=Math.random,c=2*Math.PI;h.circle=function(b,a,q){var m;b*=f(d());m=d()*c;return{x:0.5*a+e(m)*b,y:0.5*q+g(m)*b}};return h}()})(window);
(function(k){var h=k.Sankaku;h.Vector2D=function(){function f(a,b){this.x=a||0;this.y=b||0}var g=Math.floor,e=Math.ceil,d=Math.round,c=Math.cos,b=Math.sin,a=Math.atan2,q=Math.sqrt,m=Math.min,t=Math.acos,l=f.prototype;l.constructor=h.Vector2D;l.draw=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.x,this.y);a.closePath();return this};l.clone=function(){return new f(this.x,this.y)};l.zero=function(){this.y=this.x=0;return this};l.isZero=function(){return 0===this.x&&0===this.y};l.set=function(a,
b){this.x=a;this.y=b;return this};l.setX=function(a){this.x=a;return this};l.setY=function(a){this.y=a;return this};l.copy=function(a){this.x=a.x;this.y=a.y;return this};l.add=function(a){this.x+=a.x;this.y+=a.y;return this};l.addScalar=function(a){this.x+=a;this.y+=a;return this};l.addNew=function(a){return new f(this.x+a.x,this.y+a.y)};l.addVector=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this};l.sub=function(a){this.x-=a.x;this.y-=a.y;return this};l.subNew=function(a){return new f(this.x-
a.x,this.y-a.y)};l.subVector=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this};l.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};l.multiplyScalar=function(a){this.x*=a;this.y*=a;return this};l.multiplyNew=function(a){return new f(this.x*a.x,this.y*a.y)};l.divide=function(a){this.x/=a.x;this.y/=a.y;return this};l.divideScalar=function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this};l.divideNew=function(a){return new f(this.x/a.x,this.y/a.y)};l.min=function(a){this.x>
a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this};l.setMax=function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this};l.clamp=function(a,b){this.min(a);this.setMax(b);return this};l.clampScalar=function(a,b){var c,d;c=new f;d=new f;c.set(a,a);d.set(b,b);return this.clamp(c,d)};l.floor=function(){this.x=g(this.x);this.y=g(this.y);return this};l.ceil=function(){this.x=e(this.x);this.y=e(this.y);return this};l.round=function(){this.x=d(this.x);this.y=d(this.y);return this};l.roundToZero=
function(){this.x=0>this.x?e(this.x):g(this.x);this.y=0>this.y?e(this.y):g(this.y);return this};l.negate=function(){return this.multiplyScalar(-1)};l.dot=function(a){return this.x*a.x+this.y*a.y};l.lengthSq=function(){return this.x*this.x+this.y*this.y};l.length=function(){return q(this.lengthSq())};l.setLength=function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this};l.setAngle=function(a){var d=this.length(),d=d||0.001;this.x=c(a)*d;this.y=b(a)*d;return this};l.angle=function(){return a(this.y,
this.x)};l.normalize=function(){return this.divideScalar(this.length())};l.distanceSq=function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a};l.distance=function(a){return q(this.distanceSq(a))};l.lerp=function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this};l.equals=function(a){return a.x===this.x&&a.y===this.y};l.fromArray=function(a){this.x=a[0];this.y=a[1];return this};l.toArray=function(){return[this.x,this.y]};l.truncate=function(a){a=m(a,this.length());return this.setLength(a)};
l.reverse=function(){this.negate();return this};l.isNormalize=function(){return 1===this.length()};l.perpendicular=function(){return new f(-this.y,this.x)};l.sign=function(a){return 0>this.perpendicular().dot(a)?-1:1};f.angleBetween=function(a,b){a.isNormalize()||(a=a.clone().normalize());b.isNormalize()||(b=b.clone().normalize());return t(a.dot(b))};return f}()})(window);
(function(k){var h=Math.abs,f=Math.min,g=Math.setMax,e=Math.round,d=k.Sankaku;d.Triangle=function(){function c(a,b,c){this.a=a;this.b=b;this.c=c;var d=b.x-a.x,e=b.y-a.y,k=c.x-a.x,v=c.y-a.y,n=d*(a.x+b.x)+e*(a.y+b.y),s=k*(a.x+c.x)+v*(a.y+c.y),p=2*(d*(c.y-b.y)-e*(c.x-b.x));1E-6>h(p)?(k=f(a.x,b.x,c.x),n=f(a.y,b.y,c.y),d=0.5*(g(a.x,b.x,c.x)-k),a=0.5*(g(a.y,b.y,c.y)-n),this.x=k+d,this.y=n+a):(b=(v*n-e*s)/p,c=(d*s-k*n)/p,d=b-a.x,a=c-a.y,this.x=b,this.y=c);this.r=d*d+a*a}var b=c.prototype;b.constructor=d.Triangle;
b.draw=function(a){var b=this.a,c=this.b,d=this.c;a.beginPath();a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.lineTo(d.x,d.y);a.closePath()};b.centroid=function(){return{x:e((this.a.x+this.b.x+this.c.x)/3),y:e((this.a.y+this.b.y+this.c.y)/3)}};return c}()})(window);
(function(k){k=k.Sankaku;var h=k.Triangle;k.Delaunay=function(){function f(){throw Error("Sankaku can't create instance.");}f.triangulate=function(g){if(3>g.length)return[];var e,d,c,b,a,f,m,t,l,k=function(a){var b=a.length,c,d,e,f,g;a:for(;b;)for(d=a[--b],c=a[--b],e=b;e;)if(g=a[--e],f=a[--e],c===f&&d===g||c===g&&d===f){a.splice(b,2);a.splice(e,2);b-=2;continue a}};g.sort(function(a,b){return b.x-a.x});d=g.length-1;e=g[d];c=e.x;b=g[0].x;for(f=a=e.y;d--;)e.y<a&&(a=e.y),e.y>f&&(f=e.y);m=b-c;t=f-a;d=
m>t?m:t;e=0.5*(b+c);m=0.5*(f+a);f=[new h({x:e-20*d,y:m-d,__sentinel:!0},{x:e,y:m+20*d,__sentinel:!0},{x:e+20*d,y:m-d,__sentinel:!0})];a=[];c=[];for(d=g.length;d--;){c.length=0;b=f.length;for(e=g[d];b--;)l=f[b],m=e.x-l.x,0<m&&m*m>l.r?(a.push(l),f.splice(b,1)):(t=e.y-l.y,m*m+t*t>l.r||(c.push(l.a,l.b,l.b,l.c,l.c,l.a),f.splice(b,1)));k(c);for(b=c.length;b;)t=c[--b],m=c[--b],f.push(new h(m,t,e))}Array.prototype.push.apply(a,f);for(d=a.length;d--;)g=a[d],(g.a.__sentinel||g.b.__sentinel||g.c.__sentinel)&&
a.splice(d,1);return a};return f}()})(window);
(function(k){var h=k.Sankaku,f=h.Vector2D,g=h.Num;h.Object2D=function(){function e(){this._position=new f;this.rotation=this.y=this.x=0;this.width=20;this.height=10;this.scale=1;this.parent=this.scene=null;this.children=[];this.visible=!0;this._alpha=1}var d=Math.cos,c=Math.sin,b=e.prototype;b.constructor=h.Object2D;h.EventDispatcher.initialize(b);b.setAlpha=function(a){this._alpha=a;return this.setColor(this._color)};b.alpha=function(){return this._alpha};b.setPosition=function(a){this._position=
a;this.x=a.x;this.y=a.y};b.position=function(){return this._position};b.setX=function(a){this.x=a;this._position.x=a};b.setY=function(a){this.y=a;this._position.y=a};b.bounding=function(){var a=this.parent,b=this.x,e=this.y,f=this.width*this.scale,g=this.height*this.scale,f=0.5*f,g=0.5*g,h=this.rotation,k,n,s,p,r,u;n={scale:this.scale,rotation:this.rotation,x:this.x,y:this.y};a&&this.scene!==a&&(b=a.x+b*a.scale,e=a.y+e*a.scale,f=this.width*a.scale,g=this.height*a.scale,f*=0.5,g*=0.5,h=a.rotation+
this.rotation,n.scale=a.scale*this.scale,n.rotation=h);a=c(h);r=d(h);h=-f;k=-g;s=f;p=g;f=r*h;g=r*k;k*=a;h*=a;u=r*s;r*=p;s*=a;p*=a;a={x:f-k+b,y:g+h+e};g={x:u-k+b,y:g+s+e};k={x:u-p+b,y:r+s+e};b={x:f-p+b,y:r+h+e};n.x=0.5*(a.x+k.x);n.y=0.5*(a.y+k.y);return{a:a,b:g,c:k,d:b,e:n}};b.rotate=function(a){this.rotation=g.deg2rad(a)};b.clone=function(){return this._clone()};b._clone=function(){var a=new e;a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=
this.scale;a.parent=parent&&parent.clone();return a};b.inside=function(a){function b(a,c,d){return d.x*c.y-c.x*d.y-(d.x*a.y-a.x*d.y)+(c.x*a.y-a.x*c.y)}var c=this.bounding();return 0<b(c.a,a)||0<b(c.b,a)||0<b(c.c,a)?!1:!0};b.add=function(a){if(a!==this){a.parent&&a.parent.remove(a);a.parent=this;this.children.push(a);var b=this.scene;b&&b.addChild(a)}};b.remove=function(a){var b;b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1),(b=this.scene)&&b.removeChild(a))};b.draw=function(a){this._draw(a);
var b=this.children,c,d,e;d=0;for(e=b.length;d<e;d++)c=b[d],c.visible&&0<c.alpha()&&b[d].draw(a)};b._draw=function(a){};b.swap=function(a,b){var c=this.children,d=c.indexOf(a),e=c.indexOf(b);c[e]=a;c[d]=b};b.highest=function(a){var b=this.children,c=b.indexOf(a);b.splice(c,1);b.push(a)};return e}()})(window);
(function(k){var h=k.Sankaku,f=h.Object2D;h.Scene=function(){function g(){f.call(this);this.scene=this}h.extend(f,g);var e=g.prototype;e.constructor=h.Scene;e.addChild=function(d){d.scene=this};e.removeChild=function(d){d.scene=null};return g}()})(window);
(function(k){var h=k.Sankaku,f=h.Object2D,g=h.Vector2D,e=h.Iro;h.Shape=function(){function d(b,a,c,e,g,h){f.call(this);this.setX(b);this.setY(a);this.width=c||20;this.height=e||10;this._fill=h||d.STROKE;this._line=1;this._rgb={};this._color=g||"#000000";this.setColor(this._color);this.setBorder(this.setLine,this._color)}h.extend(f,d);d.FILL="shape_fill";d.STROKE="shape_stroke";d.BOTH="shape_both";var c=d.prototype;c.constructor=h.Shape;c.radius=function(){var b=this.bounding(),a=b.a,b=b.c;return 0.5*
(new g(a.x,a.y)).distance(new g(b.x,b.y))};c.clone=function(){var b=new d(this.x,this.y,this.width,this.height,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={setLine:this._border.setLine,rgb:this._border.rgb};return b};c.setBorder=function(b,a){var c=e.hex2rgb(a);c.a=this._alpha;this._border={setLine:b,rgb:c};return this};c.setColor=function(b){this._color=b;this._rgb=e.hex2rgb(b);this._rgb.a=this._alpha;
return this};c.setMode=function(b){this._fill=b;return this};c.mode=function(){return this._fill};c.setLine=function(b){this._line=b;return this};c.line=function(){return this._line};c._draw=function(b){switch(this._fill){case d.STROKE:this.stroke(b,this._line,this._rgb);break;case d.FILL:this.fill(b,this._rgb);break;case d.BOTH:this.stroke(b,this._border._line,this._border._rgb),this.fill(b,this._rgb)}};c.fill=function(b,a){b.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")";this.paint(b);b.fill()};
c.stroke=function(b,a,c){b.lineWidth=a;b.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")";this.paint(b);b.stroke()};c.paint=function(b){var a=this.bounding(),c=a.a,d=a.b,e=a.c,a=a.d;b.beginPath();b.moveTo(c.x,c.y);b.lineTo(d.x,d.y);b.lineTo(e.x,e.y);b.lineTo(a.x,a.y);b.lineTo(c.x,c.y);b.closePath()};return d}()})(window);
(function(k){var h=k.Sankaku,f=h.Shape;h.Circle=function(){function g(c,b,a,d,e){f.call(this,c,b,a,a,d,e);this._radius=a||this.width}var e=2*Math.PI;h.extend(f,g);var d=g.prototype;d.constructor=h.Circle;d.radius=function(){return this._radius};d.clone=function(){var c=new g(this.x,this.y,this._radius,this._color,this._fill);c.rotation=this.rotation;c.scale=this.scale;c._alpha=this._alpha;c._rgb=Object.create(this._rgb);c._line=this._line;c._border={line:this._border.line,rgb:this._border.rgb};return c};
d.paint=function(c){var b=this.bounding().e;c.beginPath();c.arc(b.x,b.y,this._radius*b.scale,0,e,!1);c.closePath()};return g}()})(window);
(function(k){var h=k.Sankaku,f=h.Shape;h.Tripod=function(){function g(d,c,b,a,e,g){f.call(this,d,c,b,a,e,g)}h.extend(f,g);var e=g.prototype;e.constructor=h.Tripod;e.clone=function(){var d=new g(this.x,this.y,this.width,this.height,this._color,this._fill);d.rotation=this.rotation;d.scale=this.scale;d._alpha=this._alpha;d._rgb=Object.create(this._rgb);d._line=this._line;d._border={line:this._border.line,rgb:this._border.rgb};return d};e.paint=function(d){var c=this.bounding(),b=c.a,a=c.b,e=c.c,c=c.d;
d.beginPath();d.moveTo(b.x,b.y);d.lineTo(0.5*(a.x+e.x),0.5*(a.y+e.y));d.lineTo(c.x,c.y);d.lineTo(b.x,b.y);d.closePath()};return g}()})(window);
(function(k){var h=k.Sankaku,f=h.Shape,g=h.Num;h.Star=function(){function e(a,b,c,d,e,g,h){f.call(this,a,b,c,c,d,e);this._radius=c||this.width;this._points=g||5;this._inner=h||0.475*c}var d=Math.sin,c=Math.cos;h.extend(f,e);var b=e.prototype;b.constructor=h.Star;b.radius=function(){return this._radius};b.clone=function(){var a=new e(this.x,this.y,this._radius,this._color,this._fill,this._points);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=
this._line;a._border={line:this._border.line,rgb:this._border.rgb};return a};b.paint=function(a){var b=this.bounding().e,e=this._points,f=2*e,e=g.ONE_EIGHTY/e,h=g.NINETY,k=b.scale,v=this._radius*k,k=this._inner*k,n=b.x,s=b.y,b=b.rotation,p,r,u;a.beginPath();for(p=0;p<=f;++p)r=p*e-h+b,u=p%2?k:v,a.lineTo(n+u*c(r),s+u*d(r));a.closePath()};return e}()})(window);
(function(k){var h=k.Sankaku,f=h.Vector2D,g=h.Object2D,e=h.Tripod;h.Vehicle=function(){function d(a){g.call(this);this._velocity=new f;this._mass=1;this._speed=10;this._behavior=d.BOUNCE;this.bottom=this.right=this.top=this.left=0;this.setView(a||new e(this.x,this.y,this.width,this.height))}var c=Math.abs;h.extend(g,d);d.WRAP="vehicle_wrap";d.BOUNCE="vehicle_bounce";var b=d.prototype;b.constructor=h.Vehicle;h.EventDispatcher.initialize(b);b.setView=function(a){a.setPosition(this._position);this.width=
a.width;this.height=a.height;this.rotation=a.rotation;a.scale=this.scale;this._view=a};b.view=function(){return this._view};b.clone=function(){var a=new d(this._view.clone());a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;return a};b.setPadding=function(a,b,c,d){this.top=a;this.right=b||a;this.bottom=c||a;this.left=d||a};b.setMass=
function(a){this._mass=a};b.mass=function(){return this._mass};b.setSpeed=function(a){this._speed=a};b.speed=function(){return this._speed};b.setBehavior=function(a){this._behavior=a};b.behavior=function(){return this._behavior};b.setVelocity=function(a){this._velocity=a};b.velocity=function(){return this._velocity};b.draw=function(a){this._view.draw(a)};b.update=function(a,b){this._update(a,b)};b._update=function(a,b){var e=this._velocity,f=this._position,g=this._view;a-=this.right;b-=this.bottom;
e.truncate(c(this._speed));f.add(e);switch(this._behavior){case d.WRAP:this.wrap(a,b);break;default:this.bounce(a,b)}this.x=f.x;this.y=f.y;this.rotation=e.angle();g.x=f.x;g.y=f.y;g.rotation=e.angle();g.width=this.width;g.height=this.height};b.wrap=function(a,b){var c=this._position,d=!1,e=this.left,f=this.top;c.x>a&&(c.x=e,d=!0);c.x<e&&(c.x=a,d=!0);c.y>b&&(c.y=f,d=!0);c.y<f&&(c.y=b,d=!0);d&&this.dispatchEvent({type:"wrap",currentTarget:this})};b.bounce=function(a,b){var c=this._velocity,d=this._position,
e=!1,f=this.left,g=this.top;d.x>a?(d.x=a,c.x*=-1,e=!0):d.x<f&&(d.x=f,c.x*=-1,e=!0);d.y>b?(d.y=b,c.y*=-1,e=!0):d.y<g&&(d.y=g,c.y*=-1,e=!0);e&&this.dispatchEvent({type:"bounce",currentTarget:this})};return d}()})(window);
(function(k){var h=k.Sankaku,f=h.Vehicle,g=h.Vector2D;h.SteeredVehicle=function(){function e(b){f.call(this,b);this._force=new g;this._force_max=1;this._force_arrival=100;this._avoid_distance=300;this._avoid_buffer=20;this._avoid_insight=200;this._avoid_close=60}var d=0.5*Math.PI;h.extend(f,e);var c=e.prototype;c.constructor=h.SteeredVehicle;c.clone=function(){var b=Object.create(this);b.setView(this._view.clone());return b};c.max=function(){return this._force_max};c.setMax=function(b){this._force_max=
b};c.arrival=function(){return this._force_arrival};c.setArrival=function(b){this._force_arrival=b};c.setForce=function(b){this._force=b};c.force=function(){return this._force};c.setBuffer=function(b){this._avoid_buffer=b};c.buffer=function(){return this._avoid_buffer};c.setInsight=function(b){this._avoid_insight=b};c.insight=function(){return this._avoid_insight};c.setClose=function(b){this._avoid_close=b};c.close=function(){return this._avoid_close};c.setAvoidDistance=function(b){this._avoid_distance=
b};c.avoidDistance=function(){return this._avoid_distance};c.update=function(b,a){this._force.truncate(this._force_max).divideScalar(this._mass);this._velocity.add(this._force);this._force=new g;this._update(b,a)};c.seek=function(b){b=b.subNew(this._position);b.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.add(b)};c.flee=function(b){b=b.subNew(this._position);b.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.sub(b)};c.arrive=function(b){var a=b.subNew(this._position),
c=this._force_arrival;a.normalize();b=this._position.distance(b);b>c?a.multiplyScalar(this._speed):a.multiplyScalar(this._speed*b/c);a.sub(this._velocity);this._force.add(a)};c.pursue=function(b){var a=this._position.distance(b.position()),c=b.position().clone();c.add(b._velocity.multiplyNew(a));this.seek(c)};c.evade=function(b){var a=this._position.distance(b.position())/this._speed,c=b.position().clone();c.sub(b._velocity.multiplyNew(a));this.flee(c)};c.avoid=function(b){var a,c,e,f,g,h,k,n;k=0;
for(n=b.length;k<n;k++)a=b[k],c=this._velocity.clone().normalize(),e=a.position().subNew(this._position),f=e.dot(c),0<f&&(g=c.clone(),g.multiplyScalar(this._avoid_distance),h=c.clone(),h.multiplyScalar(f),f=h.subNew(e).length(),f<a.radius()+this._avoid_buffer&&h.length()<g.length()&&(a=c.clone(),a.multiplyScalar(this._speed),a.setAngle(a.angle()+e.sign(this._velocity)*d),e=h.length()/g.length(),a.multiplyScalar(1-e),this._force.add(a),this._velocity.multiplyScalar(e)))};return e}()})(window);
(function(k){var h=k.Sankaku,f=h.SteeredVehicle,g=h.Vector2D;h.Wander=function(){function e(b){f.call(this,b);this._wander_angle=0;this._wander_distance=10;this._wnder_radius=5;this._wander_range=1;this._wander_range2=0.5*this._wander_range}var d=Math.random;h.extend(f,e);var c=e.prototype;c.constructor=h.Wander;c.clone=function(){var b=Object.create(this);b.setView(this._view.clone());return b};c.setWanderAngle=function(b){this._wander_angle=b};c.wanderAngle=function(){return this._wander_angle};
c.setWanderDistance=function(b){this._wander_distance=b};c.wanderDistance=function(){return this._wander_distance};c.setWanderRadius=function(b){this._wnder_radius=b};c.wanderRadius=function(){return this._wnder_radius};c.setWanderRange=function(b){this._wander_range=b;this._wander_range2=0.5*b};c.wanderRange=function(){return this._wander_range};c.wander=function(){var b=this._velocity.clone().normalize().multiplyScalar(this._wander_distance),a=new g;a.setLength(this._wnder_radius);a.setAngle(this._wander_angle);
this._wander_angle+=d()*this._wander_range-this._wander_range2;b.add(a);this._force.add(b)};return e}()})(window);
(function(k){var h=k.Sankaku,f=h.SteeredVehicle,g=h.Vector2D;h.Flock=function(){function e(c){f.call(this,c);this._flock_insight=200;this._flock_close=60}h.extend(f,e);var d=e.prototype;d.constructor=h.Flock;d.clone=function(){var c=Object.create(this);c.setView(this._view.clone());return c};d.setInsight=function(c){this._flock_insight=c};d.insight=function(){return this._flock_insight};d.setClose=function(c){this._flock_close=c};d.close=function(){return this._flock_close};d.flock=function(c){var b=
this._velocity.clone(),a=new g,d=0,e,f,h;f=0;for(h=c.length;f<h;f++)e=c[f],e!==this&&this.tooInsight(e)&&(b.add(e.velocity()),a.add(e.position()),this.tooClose(e)&&this.flee(e.position()),++d);0<d&&(b.divideScalar(d),a.divideScalar(d),this.seek(a),this._force.add(b.sub(this._velocity)))};d.tooInsight=function(c){var b;if(this._position.distance(c._position)>this._flock_insight)return!1;b=this._velocity.clone().normalize();return 0>c._position.subNew(this._position).dot(b)};d.tooClose=function(c){return this._position.distance(c._position)<
this._flock_close};return e}()})(window);
(function(k){var h=k.Sankaku,f=h.SteeredVehicle;h.FollowPath=function(){function g(d){f.call(this,d);this._index=0;this._threshold=20}h.extend(f,g);var e=g.prototype;e.constructor=h.FollowPath;e.clone=function(){var d=Object.create(this);d.setView(this._view.clone());return d};e.follow=function(d,c){c=!!c;var b=d[this._index],a;b&&(a=d.length-1,this._position.distance(b)<this._threshold&&(this._index>=a?c&&(this._index=0):this._index++),this._index>=a&&!c?this.arrive(b):this.seek(b))};return g}()})(window);
(function(k){var h=k.Sankaku;h.Zanzo=function(){function f(e){this._limit=e;this._objects=[]}var g=f.prototype;g.constructor=h.Zanzo;g.limit=function(e){this._limit=e};g.add=function(e){var d=this._objects,c=[],b,a;0<this._limit&&d.length>=this._limit&&d.shift();b=0;for(a=e.length;b<a;b++)d=e[b],c.push(d.clone());this._objects.push(c)};g.draw=function(e,d){var c=this._objects,b,a,f,g,h,k,w;h=c.length;f=1/(h+1);e.save();for(g=0;g<h;g++)for(b=c[g],a=f*(g+1),e.globalAlpha=a,k=0,w=b.length;k<w;k++)a=
b[k],a.draw(e),d&&d.call(e);e.restore()};return f}()})(window);

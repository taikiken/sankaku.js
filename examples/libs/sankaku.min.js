/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/06/20 - 11:55

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 delaunay
 original: https://github.com/ironwallaby/delaunay

 hosted on
 https://github.com/taikiken/sankaku.js
*/
var Sankaku={version:"0.2.0"};
(function(h){h.console||(h.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}});Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var g=0,f=["ms","moz","webkit","o"],e=0;e<f.length&&!h.requestAnimationFrame;++e)h.requestAnimationFrame=h[f[e]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[f[e]+"CancelAnimationFrame"]||h[f[e]+"CancelRequestAnimationFrame"];void 0===h.requestAnimationFrame&&void 0!==h.setTimeout&&
(h.requestAnimationFrame=function(d){var b=Date.now(),c=Math.max(0,16-(b-g)),a=h.setTimeout(function(){d(b+c)},c);g=b+c;return a});void 0===h.cancelAnimationFrame&&void 0!==h.clearTimeout&&(h.cancelAnimationFrame=function(d){h.clearTimeout(d)});Object.create||(Object.create=function(){function d(){}return function(b){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");d.prototype=b;return new d}}());Array.isArray||(Array.isArray=function(d){return"[object Array]"===
Object.prototype.toString.call(d)});Array.prototype.indexOf||(Array.prototype.indexOf=function(d,b){var c;c=b?b:0;var a;if(!this)throw new TypeError;a=this.length;if(0===a||c>=a)return-1;for(0>c&&(c=a-Math.abs(c));c<a;c++)if(this[c]===d)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,b){var c,a;c=0;for(a=this.length;c<a;++c)c in this&&d.call(b,this[c],c,this)});Function.prototype.bind||(Function.prototype.bind=function(d){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var b=Array.prototype.slice.call(arguments,1),c=this,a=function(){},l=function(){return c.apply(this instanceof a&&d?this:d,b.concat(Array.prototype.slice.call(arguments)))};a.prototype=this.prototype;l.prototype=new a;return l});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL})()})(window.self);(function(h){h.Sankaku.extend=function(g,f){f.prototype=Object.create(g.prototype);f.prototype.constructor=f}})(window);
(function(h){h.EventDispatcher=function(){function g(){}var f=g.prototype;f.constructor=h.EventDispatcher;f.addEventListener=function(e,d){"undefined"===typeof this._listeners&&(this._listeners={});var b=this._listeners;"undefined"===typeof b[e]&&(b[e]=[]);-1===b[e].indexOf(d)&&b[e].push(d)};f.hasEventListener=function(e,d){var b=this._listeners;return"undefined"!==typeof b&&"undefined"!==typeof d[e]&&-1!==b[e].indexOf(d)?!0:!1};f.removeEventListener=function(e,d){if("undefined"!==typeof this._listeners){var b=
this._listeners[e],c;"undefined"!==typeof b&&(c=b.indexOf(d),-1!==c&&b.splice(c,1))}};f.dispatchEvent=function(e){var d=this._listeners,b,c;if("undefined"!==typeof d&&"undefined"!==typeof e.type&&(d=d[e.type],"undefined"!==typeof d))for(e.target=this,b=0,c=d.length;b<c;b++)d[b].call(this,e)};g.initialize=function(e){e.addEventListener=f.addEventListener;e.hasEventListener=f.hasEventListener;e.removeEventListener=f.removeEventListener;e.dispatchEvent=f.dispatchEvent};return g}()})(window.Sankaku);
(function(h){h.Sankaku.Iro=function(){function g(){throw Error("Iro can't create instance");}g.rgb2hsl=function(f,e,d){f/=255;e/=255;d/=255;var b=Math.max(f,e,d),c=Math.min(f,e,d),a,l,r;l=(b+c)/2;if(b===c)a=c=0;else{r=b-c;c=0.5<l?r/(2-b-c):r/(b+c);switch(b){case f:a=(e-d)/r+(e<d?6:0);break;case e:a=(d-f)/r+2;break;case d:a=(f-e)/r+4}a/=6}return{h:a,s:c,l:l}};g.hsl2rgb=function(f,e,d){function b(a,c,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(c-a)*b:0.5>b?c:b<2/3?a+(c-a)*(2/3-b)*6:a}if(0===e)d=e=
f=d;else{var c=0.5>d?d*(1+e):d+e-d*e,a=2*d-c;d=b(a,c,f+1/3);e=b(a,c,f);f=b(a,c,f-1/3)}return{r:255*d,g:255*e,b:255*f}};g.rgb2hsv=function(f,e,d){f/=255;e/=255;d/=255;var b=Math.max(f,e,d),c=Math.min(f,e,d),a,l=b-c;if(b===c)a=0;else{switch(b){case f:a=(e-d)/l+(e<d?6:0);break;case e:a=(d-f)/l+2;break;case d:a=(f-e)/l+4}a/=6}return{h:a,s:0===b?0:l/b,v:b}};g.hsv2rgb=function(f,e,d){var b,c,a,l=Math.floor(6*f),r=6*f-l;f=d*(1-e);var g=d*(1-r*e);e=d*(1-(1-r)*e);switch(l%6){case 0:b=d;c=e;a=f;break;case 1:b=
g;c=d;a=f;break;case 2:b=f;c=d;a=e;break;case 3:b=f;c=g;a=d;break;case 4:b=e;c=f;a=d;break;case 5:b=d,c=f,a=g}return{r:255*b,g:255*c,b:255*a}};g.hex2rgb=function(f){if("string"!==typeof f)return null;f=f.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,d,b,c){return d+d+b+b+c+c});return(f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f))?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:null};g.rgb2hex=function(f,e,d){function b(b){b=b.toString(16);return 1===b.length?"0"+b:b}
return"#"+b(f)+b(e)+b(d)};g.int2hex=function(f){f=Math.floor(f);f=f.toString(16);if(6>f.length)for(var e=6-f.length;e;)f="0"+f,--e;return"#"+f};return g}()})(window);
(function(h){h.Sankaku.List=function(){function g(){throw Error("List can't create instance");}var f=Math.random,e=Math.floor,d=Math.max;g.word=function(b,c){var a=[],l;for(l=0;l<b;l++)a[l]=c;return a};g.zero=function(b){return this.word(b,0)};g.shuffle=function(b){for(var c=[],a=b.length,l;a;)l=e(f()*b.length),l in b&&(c.push(b[l]),delete b[l],--a);return c};g.max=function(b){return d.apply(null,b)};return g}()})(window);
(function(h){h.Sankaku.Num=function(){function g(){throw Error("Num can't create instance");}var f=h.parseFloat,e=Math.random,d=Math.floor;g.ONE_DEG=Math.PI/180;g.is=function(b){return!isNaN(f(b))&&isFinite(b)};g.random=function(b,c){g.is(c)||(c=b,b=0);return b+d(e()*(c-b+1))};g.deg2rad=function(b){return b*g.ONE_DEG};return g}()})(window);
(function(h){h.Sankaku.Distribute=function(){function g(){throw Error("Distribute can't create instance");}var f=Math.sqrt,e=Math.sin,d=Math.cos,b=Math.random,c=2*Math.PI;g.circle=function(a,l,r){var g;a*=f(b());g=b()*c;return{x:0.5*l+d(g)*a,y:0.5*r+e(g)*a}};return g}()})(window);
(function(h){var g=Math.abs,f=Math.min,e=Math.max,d=Math.round;h.Sankaku.Triangle=function(){function b(a,b,c){this.a=a;this.b=b;this.c=c;var d=b.x-a.x,k=b.y-a.y,m=c.x-a.x,h=c.y-a.y,p=d*(a.x+b.x)+k*(a.y+b.y),q=m*(a.x+c.x)+h*(a.y+c.y),s=2*(d*(c.y-b.y)-k*(c.x-b.x));1E-6>g(s)?(m=f(a.x,b.x,c.x),p=f(a.y,b.y,c.y),d=0.5*(e(a.x,b.x,c.x)-m),a=0.5*(e(a.y,b.y,c.y)-p),this.x=m+d,this.y=p+a):(b=(h*p-k*q)/s,c=(d*q-m*p)/s,d=b-a.x,a=c-a.y,this.x=b,this.y=c);this.r=d*d+a*a}var c=b.prototype;c.constructor=b;c.draw=
function(a){var b=this.a,c=this.b,d=this.c;a.beginPath();a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.lineTo(d.x,d.y);a.closePath()};c.centroid=function(){return{x:d((this.a.x+this.b.x+this.c.x)/3),y:d((this.a.y+this.b.y+this.c.y)/3)}};return b}()})(window);
(function(h){h=h.Sankaku;var g=h.Triangle;h.Delaunay=function(){function f(){throw Error("Sankaku can't create instance.");}f.triangulate=function(e){if(3>e.length)return[];var d,b,c,a,l,f,n,k,m,h=function(a){var b=a.length,c,m,l,d,e;a:for(;b;)for(m=a[--b],c=a[--b],l=b;l;)if(e=a[--l],d=a[--l],c===d&&m===e||c===e&&m===d){a.splice(b,2);a.splice(l,2);b-=2;continue a}};e.sort(function(a,b){return b.x-a.x});b=e.length-1;d=e[b];c=d.x;a=e[0].x;for(f=l=d.y;b--;)d.y<l&&(l=d.y),d.y>f&&(f=d.y);n=a-c;k=f-l;b=
n>k?n:k;d=0.5*(a+c);n=0.5*(f+l);f=[new g({x:d-20*b,y:n-b,__sentinel:!0},{x:d,y:n+20*b,__sentinel:!0},{x:d+20*b,y:n-b,__sentinel:!0})];l=[];c=[];for(b=e.length;b--;){c.length=0;a=f.length;for(d=e[b];a--;)m=f[a],n=d.x-m.x,0<n&&n*n>m.r?(l.push(m),f.splice(a,1)):(k=d.y-m.y,n*n+k*k>m.r||(c.push(m.a,m.b,m.b,m.c,m.c,m.a),f.splice(a,1)));h(c);for(a=c.length;a;)k=c[--a],n=c[--a],f.push(new g(n,k,d))}Array.prototype.push.apply(l,f);for(b=l.length;b--;)e=l[b],(e.a.__sentinel||e.b.__sentinel||e.c.__sentinel)&&
l.splice(b,1);return l};return f}()})(window);
(function(h){h.Sankaku.Vector2D=function(){function g(a,b){this.x=a||0;this.y=b||0}var f=Math.floor,e=Math.ceil,d=Math.round,b=Math.cos,c=Math.sin,a=Math.atan2,l=Math.sqrt,r=Math.min,n=Math.acos,k=g.prototype;k.constructor=g;k.draw=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.x,this.y);a.closePath();return this};k.clone=function(){return new g(this.x,this.y)};k.zero=function(){this.y=this.x=0;return this};k.isZero=function(){return 0===this.x&&0===this.y};k.set=function(a,b){this.x=a;this.y=
b;return this};k.setX=function(a){this.x=a;return this};k.setY=function(a){this.y=a;return this};k.copy=function(a){this.x=a.x;this.y=a.y;return this};k.add=function(a){this.x+=a.x;this.y+=a.y;return this};k.addScalar=function(a){this.x+=a;this.y+=a;return this};k.addNew=function(a){return new g(this.x+a.x,this.y+a.y)};k.addVector=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this};k.sub=function(a){this.x-=a.x;this.y-=a.y;return this};k.subNew=function(a){return new g(this.x-a.x,this.y-a.y)};
k.subVector=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this};k.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};k.multiplyScalar=function(a){this.x*=a;this.y*=a;return this};k.multiplyNew=function(a){return new g(this.x*a.x,this.y*a.y)};k.divide=function(a){this.x/=a.x;this.y/=a.y;return this};k.divideScalar=function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this};k.divideNew=function(a){return new g(this.x/a.x,this.y/a.y)};k.min=function(a){this.x>a.x&&(this.x=
a.x);this.y>a.y&&(this.y=a.y);return this};k.max=function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this};k.clamp=function(a,b){this.min(a);this.max(b);return this};k.clampScalar=function(a,b){var c,l;c=new g;l=new g;c.set(a,a);l.set(b,b);return this.clamp(c,l)};k.floor=function(){this.x=f(this.x);this.y=f(this.y);return this};k.ceil=function(){this.x=e(this.x);this.y=e(this.y);return this};k.round=function(){this.x=d(this.x);this.y=d(this.y);return this};k.roundToZero=function(){this.x=
0>this.x?e(this.x):f(this.x);this.y=0>this.y?e(this.y):f(this.y);return this};k.negate=function(){return this.multiplyScalar(-1)};k.dot=function(a){return this.x*a.x+this.y*a.y};k.lengthSq=function(){return this.x*this.x+this.y*this.y};k.length=function(){return l(this.lengthSq())};k.setLength=function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this};k.setAngle=function(a){var l=this.length(),l=l||0.001;this.x=b(a)*l;this.y=c(a)*l;return this};k.angle=function(){return a(this.y,
this.x)};k.normalize=function(){return this.divideScalar(this.length())};k.distanceSq=function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a};k.distance=function(a){return l(this.distanceSq(a))};k.lerp=function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this};k.equals=function(a){return a.x===this.x&&a.y===this.y};k.fomArray=function(a){this.x=a[0];this.y=a[1];return this};k.toArray=function(){return[this.x,this.y]};k.truncate=function(a){a=r(a,this.length());return this.setLength(a)};
k.reverse=function(){this.negate();return this};k.isNormalize=function(){return 1===this.length()};k.prev=function(){return new g(-this.y,this.x)};k.sign=function(a){return 0>this.prev().dot(a)?-1:1};g.angleBetween=function(a,b){a.isNormalize()||(a=a.clone().normalize());b.isNormalize()||(b=b.clone().normalize());return n(a.dot(b))};return g}()})(window);
(function(h){h=h.Sankaku;var g=h.Vector2D,f=h.Num;h.Object2D=function(){function e(){this._position=new g;this.rotation=this.y=this.x=0;this.width=20;this.height=10;this.scale=1}var d=Math.cos,b=Math.sin,c=e.prototype;c.constructor=e;c.position=function(a){this._position=a;this.x=a.x;this.y=a.y};c.getPosition=function(){return this._position};c.setX=function(a){this.x=a;this._position.x=a};c.setY=function(a){this.y=a;this._position.y=a};c.bounding=function(){var a=this.x,c=this.y,e=this.width*this.scale*
0.5,f=this.height*this.scale*0.5,k=this.rotation,g,h,p,q,s,t;p=b(k);q=d(k);g=-e;h=-f;k=q*g;s=q*h;h*=p;g*=p;t=q*e;q*=f;e*=p;f*=p;return{a:{x:k-h+a,y:s+g+c},b:{x:t-h+a,y:s+e+c},c:{x:t-f+a,y:q+e+c},d:{x:k-f+a,y:q+g+c}}};c.rotate=function(a){this.rotation=f.deg2rad(a)};c.clone=function(){return this._clone()};c._clone=function(){var a=new e;a.position(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;return a};c.draw=function(a){};return e}()})(window);
(function(h){var g=h.Sankaku,f=g.Object2D,e=g.Vector2D,d=g.Iro;g.Shape=function(){function b(a,c,d,e,g,h){f.call(this);this.setX(a);this.setY(c);this.width=d||20;this.height=e||10;this._fill=h||b.STROKE;this._alpha=this._line=1;this._rgb={};this._color=g||"#000000";this.color(this._color);this.border(this.line,this._color)}g.extend(f,b);b.FILL="shape_fill";b.STROKE="shape_stroke";b.BOTH="shape_both";var c=b.prototype;c.constructor=b;c.getRadius=function(){var a=this.bounding(),b=a.a,a=a.c;return(new e(b.x,
b.y)).distance(a)};c.clone=function(){var a=new b(this.x,this.y,this.width,this.height,this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={line:this._border.line,rgb:this._border.rgb};return a};c.border=function(a,b){var c=d.hex2rgb(b);c.a=this._alpha;this._border={line:a,rgb:c};return this};c.color=function(a){this._color=a;this._rgb=d.hex2rgb(a);this._rgb.a=this._alpha;return this};c.alpha=function(a){this._alpha=
a;return this.color(this._color)};c.mode=function(a){this._fill=a;return this};c.getMode=function(){return this._fill};c.line=function(a){this._line=a;return this};c.getLine=function(){return this._line};c.draw=function(a){switch(this._fill){case b.STROKE:this.stroke(a,this._line,this._rgb);break;case b.FILL:this.fill(a,this._rgb);break;case b.BOTH:this.stroke(a,this._border._line,this._border._rgb),this.fill(a,this._rgb)}};c.fill=function(a,b){a.fillStyle="rgba("+b.r+","+b.g+","+b.b+","+b.a+")";
this.paint(a);a.fill()};c.stroke=function(a,b,c){a.lineWidth=b;a.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")";this.paint(a);a.stroke()};c.paint=function(a){var b=this.bounding(),c=b.a,d=b.b,e=b.c,b=b.d;a.beginPath();a.moveTo(c.x,c.y);a.lineTo(d.x,d.y);a.lineTo(e.x,e.y);a.lineTo(b.x,b.y);a.lineTo(c.x,c.y);a.closePath()};return b}()})(window);
(function(h){var g=h.Sankaku,f=g.Shape;g.Circle=function(){function e(b,a,d,e,g){f.call(this,b,a,d,d,e,g);this._radius=d||this.width}var d=2*Math.PI;g.extend(f,e);var b=e.prototype;b.constructor=e;b.getRadius=function(){return this._radius};b.clone=function(){var b=new e(this.x,this.y,this._radius,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={line:this._border.line,rgb:this._border.rgb};return b};
b.paint=function(b){b.beginPath();b.arc(this.x,this.y,this._radius,0,d,!1);b.closePath()};return e}()})(window);
(function(h){var g=h.Sankaku,f=g.Shape;g.Tripod=function(){function e(b,c,a,d,e,g){f.call(this,b,c,a,d,e,g)}g.extend(f,e);var d=e.prototype;d.constructor=e;d.clone=function(){var b=new e(this.x,this.y,this.width,this.height,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={line:this._border.line,rgb:this._border.rgb};return b};d.paint=function(b){var c=this.bounding(),a=c.a,d=c.b,e=c.c,c=c.d;b.beginPath();
b.moveTo(a.x,a.y);b.lineTo(d.x,d.y+0.5*(e.y-d.y));b.lineTo(c.x,c.y);b.lineTo(a.x,a.y);b.closePath()};return e}()})(window);
(function(h){var g=h.Sankaku,f=g.Vector2D,e=g.Object2D,d=g.Tripod;g.Vehicle=function(){function b(a){e.call(this);this._velocity=new f;this._mass=1;this._speed=10;this._behavior=b.BOUNCE;this.bottom=this.right=this.top=this.left=0;this.view(a||new d(this.x,this.y,this.width,this.height))}var c=Math.abs;g.extend(e,b);b.WRAP="vehicle_wrap";b.BOUNCE="vehicle_bounce";var a=b.prototype;a.constructor=b;g.EventDispatcher.initialize(a);a.view=function(a){a.position(this._position);this.width=a.width;this.height=
a.height;this.rotation=a.rotation;a.scale=this.scale;this._view=a};a.clone=function(){var a=new b(this._view.clone());a.position(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;return a};a.padding=function(a,b,c,d){this.top=a;this.right=b||a;this.bottom=c||a;this.left=d||a};a.mass=function(a){this._mass=a};a.getMass=function(){return this._mass};
a.speed=function(a){this._speed=a};a.getSpeed=function(){return this._speed};a.behavior=function(a){this._behavior=a};a.getBehavior=function(){return this._behavior};a.velocity=function(a){this._velocity=a};a.getVelocity=function(){return this._velocity};a.draw=function(a){this._view.draw(a)};a.getView=function(){return this._view};a.update=function(a,b){this._update(a,b)};a._update=function(a,d){var e=this._velocity,f=this._position,g=this._view;a-=this.right;d-=this.bottom;e.truncate(c(this._speed));
f.add(e);switch(this._behavior){case b.WRAP:this.wrap(a,d);break;default:this.bounce(a,d)}this.x=f.x;this.y=f.y;this.rotation=e.angle();g.x=f.x;g.y=f.y;g.rotation=e.angle();g.width=this.width;g.height=this.height};a.wrap=function(a,b){var c=this._position,d=!1,e=this.left,f=this.top;c.x>a&&(c.x=e,d=!0);c.x<e&&(c.x=a,d=!0);c.y>b&&(c.y=f,d=!0);c.y<f&&(c.y=b,d=!0);d&&this.dispatchEvent({type:"wrap",currentTarget:this})};a.bounce=function(a,b){var c=this._velocity,d=this._position,e=!1,f=this.left,g=
this.top;d.x>a?(d.x=a,c.x*=-1,e=!0):d.x<f&&(d.x=f,c.x*=-1,e=!0);d.y>b?(d.y=b,c.y*=-1,e=!0):d.y<g&&(d.y=g,c.y*=-1,e=!0);e&&this.dispatchEvent({type:"bounce",currentTarget:this})};return b}()})(window);
(function(h){var g=h.Sankaku,f=g.Vehicle,e=g.Vector2D;g.SteeredVehicle=function(){function d(){f.call(this);this._force=new e;this._force_max=1;this._force_arrival=100;this._avoid_distance=300;this._avoid_buffer=20;this._avoid_insight=200;this._avoid_close=60}var b=0.5*Math.PI;g.extend(f,d);var c=d.prototype;c.constructor=d;c.clone=function(){var a=Object.create(this);a.view(this._view.clone());return a};c.getMax=function(){return this._force_max};c.max=function(a){this._force_max=a};c.getArrival=
function(){return this._force_arrival};c.arrival=function(a){this._force_arrival=a};c.force=function(a){this._force=a};c.getForce=function(){return this._force};c.buffer=function(a){this._avoid_buffer=a};c.getBuffer=function(){return this._avoid_buffer};c.insight=function(a){this._avoid_insight=a};c.getInsight=function(){return this._avoid_insight};c.close=function(a){this._avoid_close=a};c.getClose=function(){return this._avoid_close};c.avoidDistance=function(a){this._avoid_distance=a};c.getAvoidDistance=
function(){return this._avoid_distance};c.update=function(a,b){this._force.truncate(this._force_max).divideScalar(this._mass);this._velocity.add(this._force);this._force=new e;this._update(a,b)};c.seek=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.add(a)};c.flee=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.sub(a)};c.arrive=function(a){var b=a.subNew(this._position),
c=this._force_arrival;b.normalize();a=this._position.distance(a);a>c?b.multiplyScalar(this._speed):b.multiplyScalar(this._speed*a/c);b.sub(this._velocity);this._force.add(b)};c.pursue=function(a){var b=this._position.distance(a.getPosition()),c=a.getPosition().clone();c.add(a._velocity.multiplyNew(b));this.seek(c)};c.evade=function(a){var b=this._position.distance(a.getPosition())/this._speed,c=a.getPosition().clone();c.sub(a._velocity.multiplyNew(b));this.flee(c)};c.avoid=function(a){var c,d,e,f,
g,h,p,q;p=0;for(q=a.length;p<q;p++)c=a[p],d=this._velocity.clone().normalize(),e=c.getPosition().subNew(this._position),f=e.dot(d),0<f&&(g=d.clone(),g.multiplyScalar(this._avoid_distance),h=d.clone(),h.multiplyScalar(f),f=h.subNew(e).length(),f<c.getRadius()+this._avoid_buffer&&h.length()<g.length()&&(c=d.clone(),c.multiplyScalar(this._speed),c.setAngle(e.sign(this._velocity)*b),e=h.length()/g.length(),c.multiplyScalar(1-e),this._force.add(c),this._velocity.multiplyScalar(e)))};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.SteeredVehicle,e=g.Vector2D;g.Wander=function(){function d(){f.call(this);this._angle=0;this._distance=10;this._radius=5;this._range=1;this._range2=0.5*this._range}var b=Math.random;g.extend(f,d);var c=d.prototype;c.constructor=d;c.clone=function(){var a=new d;a.position(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;a._force=
this._behavior;a._force=this._force.clone();a._force_max=this._force_max;a._force_arrival=this._force_arrival;a._avoid_distance=this._avoid_distance;a._avoid_buffer=this._avoid_buffer;a._avoid_insight=this._avoid_insight;a._avoid_close=this._avoid_close;a._angle=this._angle;a._distance=this._distance;a._radius=this._radius;a._range=this._range;a._range2=this._range2;return a};c.angle=function(a){this._angle=a};c.getAngle=function(){return this._angle};c.distance=function(a){this._distance=a};c.getDistance=
function(){return this._distance};c.radius=function(a){this._radius=a};c.getRadius=function(){return this._radius};c.range=function(a){this._range=a;this._range2=0.5*a};c.getRange=function(){return this._range};c.wander=function(){var a=this._velocity.clone().normalize().multiplyScalar(this._distance),c=new e;c.setLength(this._radius);c.setAngle(this._angle);this._angle=b()*this._range-this._range2;a.add(c);this._force.add(a)};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.SteeredVehicle,e=g.Vector2D;g.Flock=function(){function d(){f.call(this);this._flock_insight=200;this._flock_close=60}g.extend(f,d);var b=d.prototype;b.constructor=d;b.clone=function(){var b=Object.create(this);b.view(this._view.clone());return b};b.insight=function(b){this._flock_insight=b};b.getInsight=function(){return this._flock_insight};b.close=function(b){this._flock_close=b};b.getClose=function(){return this._flock_close};b.flock=function(b){var a=this._velocity.clone(),
d=new e,f=0,g,h,m;h=0;for(m=b.length;h<m;h++)g=b[h],g!==this&&this.tooInsight(g)&&(a.add(g.getVelocity()),d.add(g.getPosition()),this.tooClose(g)&&this.flee(g.getPosition()),++f);0<f&&(a.divideScalar(f),d.divideScalar(f),this.seek(d),this._force.add(a.sub(this._velocity)))};b.tooInsight=function(b){var a;if(this._position.distance(b._position)>this._flock_insight)return!1;a=this._velocity.clone().normalize();return 0>b._position.subNew(this._position).dot(a)};b.tooClose=function(b){return this._position.distance(b._position)<
this._flock_close};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.SteeredVehicle;g.FollowPath=function(){function e(){f.call(this);this._index=0;this._threshold=20}g.extend(f,e);var d=e.prototype;d.constructor=g.FollowPath;d.clone=function(){var b=new e;b.position(this._position.clone());b.width=this.width;b.height=this.height;b.rotation=this.rotation;b._velocity=this._velocity.clone();b._mass=this._mass;b._speed=this._speed;b._behavior=this._behavior;b._force=this._behavior;b._force=this._force.clone();b._force_max=this._force_max;
b._force_arrival=this._force_arrival;b._avoid_distance=this._avoid_distance;b._avoid_buffer=this._avoid_buffer;b._avoid_insight=this._avoid_insight;b._avoid_close=this._avoid_close;b._index=this._index;b._threshold=this._threshold;return b};d.follow=function(b,c){c=!!c;var a=b[this._index];a&&(this._position.distance(a)<this._threshold&&(this._index>=b.length-1?c&&(this._index=0):this._index++),this._index>b.length-1&&!c?this.arrive(a):this.seek(a))};return e}()})(window);
(function(h){h.Sankaku.Zanzo=function(){function g(e){this._limit=e;this._objects=[]}var f=g.prototype;f.constructor=g;f.limit=function(e){this._limit=e};f.add=function(e){var d=this._objects,b=[],c,a;0<this._limit&&d.length>=this._limit&&d.shift();c=0;for(a=e.length;c<a;c++)d=e[c],b.push(d.clone());this._objects.push(b)};f.draw=function(e,d){var b=this._objects,c,a,f,g,h,k,m;h=b.length;f=1/(h+1);e.save();for(g=0;g<h;g++)for(c=b[g],a=f*(g+1),e.globalAlpha=a,k=0,m=c.length;k<m;k++)a=c[k],a.draw(e),
d&&d.call(e);e.restore()};return g}()})(window);

/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/06/20 - 11:55

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 delaunay
 original: https://github.com/ironwallaby/delaunay

 canvas-toBlob.js
 A canvas.toBlob() implementation.
 2011-07-13

 By Eli Grey, http://eligrey.com and Devin Samarin, https://github.com/eboyjr
 License: X11/MIT
   See LICENSE.md
 @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js

 FileSaver.js
 A saveAs() FileSaver implementation.
 2014-05-27

 By Eli Grey, http://eligrey.com
 License: X11/MIT
   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js

 hosted on
 https://github.com/taikiken/sankaku.js
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/07/20 - 20:31

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.
*/
var Sankaku={version:"0.2.10"};
(function(h){h.console||(h.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}});Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var f=0,e=["ms","moz","webkit","o"],g=0;g<e.length&&!h.requestAnimationFrame;++g)h.requestAnimationFrame=h[e[g]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[e[g]+"CancelAnimationFrame"]||h[e[g]+"CancelRequestAnimationFrame"];void 0===h.requestAnimationFrame&&void 0!==h.setTimeout&&
(h.requestAnimationFrame=function(d){var c=Date.now(),b=Math.max(0,16-(c-f)),a=h.setTimeout(function(){d(c+b)},b);f=c+b;return a});void 0===h.cancelAnimationFrame&&void 0!==h.clearTimeout&&(h.cancelAnimationFrame=function(d){h.clearTimeout(d)});Object.create||(Object.create=function(){function d(){}return function(c){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");d.prototype=c;return new d}}());Array.isArray||(Array.isArray=function(d){return"[object Array]"===
Object.prototype.toString.call(d)});Array.prototype.indexOf||(Array.prototype.indexOf=function(d,c){var b;b=c?c:0;var a;if(!this)throw new TypeError;a=this.length;if(0===a||b>=a)return-1;for(0>b&&(b=a-Math.abs(b));b<a;b++)if(this[b]===d)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,c){var b,a;b=0;for(a=this.length;b<a;++b)b in this&&d.call(c,this[b],b,this)});Function.prototype.bind||(Function.prototype.bind=function(d){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var c=Array.prototype.slice.call(arguments,1),b=this,a=function(){},k=function(){return b.apply(this instanceof a&&d?this:d,c.concat(Array.prototype.slice.call(arguments)))};a.prototype=this.prototype;k.prototype=new a;return k});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL})()})(window.self);(function(h){h.Sankaku.extend=function(f,e){e.prototype=Object.create(f.prototype);e.prototype.constructor=e}})(window);
(function(h){var f=h.Uint8Array;h=h.HTMLCanvasElement;var e=/\s*;\s*base64\s*(?:;|$)/i,g;f&&(g=new f([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]));h&&!h.prototype.toBlob&&(h.prototype.toBlob=function(d,c){c||(c="image/png");if(this.mozGetAsFile)d(this.mozGetAsFile("canvas",c));else{var b=Array.prototype.slice.call(arguments,
1),a=this.toDataURL.apply(this,b),k=a.indexOf(","),b=a.substring(k+1),a=e.test(a.substring(0,k)),m;if(Blob.fake)m=new Blob,m.encoding=a?"base64":"URI",m.data=b,m.size=b.length;else if(f)if(a){m=Blob;for(var a=b.length,k=new f(a/4*3|0),n=0,l=0,p=[0,0],z=0,h=0,u,q;a--;)q=b.charCodeAt(n++),u=g[q-43],255!==u&&void 0!==u&&(p[1]=p[0],p[0]=q,h=h<<6|u,z++,4===z&&(k[l++]=h>>>16,61!==p[1]&&(k[l++]=h>>>8),61!==p[0]&&(k[l++]=h),z=0));m=new m([new f(k.buffer)],{type:c})}else m=new Blob([new f(decodeURIComponent(b))],
{type:c});d(m)}})})(self);
(function(h){h.EventDispatcher=function(){function f(){}var e=f.prototype;e.constructor=f;e.addEventListener=function(g,d){"undefined"===typeof this._listeners&&(this._listeners={});var c=this._listeners;"undefined"===typeof c[g]&&(c[g]=[]);-1===c[g].indexOf(d)&&c[g].push(d)};e.hasEventListener=function(g,d){var c=this._listeners;return"undefined"!==typeof c&&"undefined"!==typeof d[g]&&-1!==c[g].indexOf(d)?!0:!1};e.removeEventListener=function(g,d){if("undefined"!==typeof this._listeners){var c=this._listeners[g],
b;"undefined"!==typeof c&&(b=c.indexOf(d),-1!==b&&c.splice(b,1))}};e.dispatchEvent=function(g){var d=this._listeners,c,b;if("undefined"!==typeof d&&"undefined"!==typeof g.type&&(d=d[g.type],"undefined"!==typeof d))for(g.target=this,c=0,b=d.length;c<b;c++)d[c].call(this,g)};f.initialize=function(g){g.addEventListener=e.addEventListener;g.hasEventListener=e.hasEventListener;g.removeEventListener=e.removeEventListener;g.dispatchEvent=e.dispatchEvent};return f}()})(window.Sankaku);
(function(h){var f=h.Sankaku;f.LoadImage=function(){function e(d){this._path=d}e.COMPLETE="load_image_complete";e.ERROR="load_image_error";var g=e.prototype;g.constructor=e;f.EventDispatcher.initialize(g);g.clone=function(){return new e(this._path)};g.load=function(){function d(){k.removeEventListener("load",c);k.removeEventListener("error",b);return!0}function c(){d();m.dispatchEvent({type:e.COMPLETE,currentTarget:m,path:a,img:k})}function b(){d();m.dispatchEvent({type:e.ERROR,currentTarget:m,path:a})}
var a=this._path,k=new Image,m=this;k.addEventListener("load",c,!1);k.addEventListener("error",b,!1);k.src=a};return e}()})(window);
(function(h){function f(){}var e=h.Sankaku,g=g||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(d){if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var c=d.document,b=c.createElementNS("http://www.w3.org/1999/xhtml","a"),a=!d.externalHost&&"download"in b,k=function(a){var b=c.createEvent("MouseEvents");b.initMouseEvent("click",!0,!1,d,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)},m=d.webkitRequestFileSystem,
n=d.requestFileSystem||m||d.mozRequestFileSystem,l=function(a){(d.setImmediate||d.setTimeout)(function(){throw a;},0)},p=0,g=[],e=function(){for(var a=g.length;a--;){var b=g[a];"string"===typeof b?(d.URL||d.webkitURL||d).revokeObjectURL(b):b.remove()}g.length=0},f=function(a,b,k){b=[].concat(b);for(var m=b.length;m--;){var c=a["on"+b[m]];if("function"===typeof c)try{c.call(a,k||a)}catch(p){l(p)}}},q=function(c,l){var e=this,s=c.type,r=!1,q,t,A=function(){var a=(d.URL||d.webkitURL||d).createObjectURL(c);
g.push(a);return a},B=function(){f(e,["writestart","progress","write","writeend"])},x=function(){if(r||!q)q=A(c);t?t.location.href=q:h.open(q,"_blank");e.readyState=e.DONE;B()},y=function(a){return function(){if(e.readyState!==e.DONE)return a.apply(this,arguments)}},C={create:!0,exclusive:!1},D;e.readyState=e.INIT;l||(l="download");if(a)q=A(c),b.href=q,b.download=l,k(b),e.readyState=e.DONE,B();else{d.chrome&&s&&"application/octet-stream"!==s&&(D=c.slice||c.webkitSlice,c=D.call(c,0,c.size,"application/octet-stream"),
r=!0);m&&"download"!==l&&(l+=".download");if("application/octet-stream"===s||m)t=d;n?(p+=c.size,n(d.TEMPORARY,p,y(function(a){a.root.getDirectory("saved",C,y(function(a){var b=function(){a.getFile(l,C,y(function(a){a.createWriter(y(function(b){b.onwriteend=function(b){t.location.href=a.toURL();g.push(a);e.readyState=e.DONE;f(e,"writeend",b)};b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&x()};["writestart","progress","write","abort"].forEach(function(a){b["on"+a]=e["on"+a]});b.write(c);
e.abort=function(){b.abort();e.readyState=e.DONE};e.readyState=e.WRITING}),x)}),x)};a.getFile(l,{create:!1},y(function(a){a.remove();b()}),y(function(a){a.code===a.NOT_FOUND_ERR?b():x()}))}),x)}),x)):x()}},r=q.prototype,t=function(a,b){return new q(a,b)};r.abort=function(){this.readyState=this.DONE;f(this,"abort")};r.readyState=r.INIT=0;r.WRITING=1;r.DONE=2;r.error=r.onwritestart=r.onprogress=r.onwrite=r.onabort=r.onerror=r.onwriteend=null;d.addEventListener("unload",e,!1);t.unload=function(){e();
d.removeEventListener("unload",e,!1)};return t}}("undefined"!==typeof self&&self||"undefined"!==typeof h&&h||this.content);f.prototype.constructor=e.FileSave;f.saveAs=g;e.FileSave=f})(window);
(function(h){h.Sankaku.Iro=function(){function f(){throw Error("Iro can't create instance");}f.rgb2hsl=function(e,g,d){e/=255;g/=255;d/=255;var c=Math.max(e,g,d),b=Math.min(e,g,d),a,k,m;k=(c+b)/2;if(c===b)a=b=0;else{m=c-b;b=0.5<k?m/(2-c-b):m/(c+b);switch(c){case e:a=(g-d)/m+(g<d?6:0);break;case g:a=(d-e)/m+2;break;case d:a=(e-g)/m+4}a/=6}return{h:a,s:b,l:k}};f.hsl2rgb=function(e,g,d){function c(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}if(0===g)d=g=
e=d;else{var b=0.5>d?d*(1+g):d+g-d*g,a=2*d-b;d=c(a,b,e+1/3);g=c(a,b,e);e=c(a,b,e-1/3)}return{r:255*d,g:255*g,b:255*e}};f.rgb2hsv=function(e,g,d){e/=255;g/=255;d/=255;var c=Math.max(e,g,d),b=Math.min(e,g,d),a,k=c-b;if(c===b)a=0;else{switch(c){case e:a=(g-d)/k+(g<d?6:0);break;case g:a=(d-e)/k+2;break;case d:a=(e-g)/k+4}a/=6}return{h:a,s:0===c?0:k/c,v:c}};f.hsv2rgb=function(e,g,d){var c,b,a,k=Math.floor(6*e),m=6*e-k;e=d*(1-g);var n=d*(1-m*g);g=d*(1-(1-m)*g);switch(k%6){case 0:c=d;b=g;a=e;break;case 1:c=
n;b=d;a=e;break;case 2:c=e;b=d;a=g;break;case 3:c=e;b=n;a=d;break;case 4:c=g;b=e;a=d;break;case 5:c=d,b=e,a=n}return{r:255*c,g:255*b,b:255*a}};f.hex2rgb=function(e){if("string"!==typeof e)return null;e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,d,c,b){return d+d+c+c+b+b});return(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null};f.rgb2hex=function(e,g,d){function c(b){b=b.toString(16);return 1===b.length?"0"+b:b}
return"#"+c(e)+c(g)+c(d)};f.int2hex=function(e){e=Math.floor(e);e=e.toString(16);if(6>e.length)for(var g=6-e.length;g;)e="0"+e,--g;return"#"+e};return f}()})(window);
(function(h){h.Sankaku.List=function(){function f(){throw Error("List can't create instance");}var e=Math.random,g=Math.floor,d=Math.max;f.word=function(c,b){var a=[],k;for(k=0;k<c;k++)a[k]=b;return a};f.zero=function(c){return this.word(c,0)};f.shuffle=function(c){for(var b=[],a=c.length,k;a;)k=g(e()*c.length),k in c&&(b.push(c[k]),delete c[k],--a);return b};f.max=function(c){return d.apply(null,c)};return f}()})(window);
(function(h){h.Sankaku.Num=function(){function f(){throw Error("Num can't create instance");}var e=h.parseFloat,g=Math.random,d=Math.floor,c=Math.PI;f.ONE_DEG=c/180;f.FORTY_FIVE=c/4;f.NINETY=c/2;f.ONE_EIGHTY=c;f.THREE_SIXTY=2*c;f.is=function(b){return!isNaN(e(b))&&isFinite(b)};f.random=function(b,a){f.is(a)||(a=b,b=0);return b+d(g()*(a-b+1))};f.deg2rad=function(b){return b*f.ONE_DEG};return f}()})(window);
(function(h){h.Sankaku.Distribute=function(){function f(){throw Error("Distribute can't create instance");}var e=Math.sqrt,g=Math.sin,d=Math.cos,c=Math.random,b=2*Math.PI;f.circle=function(a,k,m){var n;a*=e(c());n=c()*b;return{x:0.5*k+d(n)*a,y:0.5*m+g(n)*a}};return f}()})(window);
(function(h){h.Sankaku.Vector2D=function(){function f(a,b){this.x=a||0;this.y=b||0}var e=Math.floor,g=Math.ceil,d=Math.round,c=Math.cos,b=Math.sin,a=Math.atan2,k=Math.sqrt,m=Math.min,n=Math.acos,l=f.prototype;l.constructor=f;l.draw=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.x,this.y);a.closePath();return this};l.clone=function(){return new f(this.x,this.y)};l.zero=function(){this.y=this.x=0;return this};l.isZero=function(){return 0===this.x&&0===this.y};l.set=function(a,b){this.x=a;this.y=
b;return this};l.setX=function(a){this.x=a;return this};l.setY=function(a){this.y=a;return this};l.copy=function(a){this.x=a.x;this.y=a.y;return this};l.add=function(a){this.x+=a.x;this.y+=a.y;return this};l.addScalar=function(a){this.x+=a;this.y+=a;return this};l.addNew=function(a){return new f(this.x+a.x,this.y+a.y)};l.addVector=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this};l.sub=function(a){this.x-=a.x;this.y-=a.y;return this};l.subNew=function(a){return new f(this.x-a.x,this.y-a.y)};
l.subVector=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this};l.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};l.multiplyScalar=function(a){this.x*=a;this.y*=a;return this};l.multiplyNew=function(a){return new f(this.x*a.x,this.y*a.y)};l.divide=function(a){this.x/=a.x;this.y/=a.y;return this};l.divideScalar=function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this};l.divideNew=function(a){return new f(this.x/a.x,this.y/a.y)};l.min=function(a){this.x>a.x&&(this.x=
a.x);this.y>a.y&&(this.y=a.y);return this};l.max=function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this};l.clamp=function(a,b){this.min(a);this.max(b);return this};l.clampScalar=function(a,b){var k,c;k=new f;c=new f;k.set(a,a);c.set(b,b);return this.clamp(k,c)};l.floor=function(){this.x=e(this.x);this.y=e(this.y);return this};l.ceil=function(){this.x=g(this.x);this.y=g(this.y);return this};l.round=function(){this.x=d(this.x);this.y=d(this.y);return this};l.roundToZero=function(){this.x=
0>this.x?g(this.x):e(this.x);this.y=0>this.y?g(this.y):e(this.y);return this};l.negate=function(){return this.multiplyScalar(-1)};l.dot=function(a){return this.x*a.x+this.y*a.y};l.lengthSq=function(){return this.x*this.x+this.y*this.y};l.length=function(){return k(this.lengthSq())};l.setLength=function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this};l.setAngle=function(a){var k=this.length(),k=k||0.001;this.x=c(a)*k;this.y=b(a)*k;return this};l.angle=function(){return a(this.y,
this.x)};l.normalize=function(){return this.divideScalar(this.length())};l.distanceSq=function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a};l.distance=function(a){return k(this.distanceSq(a))};l.lerp=function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this};l.equals=function(a){return a.x===this.x&&a.y===this.y};l.fromArray=function(a){this.x=a[0];this.y=a[1];return this};l.toArray=function(){return[this.x,this.y]};l.truncate=function(a){a=m(a,this.length());return this.setLength(a)};
l.reverse=function(){this.negate();return this};l.isNormalize=function(){return 1===this.length()};l.perpendicular=function(){return new f(-this.y,this.x)};l.sign=function(a){return 0>this.perpendicular().dot(a)?-1:1};f.angleBetween=function(a,b){a.isNormalize()||(a=a.clone().normalize());b.isNormalize()||(b=b.clone().normalize());return n(a.dot(b))};return f}()})(window);
(function(h){var f=Math.abs,e=Math.min,g=Math.max,d=Math.round;h.Sankaku.Triangle=function(){function c(a,b,c){this.a=a;this.b=b;this.c=c;var d=b.x-a.x,l=b.y-a.y,p=c.x-a.x,h=c.y-a.y,s=d*(a.x+b.x)+l*(a.y+b.y),u=p*(a.x+c.x)+h*(a.y+c.y),q=2*(d*(c.y-b.y)-l*(c.x-b.x));1E-6>f(q)?(p=e(a.x,b.x,c.x),s=e(a.y,b.y,c.y),d=0.5*(g(a.x,b.x,c.x)-p),a=0.5*(g(a.y,b.y,c.y)-s),this.x=p+d,this.y=s+a):(b=(h*s-l*u)/q,c=(d*u-p*s)/q,d=b-a.x,a=c-a.y,this.x=b,this.y=c);this.r=d*d+a*a}var b=c.prototype;b.constructor=c;b.draw=
function(a){var b=this.a,c=this.b,d=this.c;a.beginPath();a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.lineTo(d.x,d.y);a.closePath()};b.centroid=function(){return{x:d((this.a.x+this.b.x+this.c.x)/3),y:d((this.a.y+this.b.y+this.c.y)/3)}};return c}()})(window);
(function(h){h=h.Sankaku;var f=h.Triangle;h.Delaunay=function(){function e(){throw Error("Sankaku can't create instance.");}e.triangulate=function(e){if(3>e.length)return[];var d,c,b,a,k,m,n,l,p,h=function(a){var b=a.length,c,k,m,d,e;a:for(;b;)for(k=a[--b],c=a[--b],m=b;m;)if(e=a[--m],d=a[--m],c===d&&k===e||c===e&&k===d){a.splice(b,2);a.splice(m,2);b-=2;continue a}};e.sort(function(a,b){return b.x-a.x});c=e.length-1;d=e[c];b=d.x;a=e[0].x;for(m=k=d.y;c--;)d.y<k&&(k=d.y),d.y>m&&(m=d.y);n=a-b;l=m-k;c=
n>l?n:l;d=0.5*(a+b);n=0.5*(m+k);m=[new f({x:d-20*c,y:n-c,__sentinel:!0},{x:d,y:n+20*c,__sentinel:!0},{x:d+20*c,y:n-c,__sentinel:!0})];k=[];b=[];for(c=e.length;c--;){b.length=0;a=m.length;for(d=e[c];a--;)p=m[a],n=d.x-p.x,0<n&&n*n>p.r?(k.push(p),m.splice(a,1)):(l=d.y-p.y,n*n+l*l>p.r||(b.push(p.a,p.b,p.b,p.c,p.c,p.a),m.splice(a,1)));h(b);for(a=b.length;a;)l=b[--a],n=b[--a],m.push(new f(n,l,d))}Array.prototype.push.apply(k,m);for(c=k.length;c--;)e=k[c],(e.a.__sentinel||e.b.__sentinel||e.c.__sentinel)&&
k.splice(c,1);return k};return e}()})(window);
(function(h){var f=h.Sankaku,e=f.Vector2D,g=f.Num,d=f.Iro;f.Object2D=function(){function c(){this._position=new e;this.rotation=this.y=this.x=0;this.width=20;this.height=10;this.scale=1;this.parent=this.scene=null;this.children=[];this.visible=!0;this._alpha=1}var b=Math.cos,a=Math.sin,k=c.prototype;k.constructor=c;f.EventDispatcher.initialize(k);k.clone=function(){return this._clone()};k._clone=function(){var a=new c;a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=
this.rotation;a.scale=this.scale;a.parent=parent&&parent.clone();a._alpha=this._alpha;a.visible=this.visible;a.children=this.children.splice();a.setColor(this._color);return a};k.setColor=function(a){this._color=a;this._rgb=d.hex2rgb(a);this._rgb.a=this._alpha;return this};k.rgba=function(){return this._rgb};k.setAlpha=function(a){this._alpha=a;return this.setColor(this._color)};k.alpha=function(){return this._alpha};k.setPosition=function(a){this._position=a;this.x=a.x;this.y=a.y;return this};k.position=
function(){return this._position};k.setX=function(a){this.x=a;this._position.x=a;return this};k.setY=function(a){this.y=a;this._position.y=a;return this};k.bounding=function(){var c=this.parent,k=this.x,d=this.y,e=this.width*this.scale,g=this.height*this.scale,e=0.5*e,g=0.5*g,f=this.rotation,h,q,r,t,v,w;q={scale:this.scale,rotation:this.rotation,alpha:this._alpha,x:this.x,y:this.y};c&&this.scene!==c&&(h=c.bounding(),k*=h.e.scale,d*=h.e.scale,e=this.width*h.e.scale,g=this.height*h.e.scale,e*=0.5,g*=
0.5,f=h.e.rotation+this.rotation,w=c.x+k*b(h.e.rotation)-d*a(h.e.rotation),d=c.y+k*a(h.e.rotation)+d*b(h.e.rotation),k=w,q.scale=h.e.scale*this.scale,q.alpha=h.e.alpha*this._alpha,q.rotation=f);h=a(f);v=b(f);c=-e;f=-g;r=e;t=g;e=v*c;g=v*f;f*=h;c*=h;w=v*r;v*=t;r*=h;t*=h;h={x:e-f+k,y:g+c+d};g={x:w-f+k,y:g+r+d};f={x:w-t+k,y:v+r+d};e={x:e-t+k,y:v+c+d};q.x=k;q.y=d;return this._bounding=k={a:h,b:g,c:f,d:e,e:q}};k.setRotate=function(a){this.rotation=g.deg2rad(a);return this};k.add=function(a){if(a===this)return this;
a.parent&&a.parent.remove(a);a.parent=this;this.children.push(a);var b=this.scene;b&&b.addChild(a);return this};k.remove=function(a){var b;b=this.children.indexOf(a);if(-1===b)return this;a.parent=null;this.children.splice(b,1);(b=this.scene)&&b.removeChild(a);return this};k.draw=function(a){this.visible&&0<this._alpha&&0<this.scale&&this._draw(a);var b=this.children,c,k;c=0;for(k=b.length;c<k;c++)b[c].draw(a);return this};k._draw=function(a){};k.inside=function(a,b){this.visible&&(b=this._inside(a,
b));var c=this.children,k,d;k=0;for(d=c.length;k<d;k++)b=c[k].inside(a,b);return b};k._area=function(a,b,c){return c.x*b.y-b.x*c.y-(c.x*a.y-a.x*c.y)+(b.x*a.y-a.x*b.y)};k._inside=function(a,b){var c=this.bounding();0<this._area(c.a,c.b,a)||0<this._area(c.b,c.c,a)||0<this._area(c.c,c.d,a)||0<this._area(c.d,c.a,a)||b.push(this);return b};k.swap=function(a,b){var c=this.children,k=c.indexOf(a),d=c.indexOf(b);-1!==k&&-1!==d&&(c[d]=a,c[k]=b);return this};k.highest=function(a){var b=this.children,c=b.indexOf(a);
-1!==c&&(b.splice(c,1),b.push(a));return this};k.render=function(a,b){this.beginRender(a,b);var c=this.children,k,d;k=0;for(d=c.length;k<d;k++)c[k].render(a,b);return this};k.beginRender=function(a,b){this.prepareRender(a,b)};k.prepareRender=function(a,b){};k._rgba=function(a,b){return{r:a.r,g:a.g,b:a.b,a:a.a*b}};return c}()})(window);
(function(h){var f=h.Sankaku,e=f.Object2D;f.Scene=function(){function g(){e.call(this);this.scene=this}f.extend(e,g);var d=g.prototype;d.constructor=g;d.addChild=function(c){c.scene=this};d.removeChild=function(c){c.scene=null};d.inside=function(c,b){var a=this.children,k,d;k=0;for(d=a.length;k<d;k++)b=a[k].inside(c,b);return b};return g}()})(window);
(function(h){var f=h.Sankaku,e=f.Object2D,g=f.Vector2D,d=f.Iro;f.Shape=function(){function c(a,b,d,g,f,h){e.call(this);this.setX(a);this.setY(b);this.width=d||20;this.height=g||10;this._fill=h||c.STROKE;this._line=1;this._rgb={r:0,g:0,b:0};this._color=f=f||"#000000";this.setColor(f);this.setBorder(this.setLine,this._color)}f.extend(e,c);c.FILL="shape_fill";c.STROKE="shape_stroke";c.BOTH="shape_both";var b=c.prototype;b.constructor=c;b.clone=function(){var a=new c(this.x,this.y,this.width,this.height,
this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={setLine:this._border.setLine,rgb:this._border.rgb};return a};b.radius=function(){var a=this.bounding(),b=a.a,a=a.c;return 0.5*(new g(b.x,b.y)).distance(new g(a.x,a.y))};b.setBorder=function(a,b){var c=d.hex2rgb(b);c.a=this._alpha;this._border={setLine:a,rgb:c};return this};b.setMode=function(a){this._fill=a;return this};b.mode=function(){return this._fill};
b.setLine=function(a){this._line=a;return this};b.line=function(){return this._line};b._draw=function(a){var b=this.paint(a),d=this._rgba(this._rgb,b.e.alpha);switch(this._fill){case c.STROKE:this.stroke(a,this._line,d);break;case c.FILL:this.fill(a,d);break;case c.BOTH:b=this._rgba(this._border._rgb,b.e.alpha),this.stroke(a,this._border._line,b),this.fill(a,d)}};b.fill=function(a,b){a.fillStyle="rgba("+b.r+","+b.g+","+b.b+","+b.a+")";a.fill()};b.stroke=function(a,b,c){a.lineWidth=b;a.strokeStyle=
"rgba("+c.r+","+c.g+","+c.b+","+c.a+")";a.stroke()};b.paint=function(a){var b=this.bounding(),c=b.a,d=b.b,e=b.c,g=b.d;a.beginPath();a.moveTo(c.x,c.y);a.lineTo(d.x,d.y);a.lineTo(e.x,e.y);a.lineTo(g.x,g.y);a.lineTo(c.x,c.y);a.closePath();return b};return c}()})(window);
(function(h){var f=h.Sankaku,e=f.Shape;f.Circle=function(){function g(a,b,c,d,g){e.call(this,a,b,2*c,2*c,d,g);this._radius=c||this.width}var d=2*Math.PI,c=Math.pow;f.extend(e,g);var b=g.prototype;b.constructor=g;b.radius=function(){return this._radius*this.scale};b.clone=function(){var a=new g(this.x,this.y,this._radius,this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={line:this._border.line,rgb:this._border.rgb};
return a};b.paint=function(a){var b=this.bounding(),c=b.e;a.beginPath();a.arc(c.x,c.y,this._radius*c.scale,0,d,!1);a.closePath();return b};b._inside=function(a,b){var d=this._radius;c(this.x-a.x,2)+c(this.y-a.y,2)<d*d&&b.push(this);return b};b.contain=function(a){var b=[];this._inside(a,b);return 0<b.length};return g}()})(window);
(function(h){var f=h.Sankaku,e=f.Shape;f.Tripod=function(){function g(c,b,a,k,d,g){e.call(this,c,b,a,k,d,g)}f.extend(e,g);var d=g.prototype;d.constructor=g;d.clone=function(){var c=new g(this.x,this.y,this.width,this.height,this._color,this._fill);c.rotation=this.rotation;c.scale=this.scale;c._alpha=this._alpha;c._rgb=Object.create(this._rgb);c._line=this._line;c._border={line:this._border.line,rgb:this._border.rgb};return c};d.paint=function(c){var b=this.bounding(),a=b.a,k=b.b,d=b.c,e=b.d;c.beginPath();
c.moveTo(a.x,a.y);c.lineTo(0.5*(k.x+d.x),0.5*(k.y+d.y));c.lineTo(e.x,e.y);c.lineTo(a.x,a.y);c.closePath();return b};d._inside=function(c,b){var a=this.bounding(),k=a.b,d=a.c,k={x:0.5*(k.x+d.x),y:0.5*(k.y+d.y)};0<this._area(a.a,k,c)||0<this._area(k,a.d,c)||0<this._area(a.d,a.a,c)||b.push(this);return b};return g}()})(window);
(function(h){var f=h.Sankaku,e=f.Shape,g=f.Num;f.Star=function(){function d(a,b,c,d,g,f,h){e.call(this,a,b,c,c,d,g);this._radius=c||this.width;this._points=f||5;this._inner=h||0.475*c}var c=Math.sin,b=Math.cos;f.extend(e,d);var a=d.prototype;a.constructor=d;a.radius=function(){return this._radius};a.clone=function(){var a=new d(this.x,this.y,this._radius,this._color,this._fill,this._points);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;
a._border={line:this._border.line,rgb:this._border.rgb};return a};a.paint=function(a){var d=this.bounding(),e=d.e,f=this._points,h=2*f,f=g.ONE_EIGHTY/f,z=g.NINETY,s=e.scale,u=this._radius*s,s=this._inner*s,q=e.x,r=e.y,e=e.rotation,t,v,w;a.beginPath();for(t=0;t<=h;++t)v=t*f-z+e,w=t%2?s:u,a.lineTo(q+w*b(v),r+w*c(v));a.closePath();return d};return d}()})(window);
(function(h){var f=h.Sankaku,e=f.Object2D,g=f.Shape;f.Line=function(){function d(b,a,c,d){e.call(this);this._v1=b;this._v2=a;this._fill=g.STROKE;this._line=d||1;this._rgb={r:0,g:0,b:0};this._color=c=c||"#000000";this.setColor(c)}f.extend(e,d);var c=d.prototype;c.constructor=d;c._clone=function(){var b=new d(this._v1,this._v2,this._color,this._line);b.setAlpha(this._alpha);b.scale=this.scale;b.visible=this.visible;b.setColor(this._color);return b};c.setPosition=function(b){return this};c.setX=function(b){return this};
c.setY=function(b){return this};c.setRotate=function(b){return this};c.add=function(b){return this};c.remove=function(){return this};c.bounding=function(){var b=this.parent,a;a={scale:this.scale,rotation:this.rotation,alpha:this._alpha,x:this.x,y:this.y};b&&this.scene!==b&&(a.scale=b.scale*this.scale,a.alpha=b.alpha()*this._alpha);return this._bounding=b={e:a,a:this._v1.bounding().e,b:this._v2.bounding().e}};c._inside=function(b,a){return a};c._draw=function(b){var a=this.paint(b),a=this._rgba(this._rgb,
a.e.alpha);this.stroke(b,this._line,a)};c.stroke=function(b,a,c){b.lineWidth=a;b.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")";b.stroke()};c.paint=function(b){var a=this._v1.bounding().e,c=this._v2.bounding().e,d=this.bounding();b.beginPath();b.lineTo(a.x,a.y);b.lineTo(c.x,c.y);b.closePath();return d};return d}()})(window);
(function(h){var f=h.Sankaku,e=f.Shape,g=f.LoadImage;f.Bitmap=function(){function d(b,a,c,d,h){e.call(this,b,a,c,d);b=this.onLoad.bind(this);a=this.onError.bind(this);this._boundLoad=b;this._boundError=a;this._fill=e.FILL;this._img=h;this._bitmap=null;h.constructor===f.LoadImage?(h.addEventListener(g.COMPLETE,b),h.addEventListener(g.ERROR,a),h.load()):h.constructor===Image&&(this._bitmap=h)}f.extend(e,d);var c=d.prototype;c.constructor=d;c.dispose=function(){var b=this._img;b.removeEventListener(g.COMPLETE,
this._boundLoad);b.removeEventListener(g.ERROR,this._boundError)};c.onLoad=function(b){this.dispose();this._bitmap=b.img};c.onError=function(){this.dispose()};c.clone=function(){var b=this._img,a;b.constructor===f.LoadImage?a=b.clone():(a=new Image,a.src=b.src);return new d(this.x,this.y,this.width,this.height,a)};c.setMode=function(){};c._draw=function(b){if(this._bitmap){var a=this.bounding();this.fill(b,a,this._bitmap)}};c.fill=function(b,a,c){a=a.e;var d=a.alpha,e=a.rotation,g=a.scale,f=!1,h,
s,u;h=this.width*g;g*=this.height;s=a.x-0.5*h;u=a.y-0.5*g;if(1>d||0!==e)b.save(),f=!0,1>d&&(b.globalAlpha=d),0!==e&&(b.setTransform(1,0,0,1,0,0),b.translate(a.x,a.y),b.rotate(e),s=0.5*-h,u=0.5*-g);b.drawImage(c,0,0,c.width,c.height,s,u,h,g);f&&b.restore()};return d}()})(window);
(function(h){var f=h.Sankaku,e=f.Vector2D,g=f.Object2D,d=f.Tripod;f.Vehicle=function(){function c(a){g.call(this);this._velocity=new e;this._mass=1;this._speed=10;this._behavior=c.BOUNCE;this.bottom=this.right=this.top=this.left=0;this.setView(a||new d(this.x,this.y,this.width,this.height))}var b=Math.abs;f.extend(g,c);c.WRAP="vehicle_wrap";c.BOUNCE="vehicle_bounce";var a=c.prototype;a.constructor=c;f.EventDispatcher.initialize(a);a.setView=function(a){a.setPosition(this._position);this.width=a.width;
this.height=a.height;this.rotation=a.rotation;a.scale=this.scale;this._view=a};a.view=function(){return this._view};a.clone=function(){var a=new c(this._view.clone());a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;return a};a.setPadding=function(a,b,c,d){this.top=a;this.right=b||a;this.bottom=c||a;this.left=d||a;return this};
a.setMass=function(a){this._mass=a;return this};a.mass=function(){return this._mass};a.setSpeed=function(a){this._speed=a;return this};a.speed=function(){return this._speed};a.setBehavior=function(a){this._behavior=a;return this};a.behavior=function(){return this._behavior};a.setVelocity=function(a){this._velocity=a;return this};a.velocity=function(){return this._velocity};a.draw=function(a){this.visible&&0<this._alpha&&this._view.draw(a)};a.update=function(a,b){this._update(a,b)};a._update=function(a,
d){var e=this._velocity,g=this._position,f=this._view;a-=this.right;d-=this.bottom;e.truncate(b(this._speed));g.add(e);switch(this._behavior){case c.WRAP:this.wrap(a,d);break;default:this.bounce(a,d)}this.x=g.x;this.y=g.y;this.rotation=e.angle();f.x=g.x;f.y=g.y;f.rotation=e.angle();f.width=this.width;f.height=this.height};a.wrap=function(a,b){var c=this._position,d=!1,e=this.left,g=this.top;c.x>a&&(c.x=e,d=!0);c.x<e&&(c.x=a,d=!0);c.y>b&&(c.y=g,d=!0);c.y<g&&(c.y=b,d=!0);d&&this.dispatchEvent({type:"wrap",
currentTarget:this})};a.bounce=function(a,b){var c=this._velocity,d=this._position,e=!1,g=this.left,f=this.top;d.x>a?(d.x=a,c.x*=-1,e=!0):d.x<g&&(d.x=g,c.x*=-1,e=!0);d.y>b?(d.y=b,c.y*=-1,e=!0):d.y<f&&(d.y=f,c.y*=-1,e=!0);e&&this.dispatchEvent({type:"bounce",currentTarget:this})};a.beginRender=function(a,b){this.prepareRender();this.update(a,b)};return c}()})(window);
(function(h){var f=h.Sankaku,e=f.Vehicle,g=f.Vector2D;f.SteeredVehicle=function(){function d(a){e.call(this,a);this._force=new g;this._force_max=1;this._force_arrival=100;this._avoid_distance=300;this._avoid_buffer=20;this._avoid_insight=200;this._avoid_close=60}var c=0.5*Math.PI;f.extend(e,d);var b=d.prototype;b.constructor=d;b.clone=function(){var a=Object.create(this);a.setView(this._view.clone());a._force=this._force.clone();a.setPosition(this._position.clone());return a};b.max=function(){return this._force_max};
b.setMax=function(a){this._force_max=a;return this};b.arrival=function(){return this._force_arrival};b.setArrival=function(a){this._force_arrival=a;return this};b.setForce=function(a){this._force=a;return this};b.force=function(){return this._force};b.setBuffer=function(a){this._avoid_buffer=a;return this};b.buffer=function(){return this._avoid_buffer};b.setInsight=function(a){this._avoid_insight=a;return this};b.insight=function(){return this._avoid_insight};b.setClose=function(a){this._avoid_close=
a;return this};b.close=function(){return this._avoid_close};b.setAvoidDistance=function(a){this._avoid_distance=a;return this};b.avoidDistance=function(){return this._avoid_distance};b.update=function(a,b){this._force.truncate(this._force_max).divideScalar(this._mass);this._velocity.add(this._force);this._force=new g;this._update(a,b)};b.seek=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.add(a)};b.flee=function(a){a=a.subNew(this._position);
a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.sub(a)};b.arrive=function(a){var b=a.subNew(this._position),c=this._force_arrival;b.normalize();a=this._position.distance(a);a>c?b.multiplyScalar(this._speed):b.multiplyScalar(this._speed*a/c);b.sub(this._velocity);this._force.add(b)};b.pursue=function(a){var b=this._position.distance(a.position()),c=a.position().clone();c.add(a._velocity.multiplyNew(b));this.seek(c)};b.evade=function(a){var b=this._position.distance(a.position())/
this._speed,c=a.position().clone();c.sub(a._velocity.multiplyNew(b));this.flee(c)};b.avoid=function(a){var b,d,e,g,f,h,s,u;s=0;for(u=a.length;s<u;s++)b=a[s],d=this._velocity.clone().normalize(),e=b.position().subNew(this._position),g=e.dot(d),0<g&&(f=d.clone(),f.multiplyScalar(this._avoid_distance),h=d.clone(),h.multiplyScalar(g),g=h.subNew(e).length(),g<b.radius()+this._avoid_buffer&&h.length()<f.length()&&(b=d.clone(),b.multiplyScalar(this._speed),b.setAngle(b.angle()+e.sign(this._velocity)*c),
e=h.length()/f.length(),b.multiplyScalar(1-e),this._force.add(b),this._velocity.multiplyScalar(e)))};return d}()})(window);
(function(h){var f=h.Sankaku,e=f.SteeredVehicle,g=f.Vector2D;f.Wander=function(){function d(a){e.call(this,a);this._wander_angle=0;this._wander_distance=10;this._wnder_radius=5;this._wander_range=1;this._wander_range2=0.5*this._wander_range}var c=Math.random;f.extend(e,d);var b=d.prototype;b.constructor=d;b.clone=function(){var a=Object.create(this);a.setView(this._view.clone());return a};b.setWanderAngle=function(a){this._wander_angle=a;return this};b.wanderAngle=function(){return this._wander_angle};
b.setWanderDistance=function(a){this._wander_distance=a;return this};b.wanderDistance=function(){return this._wander_distance};b.setWanderRadius=function(a){this._wnder_radius=a;return this};b.wanderRadius=function(){return this._wnder_radius};b.setWanderRange=function(a){this._wander_range=a;this._wander_range2=0.5*a;return this};b.wanderRange=function(){return this._wander_range};b.wander=function(){var a=this._velocity.clone().normalize().multiplyScalar(this._wander_distance),b=new g;b.setLength(this._wnder_radius);
b.setAngle(this._wander_angle);this._wander_angle+=c()*this._wander_range-this._wander_range2;a.add(b);this._force.add(a)};b.beginRender=function(a,b){this.prepareRender();this.wander(this._paths,this._loop);this.update(a,b)};return d}()})(window);
(function(h){var f=h.Sankaku,e=f.SteeredVehicle,g=f.Vector2D;f.Flock=function(){function d(b){e.call(this,b);this._flock_flockInsight=200;this._flock_flockClose=60}f.extend(e,d);var c=d.prototype;c.constructor=d;c.clone=function(){var b=Object.create(this);b.setView(this._view.clone());b.position(this._position.clone());b._velocity=this._velocity.clone();b._force=this._force.clone();return b};c.setFlockInsight=function(b){this._flock_flockInsight=b;return this};c.flockInsight=function(){return this._flock_flockInsight};
c.setFlockClose=function(b){this._flock_flockClose=b;return this};c.flockClose=function(){return this._flock_flockClose};c.flock=function(b){var a=this._velocity.clone(),c=new g,d=0,e,f,h;f=0;for(h=b.length;f<h;f++)e=b[f],e!==this&&this.tooInsight(e)&&(a.add(e.velocity()),c.add(e.position()),this.tooClose(e)&&this.flee(e.position()),++d);0<d&&(a.divideScalar(d),c.divideScalar(d),this.seek(c),this._force.add(a.sub(this._velocity)))};c.tooInsight=function(b){var a;if(this._position.distance(b._position)>
this._flock_flockInsight)return!1;a=this._velocity.clone().normalize();return 0>b._position.subNew(this._position).dot(a)};c.tooClose=function(b){return this._position.distance(b._position)<this._flock_flockClose};c.setFlocks=function(b){this._flocks=b;return this};c.beginRender=function(b,a){this.prepareRender();this.flock(this._flocks);this.update(b,a)};return d}()})(window);
(function(h){var f=h.Sankaku,e=f.SteeredVehicle;f.FollowPath=function(){function g(c){e.call(this,c);this._index=0;this._threshold=20}f.extend(e,g);var d=g.prototype;d.constructor=g;d.clone=function(){var c=Object.create(this);c.setView(this._view.clone());c.position(this._position.clone());c._velocity=this._velocity.clone();c._force=this._force.clone();return c};d.follow=function(c,b){b=!!b;var a=c[this._index],d;a&&(d=c.length-1,this._position.distance(a)<this._threshold&&(this._index>=d?b&&(this._index=
0):this._index++),this._index>=d&&!b?this.arrive(a):this.seek(a))};d.setPath=function(c){this._paths=c;return this};d.setLoop=function(c){this._loop=c;return this};d.beginRender=function(c,b){this.prepareRender();this.follow(this._paths,this._loop);this.update(c,b)};return g}()})(window);
(function(h){h.Sankaku.Zanzo=function(){function f(e){this._limit=e;this._objects=[]}var e=f.prototype;e.constructor=f;e.limit=function(e){this._limit=e};e.add=function(e){var d=this._objects,c=[],b,a;0<this._limit&&d.length>=this._limit&&d.shift();b=0;for(a=e.length;b<a;b++)d=e[b],c.push(d.clone());this._objects.push(c)};e.draw=function(e,d){var c=this._objects,b,a,f,h,n,l,p;n=c.length;f=1/(n+1);e.save();for(h=0;h<n;h++)for(b=c[h],a=f*(h+1),e.globalAlpha=a,l=0,p=b.length;l<p;l++)a=b[l],a.draw(e),
d&&d.call(e);e.restore()};e.length=function(){return this._objects.length};return f}()})(window);(function(h){h.Sankaku.Inside=function(){function f(e){this._scene=e;this._contains=[]}var e=f.prototype;e.constructor=f;e.check=function(e){var d=this._contains;d.length=0;d=this._scene.inside(e,d);return d.reverse()};return f}()})(window);

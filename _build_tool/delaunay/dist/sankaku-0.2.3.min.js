/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/06/20 - 11:55

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 delaunay
 original: https://github.com/ironwallaby/delaunay

 hosted on
 https://github.com/taikiken/sankaku.js
*/
var Sankaku={version:"0.2.3"};
(function(k){k.console||(k.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}});Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var h=0,e=["ms","moz","webkit","o"],g=0;g<e.length&&!k.requestAnimationFrame;++g)k.requestAnimationFrame=k[e[g]+"RequestAnimationFrame"],k.cancelAnimationFrame=k[e[g]+"CancelAnimationFrame"]||k[e[g]+"CancelRequestAnimationFrame"];void 0===k.requestAnimationFrame&&void 0!==k.setTimeout&&
(k.requestAnimationFrame=function(d){var b=Date.now(),c=Math.max(0,16-(b-h)),a=k.setTimeout(function(){d(b+c)},c);h=b+c;return a});void 0===k.cancelAnimationFrame&&void 0!==k.clearTimeout&&(k.cancelAnimationFrame=function(d){k.clearTimeout(d)});Object.create||(Object.create=function(){function d(){}return function(b){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");d.prototype=b;return new d}}());Array.isArray||(Array.isArray=function(d){return"[object Array]"===
Object.prototype.toString.call(d)});Array.prototype.indexOf||(Array.prototype.indexOf=function(d,b){var c;c=b?b:0;var a;if(!this)throw new TypeError;a=this.length;if(0===a||c>=a)return-1;for(0>c&&(c=a-Math.abs(c));c<a;c++)if(this[c]===d)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,b){var c,a;c=0;for(a=this.length;c<a;++c)c in this&&d.call(b,this[c],c,this)});Function.prototype.bind||(Function.prototype.bind=function(d){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var b=Array.prototype.slice.call(arguments,1),c=this,a=function(){},f=function(){return c.apply(this instanceof a&&d?this:d,b.concat(Array.prototype.slice.call(arguments)))};a.prototype=this.prototype;f.prototype=new a;return f});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL})()})(window.self);(function(k){k.Sankaku.extend=function(h,e){e.prototype=Object.create(h.prototype);e.prototype.constructor=e}})(window);
(function(k){k.EventDispatcher=function(){function h(){}var e=h.prototype;e.constructor=k.EventDispatcher;e.addEventListener=function(g,d){"undefined"===typeof this._listeners&&(this._listeners={});var b=this._listeners;"undefined"===typeof b[g]&&(b[g]=[]);-1===b[g].indexOf(d)&&b[g].push(d)};e.hasEventListener=function(g,d){var b=this._listeners;return"undefined"!==typeof b&&"undefined"!==typeof d[g]&&-1!==b[g].indexOf(d)?!0:!1};e.removeEventListener=function(g,d){if("undefined"!==typeof this._listeners){var b=
this._listeners[g],c;"undefined"!==typeof b&&(c=b.indexOf(d),-1!==c&&b.splice(c,1))}};e.dispatchEvent=function(g){var d=this._listeners,b,c;if("undefined"!==typeof d&&"undefined"!==typeof g.type&&(d=d[g.type],"undefined"!==typeof d))for(g.target=this,b=0,c=d.length;b<c;b++)d[b].call(this,g)};h.initialize=function(g){g.addEventListener=e.addEventListener;g.hasEventListener=e.hasEventListener;g.removeEventListener=e.removeEventListener;g.dispatchEvent=e.dispatchEvent};return h}()})(window.Sankaku);
(function(k){k.Sankaku.Iro=function(){function h(){throw Error("Iro can't create instance");}h.rgb2hsl=function(e,g,d){e/=255;g/=255;d/=255;var b=Math.max(e,g,d),c=Math.min(e,g,d),a,f,m;f=(b+c)/2;if(b===c)a=c=0;else{m=b-c;c=0.5<f?m/(2-b-c):m/(b+c);switch(b){case e:a=(g-d)/m+(g<d?6:0);break;case g:a=(d-e)/m+2;break;case d:a=(e-g)/m+4}a/=6}return{h:a,s:c,l:f}};h.hsl2rgb=function(e,g,d){function b(a,c,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(c-a)*b:0.5>b?c:b<2/3?a+(c-a)*(2/3-b)*6:a}if(0===g)d=g=
e=d;else{var c=0.5>d?d*(1+g):d+g-d*g,a=2*d-c;d=b(a,c,e+1/3);g=b(a,c,e);e=b(a,c,e-1/3)}return{r:255*d,g:255*g,b:255*e}};h.rgb2hsv=function(e,g,d){e/=255;g/=255;d/=255;var b=Math.max(e,g,d),c=Math.min(e,g,d),a,f=b-c;if(b===c)a=0;else{switch(b){case e:a=(g-d)/f+(g<d?6:0);break;case g:a=(d-e)/f+2;break;case d:a=(e-g)/f+4}a/=6}return{h:a,s:0===b?0:f/b,v:b}};h.hsv2rgb=function(e,g,d){var b,c,a,f=Math.floor(6*e),m=6*e-f;e=d*(1-g);var u=d*(1-m*g);g=d*(1-(1-m)*g);switch(f%6){case 0:b=d;c=g;a=e;break;case 1:b=
u;c=d;a=e;break;case 2:b=e;c=d;a=g;break;case 3:b=e;c=u;a=d;break;case 4:b=g;c=e;a=d;break;case 5:b=d,c=e,a=u}return{r:255*b,g:255*c,b:255*a}};h.hex2rgb=function(e){if("string"!==typeof e)return null;e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(g,d,b,c){return d+d+b+b+c+c});return(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null};h.rgb2hex=function(e,g,d){function b(c){c=c.toString(16);return 1===c.length?"0"+c:c}
return"#"+b(e)+b(g)+b(d)};h.int2hex=function(e){e=Math.floor(e);e=e.toString(16);if(6>e.length)for(var g=6-e.length;g;)e="0"+e,--g;return"#"+e};return h}()})(window);
(function(k){k.Sankaku.List=function(){function h(){throw Error("List can't create instance");}var e=Math.random,g=Math.floor,d=Math.max;h.word=function(b,c){var a=[],f;for(f=0;f<b;f++)a[f]=c;return a};h.zero=function(b){return this.word(b,0)};h.shuffle=function(b){for(var c=[],a=b.length,f;a;)f=g(e()*b.length),f in b&&(c.push(b[f]),delete b[f],--a);return c};h.max=function(b){return d.apply(null,b)};return h}()})(window);
(function(k){k.Sankaku.Num=function(){function h(){throw Error("Num can't create instance");}var e=k.parseFloat,g=Math.random,d=Math.floor,b=Math.PI;h.ONE_DEG=b/180;h.FORTY_FIVE=b/4;h.NINETY=b/2;h.ONE_EIGHTY=b;h.THREE_SIXTY=2*b;h.is=function(c){return!isNaN(e(c))&&isFinite(c)};h.random=function(c,a){h.is(a)||(a=c,c=0);return c+d(g()*(a-c+1))};h.deg2rad=function(c){return c*h.ONE_DEG};return h}()})(window);
(function(k){k.Sankaku.Distribute=function(){function h(){throw Error("Distribute can't create instance");}var e=Math.sqrt,g=Math.sin,d=Math.cos,b=Math.random,c=2*Math.PI;h.circle=function(a,f,m){var u;a*=e(b());u=b()*c;return{x:0.5*f+d(u)*a,y:0.5*m+g(u)*a}};return h}()})(window);
(function(k){var h=k.Sankaku;h.Vector2D=function(){function e(a,f){this.x=a||0;this.y=f||0}var g=Math.floor,d=Math.ceil,b=Math.round,c=Math.cos,a=Math.sin,f=Math.atan2,m=Math.sqrt,u=Math.min,r=Math.acos,l=e.prototype;l.constructor=h.Vector2D;l.draw=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.x,this.y);a.closePath();return this};l.clone=function(){return new e(this.x,this.y)};l.zero=function(){this.y=this.x=0;return this};l.isZero=function(){return 0===this.x&&0===this.y};l.set=function(a,
f){this.x=a;this.y=f;return this};l.setX=function(a){this.x=a;return this};l.setY=function(a){this.y=a;return this};l.copy=function(a){this.x=a.x;this.y=a.y;return this};l.add=function(a){this.x+=a.x;this.y+=a.y;return this};l.addScalar=function(a){this.x+=a;this.y+=a;return this};l.addNew=function(a){return new e(this.x+a.x,this.y+a.y)};l.addVector=function(a,f){this.x=a.x+f.x;this.y=a.y+f.y;return this};l.sub=function(a){this.x-=a.x;this.y-=a.y;return this};l.subNew=function(a){return new e(this.x-
a.x,this.y-a.y)};l.subVector=function(a,f){this.x=a.x-f.x;this.y=a.y-f.y;return this};l.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};l.multiplyScalar=function(a){this.x*=a;this.y*=a;return this};l.multiplyNew=function(a){return new e(this.x*a.x,this.y*a.y)};l.divide=function(a){this.x/=a.x;this.y/=a.y;return this};l.divideScalar=function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this};l.divideNew=function(a){return new e(this.x/a.x,this.y/a.y)};l.min=function(a){this.x>
a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this};l.max=function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this};l.clamp=function(a,f){this.min(a);this.max(f);return this};l.clampScalar=function(a,f){var c,b;c=new e;b=new e;c.set(a,a);b.set(f,f);return this.clamp(c,b)};l.floor=function(){this.x=g(this.x);this.y=g(this.y);return this};l.ceil=function(){this.x=d(this.x);this.y=d(this.y);return this};l.round=function(){this.x=b(this.x);this.y=b(this.y);return this};l.roundToZero=
function(){this.x=0>this.x?d(this.x):g(this.x);this.y=0>this.y?d(this.y):g(this.y);return this};l.negate=function(){return this.multiplyScalar(-1)};l.dot=function(a){return this.x*a.x+this.y*a.y};l.lengthSq=function(){return this.x*this.x+this.y*this.y};l.length=function(){return m(this.lengthSq())};l.setLength=function(a){var f=this.length();0!==f&&a!==f&&this.multiplyScalar(a/f);return this};l.setAngle=function(f){var b=this.length(),b=b||0.001;this.x=c(f)*b;this.y=a(f)*b;return this};l.angle=function(){return f(this.y,
this.x)};l.normalize=function(){return this.divideScalar(this.length())};l.distanceSq=function(a){var f=this.x-a.x;a=this.y-a.y;return f*f+a*a};l.distance=function(a){return m(this.distanceSq(a))};l.lerp=function(a,f){this.x+=(a.x-this.x)*f;this.y+=(a.y-this.y)*f;return this};l.equals=function(a){return a.x===this.x&&a.y===this.y};l.fromArray=function(a){this.x=a[0];this.y=a[1];return this};l.toArray=function(){return[this.x,this.y]};l.truncate=function(a){a=u(a,this.length());return this.setLength(a)};
l.reverse=function(){this.negate();return this};l.isNormalize=function(){return 1===this.length()};l.perpendicular=function(){return new e(-this.y,this.x)};l.sign=function(a){return 0>this.perpendicular().dot(a)?-1:1};e.angleBetween=function(a,f){a.isNormalize()||(a=a.clone().normalize());f.isNormalize()||(f=f.clone().normalize());return r(a.dot(f))};return e}()})(window);
(function(k){var h=Math.abs,e=Math.min,g=Math.max,d=Math.round,b=k.Sankaku;b.Triangle=function(){function c(a,c,b){this.a=a;this.b=c;this.c=b;var d=c.x-a.x,l=c.y-a.y,k=b.x-a.x,v=b.y-a.y,s=d*(a.x+c.x)+l*(a.y+c.y),q=k*(a.x+b.x)+v*(a.y+b.y),n=2*(d*(b.y-c.y)-l*(b.x-c.x));1E-6>h(n)?(k=e(a.x,c.x,b.x),s=e(a.y,c.y,b.y),d=0.5*(g(a.x,c.x,b.x)-k),a=0.5*(g(a.y,c.y,b.y)-s),this.x=k+d,this.y=s+a):(c=(v*s-l*q)/n,b=(d*q-k*s)/n,d=c-a.x,a=b-a.y,this.x=c,this.y=b);this.r=d*d+a*a}var a=c.prototype;a.constructor=b.Triangle;
a.draw=function(a){var c=this.a,b=this.b,d=this.c;a.beginPath();a.moveTo(c.x,c.y);a.lineTo(b.x,b.y);a.lineTo(d.x,d.y);a.closePath()};a.centroid=function(){return{x:d((this.a.x+this.b.x+this.c.x)/3),y:d((this.a.y+this.b.y+this.c.y)/3)}};return c}()})(window);
(function(k){k=k.Sankaku;var h=k.Triangle;k.Delaunay=function(){function e(){throw Error("Sankaku can't create instance.");}e.triangulate=function(g){if(3>g.length)return[];var d,b,c,a,f,m,e,r,l,k=function(a){var f=a.length,c,b,m,d,e;a:for(;f;)for(b=a[--f],c=a[--f],m=f;m;)if(e=a[--m],d=a[--m],c===d&&b===e||c===e&&b===d){a.splice(f,2);a.splice(m,2);f-=2;continue a}};g.sort(function(a,f){return f.x-a.x});b=g.length-1;d=g[b];c=d.x;a=g[0].x;for(m=f=d.y;b--;)d.y<f&&(f=d.y),d.y>m&&(m=d.y);e=a-c;r=m-f;b=
e>r?e:r;d=0.5*(a+c);e=0.5*(m+f);m=[new h({x:d-20*b,y:e-b,__sentinel:!0},{x:d,y:e+20*b,__sentinel:!0},{x:d+20*b,y:e-b,__sentinel:!0})];f=[];c=[];for(b=g.length;b--;){c.length=0;a=m.length;for(d=g[b];a--;)l=m[a],e=d.x-l.x,0<e&&e*e>l.r?(f.push(l),m.splice(a,1)):(r=d.y-l.y,e*e+r*r>l.r||(c.push(l.a,l.b,l.b,l.c,l.c,l.a),m.splice(a,1)));k(c);for(a=c.length;a;)r=c[--a],e=c[--a],m.push(new h(e,r,d))}Array.prototype.push.apply(f,m);for(b=f.length;b--;)g=f[b],(g.a.__sentinel||g.b.__sentinel||g.c.__sentinel)&&
f.splice(b,1);return f};return e}()})(window);
(function(k){var h=k.Sankaku,e=h.Vector2D,g=h.Num,d=h.Iro;h.Object2D=function(){function b(){this._position=new e;this.rotation=this.y=this.x=0;this.width=20;this.height=10;this.scale=1;this.parent=this.scene=null;this.children=[];this.visible=!0;this._alpha=1}var c=Math.cos,a=Math.sin,f=b.prototype;f.constructor=h.Object2D;h.EventDispatcher.initialize(f);f.clone=function(){return this._clone()};f._clone=function(){var a=new b;a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;
a.rotation=this.rotation;a.scale=this.scale;a.parent=parent&&parent.clone();a._alpha=this._alpha;a.setColor(this._color);return a};f.setColor=function(a){this._color=a;this._rgb=d.hex2rgb(a);this._rgb.a=this._alpha;return this};f.setAlpha=function(a){this._alpha=a;return this.setColor(this._color)};f.alpha=function(){return this._alpha};f.setPosition=function(a){this._position=a;this.x=a.x;this.y=a.y;return this};f.position=function(){return this._position};f.setX=function(a){this.x=a;this._position.x=
a;return this};f.setY=function(a){this.y=a;this._position.y=a;return this};f.bounding=function(){var f=this.parent,b=this.x,d=this.y,e=this.width*this.scale,g=this.height*this.scale,e=0.5*e,g=0.5*g,h=this.rotation,k,q,n,t,p,w;q={scale:this.scale,rotation:this.rotation,x:this.x,y:this.y};f&&this.scene!==f&&(b=f.x+b*f.scale,d=f.y+d*f.scale,e=this.width*f.scale,g=this.height*f.scale,e*=0.5,g*=0.5,h=f.rotation+this.rotation,console.log("rotation ",f.rotation,this.rotation),q.scale=f.scale*this.scale,
q.rotation=h);f=a(h);p=c(h);h=-e;k=-g;n=e;t=g;e=p*h;g=p*k;k*=f;h*=f;w=p*n;p*=t;n*=f;t*=f;f={x:e-k+b,y:g+h+d};g={x:w-k+b,y:g+n+d};k={x:w-t+b,y:p+n+d};b={x:e-t+b,y:p+h+d};q.x=0.5*(f.x+k.x);q.y=0.5*(f.y+k.y);return{a:f,b:g,c:k,d:b,e:q}};f.localBounding=function(){this.parent.bounding()};f.setRotate=function(a){this.rotation=g.deg2rad(a);return this};f.inside=function(a){function f(a,b,c){return c.x*b.y-b.x*c.y-(c.x*a.y-a.x*c.y)+(b.x*a.y-a.x*b.y)}var b=this.bounding();return 0<f(b.a,a)||0<f(b.b,a)||0<
f(b.c,a)?!1:!0};f.add=function(a){if(a!==this){a.parent&&a.parent.remove(a);a.parent=this;this.children.push(a);var f=this.scene;f&&f.addChild(a);return this}};f.remove=function(a){var f;f=this.children.indexOf(a);if(-1!==f)return a.parent=null,this.children.splice(f,1),(f=this.scene)&&f.removeChild(a),this};f.draw=function(a){this._draw(a);var f=this.children,b,c,d;c=0;for(d=f.length;c<d;c++)b=f[c],b.visible&&0<b.alpha()&&f[c].draw(a);return this};f._draw=function(a){};f.swap=function(a,f){var b=
this.children,c=b.indexOf(a),d=b.indexOf(f);b[d]=a;b[c]=f;return this};f.highest=function(a){var f=this.children,b=f.indexOf(a);f.splice(b,1);f.push(a);return this};return b}()})(window);(function(k){var h=k.Sankaku,e=h.Object2D;h.Scene=function(){function g(){e.call(this);this.scene=this}h.extend(e,g);var d=g.prototype;d.constructor=h.Scene;d.addChild=function(b){b.scene=this};d.removeChild=function(b){b.scene=null};return g}()})(window);
(function(k){var h=k.Sankaku,e=h.Object2D,g=h.Vector2D,d=h.Iro;h.Shape=function(){function b(a,f,c,d,g,h){e.call(this);this.setX(a);this.setY(f);this.width=c||20;this.height=d||10;this._fill=h||b.STROKE;this._line=1;this._rgb={};this._color=g||"#000000";this.setColor(this._color);this.setBorder(this.setLine,this._color)}h.extend(e,b);b.FILL="shape_fill";b.STROKE="shape_stroke";b.BOTH="shape_both";var c=b.prototype;c.constructor=h.Shape;c.clone=function(){var a=new b(this.x,this.y,this.width,this.height,
this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={setLine:this._border.setLine,rgb:this._border.rgb};return a};c.radius=function(){var a=this.bounding(),f=a.a,a=a.c;return 0.5*(new g(f.x,f.y)).distance(new g(a.x,a.y))};c.setBorder=function(a,f){var b=d.hex2rgb(f);b.a=this._alpha;this._border={setLine:a,rgb:b};return this};c.setMode=function(a){this._fill=a;return this};c.mode=function(){return this._fill};
c.setLine=function(a){this._line=a;return this};c.line=function(){return this._line};c._draw=function(a){switch(this._fill){case b.STROKE:this.stroke(a,this._line,this._rgb);break;case b.FILL:this.fill(a,this._rgb);break;case b.BOTH:this.stroke(a,this._border._line,this._border._rgb),this.fill(a,this._rgb)}};c.fill=function(a,f){a.fillStyle="rgba("+f.r+","+f.g+","+f.b+","+f.a+")";this.paint(a);a.fill()};c.stroke=function(a,f,b){a.lineWidth=f;a.strokeStyle="rgba("+b.r+","+b.g+","+b.b+","+b.a+")";this.paint(a);
a.stroke()};c.paint=function(a){var f=this.bounding(),b=f.a,c=f.b,d=f.c,f=f.d;a.beginPath();a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.lineTo(d.x,d.y);a.lineTo(f.x,f.y);a.lineTo(b.x,b.y);a.closePath()};return b}()})(window);
(function(k){var h=k.Sankaku,e=h.Shape;h.Circle=function(){function g(b,a,f,d,g){e.call(this,b,a,f,f,d,g);this._radius=f||this.width}var d=2*Math.PI;h.extend(e,g);var b=g.prototype;b.constructor=h.Circle;b.radius=function(){return this._radius};b.clone=function(){var b=new g(this.x,this.y,this._radius,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={line:this._border.line,rgb:this._border.rgb};return b};
b.paint=function(b){var a=this.bounding().e;b.beginPath();b.arc(a.x,a.y,this._radius*a.scale,0,d,!1);b.closePath()};return g}()})(window);
(function(k){var h=k.Sankaku,e=h.Shape;h.Tripod=function(){function g(b,c,a,f,d,g){e.call(this,b,c,a,f,d,g)}h.extend(e,g);var d=g.prototype;d.constructor=h.Tripod;d.clone=function(){var b=new g(this.x,this.y,this.width,this.height,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={line:this._border.line,rgb:this._border.rgb};return b};d.paint=function(b){var c=this.bounding(),a=c.a,f=c.b,d=c.c,c=c.d;
b.beginPath();b.moveTo(a.x,a.y);b.lineTo(0.5*(f.x+d.x),0.5*(f.y+d.y));b.lineTo(c.x,c.y);b.lineTo(a.x,a.y);b.closePath()};return g}()})(window);
(function(k){var h=k.Sankaku,e=h.Shape,g=h.Num;h.Star=function(){function d(a,b,c,d,g,h,k){e.call(this,a,b,c,c,d,g);this._radius=c||this.width;this._points=h||5;this._inner=k||0.475*c}var b=Math.sin,c=Math.cos;h.extend(e,d);var a=d.prototype;a.constructor=h.Star;a.radius=function(){return this._radius};a.clone=function(){var a=new d(this.x,this.y,this._radius,this._color,this._fill,this._points);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=
this._line;a._border={line:this._border.line,rgb:this._border.rgb};return a};a.paint=function(a){var d=this.bounding().e,e=this._points,h=2*e,e=g.ONE_EIGHTY/e,l=g.NINETY,k=d.scale,v=this._radius*k,k=this._inner*k,s=d.x,q=d.y,d=d.rotation,n,t,p;a.beginPath();console.log("STAR",d);for(n=0;n<=h;++n)t=n*e-l+d,p=n%2?k:v,a.lineTo(s+p*c(t),q+p*b(t));a.closePath()};return d}()})(window);
(function(k){var h=k.Sankaku,e=h.Vector2D,g=h.Object2D,d=h.Tripod;h.Vehicle=function(){function b(a){g.call(this);this._velocity=new e;this._mass=1;this._speed=10;this._behavior=b.BOUNCE;this.bottom=this.right=this.top=this.left=0;this.setView(a||new d(this.x,this.y,this.width,this.height))}var c=Math.abs;h.extend(g,b);b.WRAP="vehicle_wrap";b.BOUNCE="vehicle_bounce";var a=b.prototype;a.constructor=h.Vehicle;h.EventDispatcher.initialize(a);a.setView=function(a){a.setPosition(this._position);this.width=
a.width;this.height=a.height;this.rotation=a.rotation;a.scale=this.scale;this._view=a};a.view=function(){return this._view};a.clone=function(){var a=new b(this._view.clone());a.setPosition(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;return a};a.setPadding=function(a,b,c,d){this.top=a;this.right=b||a;this.bottom=c||a;this.left=d||a};a.setMass=
function(a){this._mass=a};a.mass=function(){return this._mass};a.setSpeed=function(a){this._speed=a};a.speed=function(){return this._speed};a.setBehavior=function(a){this._behavior=a};a.behavior=function(){return this._behavior};a.setVelocity=function(a){this._velocity=a};a.velocity=function(){return this._velocity};a.draw=function(a){this._view.draw(a)};a.update=function(a,b){this._update(a,b)};a._update=function(a,d){var e=this._velocity,g=this._position,h=this._view;a-=this.right;d-=this.bottom;
e.truncate(c(this._speed));g.add(e);switch(this._behavior){case b.WRAP:this.wrap(a,d);break;default:this.bounce(a,d)}this.x=g.x;this.y=g.y;this.rotation=e.angle();h.x=g.x;h.y=g.y;h.rotation=e.angle();h.width=this.width;h.height=this.height};a.wrap=function(a,b){var c=this._position,d=!1,e=this.left,g=this.top;c.x>a&&(c.x=e,d=!0);c.x<e&&(c.x=a,d=!0);c.y>b&&(c.y=g,d=!0);c.y<g&&(c.y=b,d=!0);d&&this.dispatchEvent({type:"wrap",currentTarget:this})};a.bounce=function(a,b){var c=this._velocity,d=this._position,
e=!1,g=this.left,h=this.top;d.x>a?(d.x=a,c.x*=-1,e=!0):d.x<g&&(d.x=g,c.x*=-1,e=!0);d.y>b?(d.y=b,c.y*=-1,e=!0):d.y<h&&(d.y=h,c.y*=-1,e=!0);e&&this.dispatchEvent({type:"bounce",currentTarget:this})};return b}()})(window);
(function(k){var h=k.Sankaku,e=h.Vehicle,g=h.Vector2D;h.SteeredVehicle=function(){function d(a){e.call(this,a);this._force=new g;this._force_max=1;this._force_arrival=100;this._avoid_distance=300;this._avoid_buffer=20;this._avoid_insight=200;this._avoid_close=60}var b=0.5*Math.PI;h.extend(e,d);var c=d.prototype;c.constructor=h.SteeredVehicle;c.clone=function(){var a=Object.create(this);a.setView(this._view.clone());return a};c.max=function(){return this._force_max};c.setMax=function(a){this._force_max=
a};c.arrival=function(){return this._force_arrival};c.setArrival=function(a){this._force_arrival=a};c.setForce=function(a){this._force=a};c.force=function(){return this._force};c.setBuffer=function(a){this._avoid_buffer=a};c.buffer=function(){return this._avoid_buffer};c.setInsight=function(a){this._avoid_insight=a};c.insight=function(){return this._avoid_insight};c.setClose=function(a){this._avoid_close=a};c.close=function(){return this._avoid_close};c.setAvoidDistance=function(a){this._avoid_distance=
a};c.avoidDistance=function(){return this._avoid_distance};c.update=function(a,b){this._force.truncate(this._force_max).divideScalar(this._mass);this._velocity.add(this._force);this._force=new g;this._update(a,b)};c.seek=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.add(a)};c.flee=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.sub(a)};c.arrive=function(a){var b=a.subNew(this._position),
c=this._force_arrival;b.normalize();a=this._position.distance(a);a>c?b.multiplyScalar(this._speed):b.multiplyScalar(this._speed*a/c);b.sub(this._velocity);this._force.add(b)};c.pursue=function(a){var b=this._position.distance(a.position()),c=a.position().clone();c.add(a._velocity.multiplyNew(b));this.seek(c)};c.evade=function(a){var b=this._position.distance(a.position())/this._speed,c=a.position().clone();c.sub(a._velocity.multiplyNew(b));this.flee(c)};c.avoid=function(a){var c,d,e,g,h,k,v,s;v=0;
for(s=a.length;v<s;v++)c=a[v],d=this._velocity.clone().normalize(),e=c.position().subNew(this._position),g=e.dot(d),0<g&&(h=d.clone(),h.multiplyScalar(this._avoid_distance),k=d.clone(),k.multiplyScalar(g),g=k.subNew(e).length(),g<c.radius()+this._avoid_buffer&&k.length()<h.length()&&(c=d.clone(),c.multiplyScalar(this._speed),c.setAngle(c.angle()+e.sign(this._velocity)*b),e=k.length()/h.length(),c.multiplyScalar(1-e),this._force.add(c),this._velocity.multiplyScalar(e)))};return d}()})(window);
(function(k){var h=k.Sankaku,e=h.SteeredVehicle,g=h.Vector2D;h.Wander=function(){function d(a){e.call(this,a);this._wander_angle=0;this._wander_distance=10;this._wnder_radius=5;this._wander_range=1;this._wander_range2=0.5*this._wander_range}var b=Math.random;h.extend(e,d);var c=d.prototype;c.constructor=h.Wander;c.clone=function(){var a=Object.create(this);a.setView(this._view.clone());return a};c.setWanderAngle=function(a){this._wander_angle=a};c.wanderAngle=function(){return this._wander_angle};
c.setWanderDistance=function(a){this._wander_distance=a};c.wanderDistance=function(){return this._wander_distance};c.setWanderRadius=function(a){this._wnder_radius=a};c.wanderRadius=function(){return this._wnder_radius};c.setWanderRange=function(a){this._wander_range=a;this._wander_range2=0.5*a};c.wanderRange=function(){return this._wander_range};c.wander=function(){var a=this._velocity.clone().normalize().multiplyScalar(this._wander_distance),c=new g;c.setLength(this._wnder_radius);c.setAngle(this._wander_angle);
this._wander_angle+=b()*this._wander_range-this._wander_range2;a.add(c);this._force.add(a)};return d}()})(window);
(function(k){var h=k.Sankaku,e=h.SteeredVehicle,g=h.Vector2D;h.Flock=function(){function d(b){e.call(this,b);this._flock_insight=200;this._flock_close=60}h.extend(e,d);var b=d.prototype;b.constructor=h.Flock;b.clone=function(){var b=Object.create(this);b.setView(this._view.clone());return b};b.setInsight=function(b){this._flock_insight=b};b.insight=function(){return this._flock_insight};b.setClose=function(b){this._flock_close=b};b.close=function(){return this._flock_close};b.flock=function(b){var a=
this._velocity.clone(),d=new g,e=0,h,k,l;k=0;for(l=b.length;k<l;k++)h=b[k],h!==this&&this.tooInsight(h)&&(a.add(h.velocity()),d.add(h.position()),this.tooClose(h)&&this.flee(h.position()),++e);0<e&&(a.divideScalar(e),d.divideScalar(e),this.seek(d),this._force.add(a.sub(this._velocity)))};b.tooInsight=function(b){var a;if(this._position.distance(b._position)>this._flock_insight)return!1;a=this._velocity.clone().normalize();return 0>b._position.subNew(this._position).dot(a)};b.tooClose=function(b){return this._position.distance(b._position)<
this._flock_close};return d}()})(window);
(function(k){var h=k.Sankaku,e=h.SteeredVehicle;h.FollowPath=function(){function g(b){e.call(this,b);this._index=0;this._threshold=20}h.extend(e,g);var d=g.prototype;d.constructor=h.FollowPath;d.clone=function(){var b=Object.create(this);b.setView(this._view.clone());return b};d.follow=function(b,c){c=!!c;var a=b[this._index],d;a&&(d=b.length-1,this._position.distance(a)<this._threshold&&(this._index>=d?c&&(this._index=0):this._index++),this._index>=d&&!c?this.arrive(a):this.seek(a))};return g}()})(window);
(function(k){var h=k.Sankaku;h.Zanzo=function(){function e(d){this._limit=d;this._objects=[]}var g=e.prototype;g.constructor=h.Zanzo;g.limit=function(d){this._limit=d};g.add=function(d){var b=this._objects,c=[],a,e;0<this._limit&&b.length>=this._limit&&b.shift();a=0;for(e=d.length;a<e;a++)b=d[a],c.push(b.clone());this._objects.push(c)};g.draw=function(d,b){var c=this._objects,a,e,g,h,k,l,x;k=c.length;g=1/(k+1);d.save();for(h=0;h<k;h++)for(a=c[h],e=g*(h+1),d.globalAlpha=e,l=0,x=a.length;l<x;l++)e=
a[l],e.draw(d),b&&b.call(d);d.restore()};return e}()})(window);

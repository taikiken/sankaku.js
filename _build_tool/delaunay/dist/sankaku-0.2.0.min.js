/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/06/20 - 11:55

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 delaunay
 original: https://github.com/ironwallaby/delaunay

 hosted on
 https://github.com/taikiken/sankaku.js
*/
var Sankaku={version:"0.2.0"};
(function(h){h.console||(h.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}});Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var g=0,f=["ms","moz","webkit","o"],e=0;e<f.length&&!h.requestAnimationFrame;++e)h.requestAnimationFrame=h[f[e]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[f[e]+"CancelAnimationFrame"]||h[f[e]+"CancelRequestAnimationFrame"];void 0===h.requestAnimationFrame&&void 0!==h.setTimeout&&
(h.requestAnimationFrame=function(d){var c=Date.now(),b=Math.max(0,16-(c-g)),a=h.setTimeout(function(){d(c+b)},b);g=c+b;return a});void 0===h.cancelAnimationFrame&&void 0!==h.clearTimeout&&(h.cancelAnimationFrame=function(d){h.clearTimeout(d)});Object.create||(Object.create=function(){function d(){}return function(c){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");d.prototype=c;return new d}}());Array.isArray||(Array.isArray=function(d){return"[object Array]"===
Object.prototype.toString.call(d)});Array.prototype.indexOf||(Array.prototype.indexOf=function(d,c){var b;b=c?c:0;var a;if(!this)throw new TypeError;a=this.length;if(0===a||b>=a)return-1;for(0>b&&(b=a-Math.abs(b));b<a;b++)if(this[b]===d)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,c){var b,a;b=0;for(a=this.length;b<a;++b)b in this&&d.call(c,this[b],b,this)});Function.prototype.bind||(Function.prototype.bind=function(d){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var c=Array.prototype.slice.call(arguments,1),b=this,a=function(){},l=function(){return b.apply(this instanceof a&&d?this:d,c.concat(Array.prototype.slice.call(arguments)))};a.prototype=this.prototype;l.prototype=new a;return l});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL})()})(window.self);(function(h){h.Sankaku.extend=function(g,f){f.prototype=Object.create(g.prototype);f.prototype.constructor=f}})(window);
(function(h){h.EventDispatcher=function(){function g(){}var f=g.prototype;f.constructor=h.EventDispatcher;f.addEventListener=function(e,d){"undefined"===typeof this._listeners&&(this._listeners={});var c=this._listeners;"undefined"===typeof c[e]&&(c[e]=[]);-1===c[e].indexOf(d)&&c[e].push(d)};f.hasEventListener=function(e,d){var c=this._listeners;return"undefined"!==typeof c&&"undefined"!==typeof d[e]&&-1!==c[e].indexOf(d)?!0:!1};f.removeEventListener=function(e,d){if("undefined"!==typeof this._listeners){var c=
this._listeners[e],b;"undefined"!==typeof c&&(b=c.indexOf(d),-1!==b&&c.splice(b,1))}};f.dispatchEvent=function(e){var d=this._listeners,c,b;if("undefined"!==typeof d&&"undefined"!==typeof e.type&&(d=d[e.type],"undefined"!==typeof d))for(e.target=this,c=0,b=d.length;c<b;c++)d[c].call(this,e)};g.initialize=function(e){e.addEventListener=f.addEventListener;e.hasEventListener=f.hasEventListener;e.removeEventListener=f.removeEventListener;e.dispatchEvent=f.dispatchEvent};return g}()})(window.Sankaku);
(function(h){h.Sankaku.Iro=function(){function g(){throw Error("Iro can't create instance");}g.rgb2hsl=function(f,e,d){f/=255;e/=255;d/=255;var c=Math.max(f,e,d),b=Math.min(f,e,d),a,l,r;l=(c+b)/2;if(c===b)a=b=0;else{r=c-b;b=0.5<l?r/(2-c-b):r/(c+b);switch(c){case f:a=(e-d)/r+(e<d?6:0);break;case e:a=(d-f)/r+2;break;case d:a=(f-e)/r+4}a/=6}return{h:a,s:b,l:l}};g.hsl2rgb=function(f,e,d){function c(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}if(0===e)d=e=
f=d;else{var b=0.5>d?d*(1+e):d+e-d*e,a=2*d-b;d=c(a,b,f+1/3);e=c(a,b,f);f=c(a,b,f-1/3)}return{r:255*d,g:255*e,b:255*f}};g.rgb2hsv=function(f,e,d){f/=255;e/=255;d/=255;var c=Math.max(f,e,d),b=Math.min(f,e,d),a,l=c-b;if(c===b)a=0;else{switch(c){case f:a=(e-d)/l+(e<d?6:0);break;case e:a=(d-f)/l+2;break;case d:a=(f-e)/l+4}a/=6}return{h:a,s:0===c?0:l/c,v:c}};g.hsv2rgb=function(f,e,d){var c,b,a,l=Math.floor(6*f),r=6*f-l;f=d*(1-e);var g=d*(1-r*e);e=d*(1-(1-r)*e);switch(l%6){case 0:c=d;b=e;a=f;break;case 1:c=
g;b=d;a=f;break;case 2:c=f;b=d;a=e;break;case 3:c=f;b=g;a=d;break;case 4:c=e;b=f;a=d;break;case 5:c=d,b=f,a=g}return{r:255*c,g:255*b,b:255*a}};g.hex2rgb=function(f){if("string"!==typeof f)return null;f=f.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,d,c,b){return d+d+c+c+b+b});return(f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f))?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:null};g.rgb2hex=function(f,e,d){function c(b){b=b.toString(16);return 1===b.length?"0"+b:b}
return"#"+c(f)+c(e)+c(d)};g.int2hex=function(f){f=Math.floor(f);f=f.toString(16);if(6>f.length)for(var e=6-f.length;e;)f="0"+f,--e;return"#"+f};return g}()})(window);
(function(h){h.Sankaku.List=function(){function g(){throw Error("List can't create instance");}var f=Math.random,e=Math.floor,d=Math.max;g.word=function(c,b){var a=[],l;for(l=0;l<c;l++)a[l]=b;return a};g.zero=function(c){return this.word(c,0)};g.shuffle=function(c){for(var b=[],a=c.length,l;a;)l=e(f()*c.length),l in c&&(b.push(c[l]),delete c[l],--a);return b};g.max=function(c){return d.apply(null,c)};return g}()})(window);
(function(h){h.Sankaku.Num=function(){function g(){throw Error("Num can't create instance");}var f=h.parseFloat,e=Math.random,d=Math.floor,c=Math.PI;g.ONE_DEG=c/180;g.FORTY_FIVE=c/4;g.NINETY=c/2;g.ONE_EIGHTY=c;g.THREE_SIXTY=2*c;g.is=function(b){return!isNaN(f(b))&&isFinite(b)};g.random=function(b,a){g.is(a)||(a=b,b=0);return b+d(e()*(a-b+1))};g.deg2rad=function(b){return b*g.ONE_DEG};return g}()})(window);
(function(h){h.Sankaku.Distribute=function(){function g(){throw Error("Distribute can't create instance");}var f=Math.sqrt,e=Math.sin,d=Math.cos,c=Math.random,b=2*Math.PI;g.circle=function(a,l,r){var g;a*=f(c());g=c()*b;return{x:0.5*l+d(g)*a,y:0.5*r+e(g)*a}};return g}()})(window);
(function(h){var g=Math.abs,f=Math.min,e=Math.max,d=Math.round;h.Sankaku.Triangle=function(){function c(a,b,c){this.a=a;this.b=b;this.c=c;var d=b.x-a.x,k=b.y-a.y,m=c.x-a.x,h=c.y-a.y,n=d*(a.x+b.x)+k*(a.y+b.y),q=m*(a.x+c.x)+h*(a.y+c.y),s=2*(d*(c.y-b.y)-k*(c.x-b.x));1E-6>g(s)?(m=f(a.x,b.x,c.x),n=f(a.y,b.y,c.y),d=0.5*(e(a.x,b.x,c.x)-m),a=0.5*(e(a.y,b.y,c.y)-n),this.x=m+d,this.y=n+a):(b=(h*n-k*q)/s,c=(d*q-m*n)/s,d=b-a.x,a=c-a.y,this.x=b,this.y=c);this.r=d*d+a*a}var b=c.prototype;b.constructor=c;b.draw=
function(a){var b=this.a,c=this.b,d=this.c;a.beginPath();a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.lineTo(d.x,d.y);a.closePath()};b.centroid=function(){return{x:d((this.a.x+this.b.x+this.c.x)/3),y:d((this.a.y+this.b.y+this.c.y)/3)}};return c}()})(window);
(function(h){h=h.Sankaku;var g=h.Triangle;h.Delaunay=function(){function f(){throw Error("Sankaku can't create instance.");}f.triangulate=function(e){if(3>e.length)return[];var d,c,b,a,l,f,p,k,m,h=function(a){var b=a.length,c,l,m,d,e;a:for(;b;)for(l=a[--b],c=a[--b],m=b;m;)if(e=a[--m],d=a[--m],c===d&&l===e||c===e&&l===d){a.splice(b,2);a.splice(m,2);b-=2;continue a}};e.sort(function(a,b){return b.x-a.x});c=e.length-1;d=e[c];b=d.x;a=e[0].x;for(f=l=d.y;c--;)d.y<l&&(l=d.y),d.y>f&&(f=d.y);p=a-b;k=f-l;c=
p>k?p:k;d=0.5*(a+b);p=0.5*(f+l);f=[new g({x:d-20*c,y:p-c,__sentinel:!0},{x:d,y:p+20*c,__sentinel:!0},{x:d+20*c,y:p-c,__sentinel:!0})];l=[];b=[];for(c=e.length;c--;){b.length=0;a=f.length;for(d=e[c];a--;)m=f[a],p=d.x-m.x,0<p&&p*p>m.r?(l.push(m),f.splice(a,1)):(k=d.y-m.y,p*p+k*k>m.r||(b.push(m.a,m.b,m.b,m.c,m.c,m.a),f.splice(a,1)));h(b);for(a=b.length;a;)k=b[--a],p=b[--a],f.push(new g(p,k,d))}Array.prototype.push.apply(l,f);for(c=l.length;c--;)e=l[c],(e.a.__sentinel||e.b.__sentinel||e.c.__sentinel)&&
l.splice(c,1);return l};return f}()})(window);
(function(h){h.Sankaku.Vector2D=function(){function g(a,b){this.x=a||0;this.y=b||0}var f=Math.floor,e=Math.ceil,d=Math.round,c=Math.cos,b=Math.sin,a=Math.atan2,l=Math.sqrt,r=Math.min,p=Math.acos,k=g.prototype;k.constructor=g;k.draw=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.x,this.y);a.closePath();return this};k.clone=function(){return new g(this.x,this.y)};k.zero=function(){this.y=this.x=0;return this};k.isZero=function(){return 0===this.x&&0===this.y};k.set=function(a,b){this.x=a;this.y=
b;return this};k.setX=function(a){this.x=a;return this};k.setY=function(a){this.y=a;return this};k.copy=function(a){this.x=a.x;this.y=a.y;return this};k.add=function(a){this.x+=a.x;this.y+=a.y;return this};k.addScalar=function(a){this.x+=a;this.y+=a;return this};k.addNew=function(a){return new g(this.x+a.x,this.y+a.y)};k.addVector=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this};k.sub=function(a){this.x-=a.x;this.y-=a.y;return this};k.subNew=function(a){return new g(this.x-a.x,this.y-a.y)};
k.subVector=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this};k.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};k.multiplyScalar=function(a){this.x*=a;this.y*=a;return this};k.multiplyNew=function(a){return new g(this.x*a.x,this.y*a.y)};k.divide=function(a){this.x/=a.x;this.y/=a.y;return this};k.divideScalar=function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this};k.divideNew=function(a){return new g(this.x/a.x,this.y/a.y)};k.min=function(a){this.x>a.x&&(this.x=
a.x);this.y>a.y&&(this.y=a.y);return this};k.max=function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this};k.clamp=function(a,b){this.min(a);this.max(b);return this};k.clampScalar=function(a,b){var c,l;c=new g;l=new g;c.set(a,a);l.set(b,b);return this.clamp(c,l)};k.floor=function(){this.x=f(this.x);this.y=f(this.y);return this};k.ceil=function(){this.x=e(this.x);this.y=e(this.y);return this};k.round=function(){this.x=d(this.x);this.y=d(this.y);return this};k.roundToZero=function(){this.x=
0>this.x?e(this.x):f(this.x);this.y=0>this.y?e(this.y):f(this.y);return this};k.negate=function(){return this.multiplyScalar(-1)};k.dot=function(a){return this.x*a.x+this.y*a.y};k.lengthSq=function(){return this.x*this.x+this.y*this.y};k.length=function(){return l(this.lengthSq())};k.setLength=function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this};k.setAngle=function(a){var l=this.length(),l=l||0.001;this.x=c(a)*l;this.y=b(a)*l;return this};k.angle=function(){return a(this.y,
this.x)};k.normalize=function(){return this.divideScalar(this.length())};k.distanceSq=function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a};k.distance=function(a){return l(this.distanceSq(a))};k.lerp=function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this};k.equals=function(a){return a.x===this.x&&a.y===this.y};k.fomArray=function(a){this.x=a[0];this.y=a[1];return this};k.toArray=function(){return[this.x,this.y]};k.truncate=function(a){a=r(a,this.length());return this.setLength(a)};
k.reverse=function(){this.negate();return this};k.isNormalize=function(){return 1===this.length()};k.prev=function(){return new g(-this.y,this.x)};k.sign=function(a){return 0>this.prev().dot(a)?-1:1};g.angleBetween=function(a,b){a.isNormalize()||(a=a.clone().normalize());b.isNormalize()||(b=b.clone().normalize());return p(a.dot(b))};return g}()})(window);
(function(h){h=h.Sankaku;var g=h.Vector2D,f=h.Num;h.Object2D=function(){function e(){this._position=new g;this.rotation=this.y=this.x=0;this.width=20;this.height=10;this.scale=1}var d=Math.cos,c=Math.sin,b=e.prototype;b.constructor=e;b.position=function(a){this._position=a;this.x=a.x;this.y=a.y};b.getPosition=function(){return this._position};b.setX=function(a){this.x=a;this._position.x=a};b.setY=function(a){this.y=a;this._position.y=a};b.bounding=function(){var a=this.x,b=this.y,e=this.width*this.scale*
0.5,f=this.height*this.scale*0.5,g=this.rotation,h,u,n,q,s,t;n=c(g);q=d(g);h=-e;u=-f;g=q*h;s=q*u;u*=n;h*=n;t=q*e;q*=f;e*=n;f*=n;return{a:{x:g-u+a,y:s+h+b},b:{x:t-u+a,y:s+e+b},c:{x:t-f+a,y:q+e+b},d:{x:g-f+a,y:q+h+b}}};b.rotate=function(a){this.rotation=f.deg2rad(a)};b.clone=function(){return this._clone()};b._clone=function(){var a=new e;a.position(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;return a};b.draw=function(a){};return e}()})(window);
(function(h){var g=h.Sankaku,f=g.Object2D,e=g.Vector2D,d=g.Iro;g.Shape=function(){function c(a,b,d,e,g,h){f.call(this);this.setX(a);this.setY(b);this.width=d||20;this.height=e||10;this._fill=h||c.STROKE;this._alpha=this._line=1;this._rgb={};this._color=g||"#000000";this.color(this._color);this.border(this.line,this._color)}g.extend(f,c);c.FILL="shape_fill";c.STROKE="shape_stroke";c.BOTH="shape_both";var b=c.prototype;b.constructor=c;b.getRadius=function(){var a=this.bounding(),b=a.a,a=a.c;return(new e(b.x,
b.y)).distance(a)};b.clone=function(){var a=new c(this.x,this.y,this.width,this.height,this._color,this._fill);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={line:this._border.line,rgb:this._border.rgb};return a};b.border=function(a,b){var c=d.hex2rgb(b);c.a=this._alpha;this._border={line:a,rgb:c};return this};b.color=function(a){this._color=a;this._rgb=d.hex2rgb(a);this._rgb.a=this._alpha;return this};b.alpha=function(a){this._alpha=
a;return this.color(this._color)};b.mode=function(a){this._fill=a;return this};b.getMode=function(){return this._fill};b.line=function(a){this._line=a;return this};b.getLine=function(){return this._line};b.draw=function(a){switch(this._fill){case c.STROKE:this.stroke(a,this._line,this._rgb);break;case c.FILL:this.fill(a,this._rgb);break;case c.BOTH:this.stroke(a,this._border._line,this._border._rgb),this.fill(a,this._rgb)}};b.fill=function(a,b){a.fillStyle="rgba("+b.r+","+b.g+","+b.b+","+b.a+")";
this.paint(a);a.fill()};b.stroke=function(a,b,c){a.lineWidth=b;a.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")";this.paint(a);a.stroke()};b.paint=function(a){var b=this.bounding(),c=b.a,d=b.b,e=b.c,b=b.d;a.beginPath();a.moveTo(c.x,c.y);a.lineTo(d.x,d.y);a.lineTo(e.x,e.y);a.lineTo(b.x,b.y);a.lineTo(c.x,c.y);a.closePath()};return c}()})(window);
(function(h){var g=h.Sankaku,f=g.Shape;g.Circle=function(){function e(b,a,c,d,e){f.call(this,b,a,c,c,d,e);this._radius=c||this.width}var d=2*Math.PI;g.extend(f,e);var c=e.prototype;c.constructor=e;c.getRadius=function(){return this._radius};c.clone=function(){var b=new e(this.x,this.y,this._radius,this._color,this._fill);b.rotation=this.rotation;b.scale=this.scale;b._alpha=this._alpha;b._rgb=Object.create(this._rgb);b._line=this._line;b._border={line:this._border.line,rgb:this._border.rgb};return b};
c.paint=function(b){b.beginPath();b.arc(this.x,this.y,this._radius*this.scale,0,d,!1);b.closePath()};return e}()})(window);
(function(h){var g=h.Sankaku,f=g.Shape;g.Tripod=function(){function e(c,b,a,d,e,g){f.call(this,c,b,a,d,e,g)}g.extend(f,e);var d=e.prototype;d.constructor=e;d.clone=function(){var c=new e(this.x,this.y,this.width,this.height,this._color,this._fill);c.rotation=this.rotation;c.scale=this.scale;c._alpha=this._alpha;c._rgb=Object.create(this._rgb);c._line=this._line;c._border={line:this._border.line,rgb:this._border.rgb};return c};d.paint=function(c){var b=this.bounding(),a=b.a,d=b.b,e=b.c,b=b.d;c.beginPath();
c.moveTo(a.x,a.y);c.lineTo(d.x,d.y+0.5*(e.y-d.y));c.lineTo(b.x,b.y);c.lineTo(a.x,a.y);c.closePath()};return e}()})(window);
(function(h){var g=h.Sankaku,f=g.Shape,e=g.Num;g.Star=function(){function d(a,b,c,d,e,g,h){f.call(this,a,b,c,c,d,e);this._radius=c||this.width;this._points=g||5;this._inner=h||0.475*c}var c=Math.sin,b=Math.cos;g.extend(f,d);var a=d.prototype;a.constructor=d;a.clone=function(){var a=new d(this.x,this.y,this._radius,this._color,this._fill,this._points);a.rotation=this.rotation;a.scale=this.scale;a._alpha=this._alpha;a._rgb=Object.create(this._rgb);a._line=this._line;a._border={line:this._border.line,
rgb:this._border.rgb};return a};a.paint=function(a){var d=this._points,f=2*d,d=e.ONE_EIGHTY/d,g=e.NINETY,h=this.scale,u=this._radius*h,h=this._inner*h,n=this.x,q=this.y,s=this.rotation,t,v,w;a.beginPath();for(t=0;t<=f;++t)v=t*d-g+s,w=t%2?h:u,a.lineTo(n+w*b(v),q+w*c(v));a.closePath()};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.Vector2D,e=g.Object2D,d=g.Tripod;g.Vehicle=function(){function c(a){e.call(this);this._velocity=new f;this._mass=1;this._speed=10;this._behavior=c.BOUNCE;this.bottom=this.right=this.top=this.left=0;this.view(a||new d(this.x,this.y,this.width,this.height))}var b=Math.abs;g.extend(e,c);c.WRAP="vehicle_wrap";c.BOUNCE="vehicle_bounce";var a=c.prototype;a.constructor=c;g.EventDispatcher.initialize(a);a.view=function(a){a.position(this._position);this.width=a.width;this.height=
a.height;this.rotation=a.rotation;a.scale=this.scale;this._view=a};a.clone=function(){var a=new c(this._view.clone());a.position(this._position.clone());a.width=this.width;a.height=this.height;a.rotation=this.rotation;a.scale=this.scale;a._velocity=this._velocity.clone();a._mass=this._mass;a._speed=this._speed;a._behavior=this._behavior;return a};a.padding=function(a,b,c,d){this.top=a;this.right=b||a;this.bottom=c||a;this.left=d||a};a.mass=function(a){this._mass=a};a.getMass=function(){return this._mass};
a.speed=function(a){this._speed=a};a.getSpeed=function(){return this._speed};a.behavior=function(a){this._behavior=a};a.getBehavior=function(){return this._behavior};a.velocity=function(a){this._velocity=a};a.getVelocity=function(){return this._velocity};a.draw=function(a){this._view.draw(a)};a.getView=function(){return this._view};a.update=function(a,b){this._update(a,b)};a._update=function(a,d){var e=this._velocity,f=this._position,g=this._view;a-=this.right;d-=this.bottom;e.truncate(b(this._speed));
f.add(e);switch(this._behavior){case c.WRAP:this.wrap(a,d);break;default:this.bounce(a,d)}this.x=f.x;this.y=f.y;this.rotation=e.angle();g.x=f.x;g.y=f.y;g.rotation=e.angle();g.width=this.width;g.height=this.height};a.wrap=function(a,b){var c=this._position,d=!1,e=this.left,f=this.top;c.x>a&&(c.x=e,d=!0);c.x<e&&(c.x=a,d=!0);c.y>b&&(c.y=f,d=!0);c.y<f&&(c.y=b,d=!0);d&&this.dispatchEvent({type:"wrap",currentTarget:this})};a.bounce=function(a,b){var c=this._velocity,d=this._position,e=!1,f=this.left,g=
this.top;d.x>a?(d.x=a,c.x*=-1,e=!0):d.x<f&&(d.x=f,c.x*=-1,e=!0);d.y>b?(d.y=b,c.y*=-1,e=!0):d.y<g&&(d.y=g,c.y*=-1,e=!0);e&&this.dispatchEvent({type:"bounce",currentTarget:this})};return c}()})(window);
(function(h){var g=h.Sankaku,f=g.Vehicle,e=g.Vector2D;g.SteeredVehicle=function(){function d(a){f.call(this,a);this._force=new e;this._force_max=1;this._force_arrival=100;this._avoid_distance=300;this._avoid_buffer=20;this._avoid_insight=200;this._avoid_close=60}var c=0.5*Math.PI;g.extend(f,d);var b=d.prototype;b.constructor=d;b.clone=function(){var a=Object.create(this);a.view(this._view.clone());return a};b.getMax=function(){return this._force_max};b.max=function(a){this._force_max=a};b.getArrival=
function(){return this._force_arrival};b.arrival=function(a){this._force_arrival=a};b.force=function(a){this._force=a};b.getForce=function(){return this._force};b.buffer=function(a){this._avoid_buffer=a};b.getBuffer=function(){return this._avoid_buffer};b.insight=function(a){this._avoid_insight=a};b.getInsight=function(){return this._avoid_insight};b.close=function(a){this._avoid_close=a};b.getClose=function(){return this._avoid_close};b.avoidDistance=function(a){this._avoid_distance=a};b.getAvoidDistance=
function(){return this._avoid_distance};b.update=function(a,b){this._force.truncate(this._force_max).divideScalar(this._mass);this._velocity.add(this._force);this._force=new e;this._update(a,b)};b.seek=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.add(a)};b.flee=function(a){a=a.subNew(this._position);a.normalize().multiplyScalar(this._speed).sub(this._velocity);this._force.sub(a)};b.arrive=function(a){var b=a.subNew(this._position),
c=this._force_arrival;b.normalize();a=this._position.distance(a);a>c?b.multiplyScalar(this._speed):b.multiplyScalar(this._speed*a/c);b.sub(this._velocity);this._force.add(b)};b.pursue=function(a){var b=this._position.distance(a.getPosition()),c=a.getPosition().clone();c.add(a._velocity.multiplyNew(b));this.seek(c)};b.evade=function(a){var b=this._position.distance(a.getPosition())/this._speed,c=a.getPosition().clone();c.sub(a._velocity.multiplyNew(b));this.flee(c)};b.avoid=function(a){var b,d,e,f,
g,h,n,q;n=0;for(q=a.length;n<q;n++)b=a[n],d=this._velocity.clone().normalize(),e=b.getPosition().subNew(this._position),f=e.dot(d),0<f&&(g=d.clone(),g.multiplyScalar(this._avoid_distance),h=d.clone(),h.multiplyScalar(f),f=h.subNew(e).length(),f<b.getRadius()+this._avoid_buffer&&h.length()<g.length()&&(b=d.clone(),b.multiplyScalar(this._speed),b.setAngle(e.sign(this._velocity)*c),e=h.length()/g.length(),b.multiplyScalar(1-e),this._force.add(b),this._velocity.multiplyScalar(e)))};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.SteeredVehicle,e=g.Vector2D;g.Wander=function(){function d(a){f.call(this,a);this._angle=0;this._distance=10;this._radius=5;this._range=1;this._range2=0.5*this._range}var c=Math.random;g.extend(f,d);var b=d.prototype;b.constructor=d;b.clone=function(){var a=Object.create(this);a.view(this._view.clone());return a};b.angle=function(a){this._angle=a};b.getAngle=function(){return this._angle};b.distance=function(a){this._distance=a};b.getDistance=function(){return this._distance};
b.radius=function(a){this._radius=a};b.getRadius=function(){return this._radius};b.range=function(a){this._range=a;this._range2=0.5*a};b.getRange=function(){return this._range};b.wander=function(){var a=this._velocity.clone().normalize().multiplyScalar(this._distance),b=new e;b.setLength(this._radius);b.setAngle(this._angle);this._angle=c()*this._range-this._range2;a.add(b);this._force.add(a)};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.SteeredVehicle,e=g.Vector2D;g.Flock=function(){function d(b){f.call(this,b);this._flock_insight=200;this._flock_close=60}g.extend(f,d);var c=d.prototype;c.constructor=d;c.clone=function(){var b=Object.create(this);b.view(this._view.clone());return b};c.insight=function(b){this._flock_insight=b};c.getInsight=function(){return this._flock_insight};c.close=function(b){this._flock_close=b};c.getClose=function(){return this._flock_close};c.flock=function(b){var a=this._velocity.clone(),
c=new e,d=0,f,g,h;g=0;for(h=b.length;g<h;g++)f=b[g],f!==this&&this.tooInsight(f)&&(a.add(f.getVelocity()),c.add(f.getPosition()),this.tooClose(f)&&this.flee(f.getPosition()),++d);0<d&&(a.divideScalar(d),c.divideScalar(d),this.seek(c),this._force.add(a.sub(this._velocity)))};c.tooInsight=function(b){var a;if(this._position.distance(b._position)>this._flock_insight)return!1;a=this._velocity.clone().normalize();return 0>b._position.subNew(this._position).dot(a)};c.tooClose=function(b){return this._position.distance(b._position)<
this._flock_close};return d}()})(window);
(function(h){var g=h.Sankaku,f=g.SteeredVehicle;g.FollowPath=function(){function e(c){f.call(this,c);this._index=0;this._threshold=20}g.extend(f,e);var d=e.prototype;d.constructor=g.FollowPath;d.clone=function(){var c=Object.create(this);c.view(this._view.clone());return c};d.follow=function(c,b){b=!!b;var a=c[this._index];a&&(this._position.distance(a)<this._threshold&&(this._index>=c.length-1?b&&(this._index=0):this._index++),this._index>c.length-1&&!b?this.arrive(a):this.seek(a))};return e}()})(window);
(function(h){h.Sankaku.Zanzo=function(){function g(e){this._limit=e;this._objects=[]}var f=g.prototype;f.constructor=g;f.limit=function(e){this._limit=e};f.add=function(e){var d=this._objects,c=[],b,a;0<this._limit&&d.length>=this._limit&&d.shift();b=0;for(a=e.length;b<a;b++)d=e[b],c.push(d.clone());this._objects.push(c)};f.draw=function(e,d){var c=this._objects,b,a,f,g,h,k,m;h=c.length;f=1/(h+1);e.save();for(g=0;g<h;g++)for(b=c[g],a=f*(g+1),e.globalAlpha=a,k=0,m=b.length;k<m;k++)a=b[k],a.draw(e),
d&&d.call(e);e.restore()};return g}()})(window);

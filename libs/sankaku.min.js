/**
 * @license inazumatv.com
 * @author (at)taikiken / http://inazumatv.com
 * @date 2015/03/16 - 14:02
 *
 * Copyright (c) 2011-2015 inazumatv.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 *
 * Polyfill
 *
 * @build: Mon Mar 16 2015 16:09:23 GMT+0900 (JST)
 * @version: 1.0.0
 */
!function(t){"use strict";var i=(t.document,Math.max),n=Math.abs,e=t.self;Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var t=0,i=["ms","moz","webkit","o"],n=0;n<i.length&&!e.requestAnimationFrame;++n)e.requestAnimationFrame=e[i[n]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[i[n]+"CancelAnimationFrame"]||e[i[n]+"CancelRequestAnimationFrame"];void 0===e.requestAnimationFrame&&void 0!==e.setTimeout&&(e.requestAnimationFrame=function(i){var n=Date.now(),r=Math.max(0,16-(n-t)),s=e.setTimeout(function(){i(n+r)},r);return t=n+r,s}),void 0===e.cancelAnimationFrame&&void 0!==e.clearTimeout&&(e.cancelAnimationFrame=function(t){e.clearTimeout(t)})}(),"function"!=typeof Object.create&&(Object.create=function(){var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof i)throw TypeError("Argument must be an object");t.prototype=i;var n=new t;return t.prototype=null,n}}()),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var r;if(null===this||"undefined"==typeof this)throw new TypeError('"this" is null or not defined');var s=Object(this),o=s.length>>>0;if(0===o)return-1;var a=+e||0;if(1/0===n(a)&&(a=0),a>=o)return-1;for(r=i(a>=0?a:o-n(a),0);o>r;){if(r in s&&s[r]===t)return r;r++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,i){var n,e;if(null===this||"undefined"==typeof this)throw new TypeError(" this is null or not defined");var r=Object(this),s=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=i),e=0;s>e;){var o;e in r&&(o=r[e],t.call(n,o,e,r)),e++}}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var i=Array.prototype.slice.call(arguments,1),n=this,e=function(){},r=function(){return n.apply(this instanceof e&&t?this:t,i.concat(Array.prototype.slice.call(arguments)))};return e.prototype=this.prototype,r.prototype=new e,r}),String.prototype.trim||!function(){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(t,"")}}(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,t.URL=t.URL||t.webkitURL||t.mozURL||t.msURL,e.console||(e.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){},table:function(){}})}(window);/**
 * @license inazumatv.com
 * @author (at)taikiken / http://inazumatv.com
 * @date 2015/03/24 - 12:10
 *
 * Copyright (c) 2011-2015 inazumatv.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 *
 * @build 3/24/2015, 1:51:04 PM
 * @version 0.9.0
 * @git https://github.com/taikiken/gasane.js
 *
 * @module Gasane
 */
var Gasane=Gasane||{};!function(t){"use strict";var i=t.self;Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var t,n,e,r,s,o,a=0,h=["ms","moz","webkit","o"];for(t=0,n=h.length;n>t&&!i.requestAnimationFrame;++t)i.requestAnimationFrame=i[h[t]+"RequestAnimationFrame"],i.cancelAnimationFrame=i[h[t]+"CancelAnimationFrame"]||i[h[t]+"CancelRequestAnimationFrame"];void 0===i.requestAnimationFrame&&void 0!==i.setTimeout&&(o=Math.max,i.requestAnimationFrame=function(t){return e=Date.now(),r=o(0,16-(e-a)),s=i.setTimeout(function(){t(e+r)},r),a=e+r,s}),void 0===i.cancelAnimationFrame&&void 0!==i.clearTimeout&&(i.cancelAnimationFrame=function(t){i.clearTimeout(t)})}()}(window),function(t){"use strict";var i=t.Gasane;i.EventDispatcher=function(){function t(){}var i=t.prototype;return i.constructor=t,i.addEventListener=function(t,i){this.on(t,i)},i.on=function(t,i){"undefined"==typeof this._listeners&&(this._listeners={});var n=this._listeners;"undefined"==typeof n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},i.hasEventListener=function(t,i){var n=this._listeners;return"undefined"==typeof n?!1:"undefined"!=typeof i[t]&&-1!==n[t].indexOf(i)?!0:!1},i.removeEventListener=function(t,i){this.off(t,i)},i.off=function(t,i){var n,e,r=this._listeners;"undefined"!=typeof r&&(n=r[t],"undefined"!=typeof n&&(e=n.indexOf(i),-1!==e&&n.splice(e,1)))},i.dispatchEvent=function(t){var i,n,e,r=this._listeners;if("undefined"!=typeof r&&"undefined"!=typeof t.type&&(i=r[t.type],"undefined"!=typeof i))for(t.target=this,n=0,e=i.length;e>n;n++)i[n].call(this,t)},t.initialize=function(t){t.addEventListener=i.addEventListener,t.on=i.on,t.hasEventListener=i.hasEventListener,t.removeEventListener=i.removeEventListener,t.off=i.off,t.dispatchEvent=i.dispatchEvent},t}()}(window),function(t){"use strict";var i=t.Gasane;i.Cycle=function(){function n(){throw new Error("Cycle can't create instance.")}var e=i.EventDispatcher,r=t.self.requestAnimationFrame,s=t.self.cancelAnimationFrame;n.started=!1,n.id=0,n.UPDATE="cycleUpdate",n.event={type:n.UPDATE,scope:n},e.initialize(n);var o=n.prototype;return o.constructor=n,n.start=function(){n.started||(n.started=!0,n.update())},n.stop=function(){n.started&&(s(n.id),n.started=!1,n.id=0)},n.update=function(){n.id=r(n.update),n.dispatchEvent(n.event)},n}()}(window),function(t){"use strict";var i=t.Gasane;i.Polling=function(){function t(i){this._polling=i,this._started=!1,this._start=0,this._boundUpdate=this.update.bind(this),this._event={type:t.PAST,scope:this}}var n=i.EventDispatcher,e=i.Cycle,r=Date.now;t.PAST="pollingPast";var s=t.prototype;return n.initialize(s),s.constructor=t,s.start=function(){return this._started||(this._started=!0,this.setPolling(this._polling),e.on(e.UPDATE,this._boundUpdate),e.start()),this},s.stop=function(){return this._started&&(this._started=!1,e.off(e.UPDATE,this._boundUpdate)),this},s.polling=function(){return this._polling},s.setPolling=function(t){return this._start=this.now(),this._polling=t,this},s.changePolling=function(t){return this.setPolling(t),this},s.now=function(){return r()},s.update=function(){var t=this.now();t-this._start>=this._polling&&(this._start=t,this.dispatchEvent(this._event))},t}()}(window),function(t){"use strict";var i=t.Gasane;i.Fps=function(){function t(i){this._fps=i,this._started=!1,this._start=0,this._polling=0,this._boundUpdate=this.update.bind(this),this._event={type:t.ENTER_FRAME,scope:this}}var n=i.EventDispatcher,e=i.Cycle,r=Date.now;t.ENTER_FRAME="enterFrame";var s=t.prototype;return n.initialize(s),s.constructor=t,s.start=function(){return this._started||(this._started=!0,this.setFps(this._fps),e.on(e.UPDATE,this._boundUpdate),e.start()),this},s.stop=function(){return this._started&&(this._started=!1,e.off(e.UPDATE,this._boundUpdate)),this._polling=Number.MAX_VALUE,this},s.fps=function(){return this._fps},s.setFps=function(t){return this._start=this.now(),this._polling=1e3/t,this._fps=t,this},s.changeFps=function(t){return this.setFps(t),this},s.now=function(){return r()},s.update=function(){var t=this.now();t-this._start>=this._polling&&(this._start=t,this.dispatchEvent(this._event))},t}()}(window);/**
 * @module Sankaku
 * @license inazumatv.com
 * @author (at)taikiken / http://inazumatv.com
 * @date 2014/06/20 - 11:55
 *
 * Copyright (c) 2011-2015 inazumatv.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 *
 * delaunay
 * original: https://github.com/ironwallaby/delaunay
 *
 * canvas-toBlob.js
 * A canvas.toBlob() implementation.
 * 2011-07-13
 *
 * By Eli Grey, http://eligrey.com and Devin Samarin, https://github.com/eboyjr
 * License: X11/MIT
 *   See LICENSE.md
 * @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js
 *
 * FileSaver.js
 * A saveAs() FileSaver implementation.
 * 2014-05-27
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 * @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js
 *
 * @build 4/7/2015, 6:16:41 PM
 * @version 0.3.0
 * @host https://github.com/taikiken/sankaku.js
 *
 * @requires kaketsugi.js, gasane.js
 *
 *
 * @module Sankaku
 */
var Sankaku={}||{};Sankaku.version="0.3.0",Sankaku.build="4/7/2015, 6:16:41 PM",function(t){"use strict";var i=t.Sankaku;i.extend=function(t,i){i.prototype=Object.create(t.prototype),i.prototype.constructor=i},i.Gasane=t.Gasane,i.EventDispatcher=i.Gasane.EventDispatcher}(window),/*! canvas-toBlob.js
 * A canvas.toBlob() implementation.
 * 2011-07-13
 *
 * By Eli Grey, http://eligrey.com and Devin Samarin, https://github.com/eboyjr
 * License: X11/MIT
 *   See LICENSE.md
 */
/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */
function(t){"use strict";var i,n=t.Uint8Array,e=t.HTMLCanvasElement,r=/\s*;\s*base64\s*(?:;|$)/i,s=function(t){for(var e,r,s,o=t.length,a=new n(o/4*3|0),h=0,c=0,u=[0,0],l=0,f=0;o--;)r=t.charCodeAt(h++),e=i[r-43],255!==e&&e!==s&&(u[1]=u[0],u[0]=r,f=f<<6|e,l++,4===l&&(a[c++]=f>>>16,61!==u[1]&&(a[c++]=f>>>8),61!==u[0]&&(a[c++]=f),l=0));return a.buffer};n&&(i=new n([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),e&&!e.prototype.toBlob&&(e.prototype.toBlob=function(t,i){if(i||(i="image/png"),this.mozGetAsFile)return void t(this.mozGetAsFile("canvas",i));var e,o=Array.prototype.slice.call(arguments,1),a=this.toDataURL.apply(this,o),h=a.indexOf(","),c=a.substring(h+1),u=r.test(a.substring(0,h));Blob.fake?(e=new Blob,e.encoding=u?"base64":"URI",e.data=c,e.size=c.length):n&&(e=u?new Blob([new n(s(c))],{type:i}):new Blob([new n(decodeURIComponent(c))],{type:i})),t(e)})}(self),function(t){"use strict";var i=t.Sankaku;i.LoadImage=function(){function t(t){this._path=t,this._img=null,this._boundComplete=this.onComplete.bind(this),this._boundError=this.onError.bind(this)}t.COMPLETE="load_image_complete",t.ERROR="load_image_error";var n=t.prototype;return n.constructor=t,i.EventDispatcher.initialize(n),n.clone=function(){return new t(this._path)},n.load=function(){var t=new Image;this._img=t,t.addEventListener("load",this._boundComplete,!1),t.addEventListener("error",this._boundError,!1),t.src=this._path},n.dispose=function(){var t=this._img;t.removeEventListener("load",this._boundComplete),t.removeEventListener("error",this._boundError)},n.onComplete=function(){this.dispose(),this.dispatchEvent({type:t.COMPLETE,currentTarget:this,path:this._path,img:this._img})},n.onError=function(){this.dispose(),this.dispatchEvent({type:t.ERROR,currentTarget:this,path:this._path})},t}()}(window),/*! FileSaver.js
 * A saveAs() FileSaver implementation.
 * 2014-05-27
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
function(t){"use strict";function i(){}var n=t.Sankaku,e=e||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(i){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var n=i.document,e=function(){return i.URL||i.webkitURL||i},r=n.createElementNS("http://www.w3.org/1999/xhtml","a"),s=!i.externalHost&&"download"in r,o=function(t){var e=n.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,i,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(e)},a=i.webkitRequestFileSystem,h=i.requestFileSystem||a||i.mozRequestFileSystem,c=function(t){(i.setImmediate||i.setTimeout)(function(){throw t},0)},u="application/octet-stream",l=0,f=[],d=function(){for(var t=f.length;t--;){var i=f[t];"string"==typeof i?e().revokeObjectURL(i):i.remove()}f.length=0},_=function(t,i,n){i=[].concat(i);for(var e=i.length;e--;){var r=t["on"+i[e]];if("function"==typeof r)try{r.call(t,n||t)}catch(s){c(s)}}},p=function(n,c){var d,p,v,y=this,g=n.type,b=!1,w=function(){var t=e().createObjectURL(n);return f.push(t),t},m=function(){_(y,"writestart progress write writeend".split(" "))},x=function(){(b||!d)&&(d=w(n)),p?p.location.href=d:t.open(d,"_blank"),y.readyState=y.DONE,m()},k=function(t){return function(){return y.readyState!==y.DONE?t.apply(this,arguments):void 0}},E={create:!0,exclusive:!1};return y.readyState=y.INIT,c||(c="download"),s?(d=w(n),r.href=d,r.download=c,o(r),y.readyState=y.DONE,void m()):(i.chrome&&g&&g!==u&&(v=n.slice||n.webkitSlice,n=v.call(n,0,n.size,u),b=!0),a&&"download"!==c&&(c+=".download"),(g===u||a)&&(p=i),h?(l+=n.size,void h(i.TEMPORARY,l,k(function(t){t.root.getDirectory("saved",E,k(function(t){var i=function(){t.getFile(c,E,k(function(t){t.createWriter(k(function(i){i.onwriteend=function(i){p.location.href=t.toURL(),f.push(t),y.readyState=y.DONE,_(y,"writeend",i)},i.onerror=function(){var t=i.error;t.code!==t.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(t){i["on"+t]=y["on"+t]}),i.write(n),y.abort=function(){i.abort(),y.readyState=y.DONE},y.readyState=y.WRITING}),x)}),x)};t.getFile(c,{create:!1},k(function(t){t.remove(),i()}),k(function(t){t.code===t.NOT_FOUND_ERR?i():x()}))}),x)}),x)):void x())},v=p.prototype,y=function(t,i){return new p(t,i)};return v.abort=function(){var t=this;t.readyState=t.DONE,_(t,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,i.addEventListener("unload",d,!1),y.unload=function(){d(),i.removeEventListener("unload",d,!1)},y}}("undefined"!=typeof self&&self||"undefined"!=typeof t&&t||this.content);i.prototype.constructor=n.FileSave,i.saveAs=e,n.FileSave=i}(window),function(t){"use strict";var i=t.Sankaku;i.Iro=function(){function t(){throw new Error("Iro can't create instance")}var i=t;return i.rgb2hsl=function(t,i,n){t/=255,i/=255,n/=255;var e,r,s,o,a=Math.max(t,i,n),h=Math.min(t,i,n);if(s=(a+h)/2,a===h)e=r=0;else{switch(o=a-h,r=s>.5?o/(2-a-h):o/(a+h),a){case t:e=(i-n)/o+(n>i?6:0);break;case i:e=(n-t)/o+2;break;case n:e=(t-i)/o+4}e/=6}return{h:e,s:r,l:s}},i.hsl2rgb=function(t,i,n){function e(t,i,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(i-t)*n:.5>n?i:2/3>n?t+(i-t)*(2/3-n)*6:t}var r,s,o;if(0===i)r=s=o=n;else{var a=.5>n?n*(1+i):n+i-n*i,h=2*n-a;r=e(h,a,t+1/3),s=e(h,a,t),o=e(h,a,t-1/3)}return{r:255*r,g:255*s,b:255*o}},i.rgb2hsv=function(t,i,n){t/=255,i/=255,n/=255;var e,r,s=Math.max(t,i,n),o=Math.min(t,i,n),a=s,h=s-o;if(r=0===s?0:h/s,s===o)e=0;else{switch(s){case t:e=(i-n)/h+(n>i?6:0);break;case i:e=(n-t)/h+2;break;case n:e=(t-i)/h+4}e/=6}return{h:e,s:r,v:a}},i.hsv2rgb=function(t,i,n){var e,r,s,o=Math.floor(6*t),a=6*t-o,h=n*(1-i),c=n*(1-a*i),u=n*(1-(1-a)*i);switch(o%6){case 0:e=n,r=u,s=h;break;case 1:e=c,r=n,s=h;break;case 2:e=h,r=n,s=u;break;case 3:e=h,r=c,s=n;break;case 4:e=u,r=h,s=n;break;case 5:e=n,r=h,s=c}return{r:parseInt(255*e,10),g:parseInt(255*r,10),b:parseInt(255*s,10)}},i.hex2rgb=function(t){if("string"!=typeof t)return null;var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(i,function(t,i,n,e){return i+i+n+n+e+e});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},i.rgb2hex=function(t,i,n){function e(t){var i=t.toString(16);return 1===i.length?"0"+i:i}return"#"+e(t)+e(i)+e(n)},i.int2hex=function(t){t=Math.floor(t);var i=t.toString(16);if(i.length<6)for(var n=i.length,e=6-n;e;)i="0"+i,--e;return"#"+i},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.List=function(){function t(){throw new Error("List can't create instance")}var i=Math.random,n=Math.floor,e=Math.max,r=t;return r.word=function(t,i){var n,e=[];for(n=0;t>n;n++)e[n]=i;return e},r.zero=function(t){return this.word(t,0)},r.shuffle=function(t){for(var e,r=[],s=t.length;s;)e=n(i()*t.length),e in t&&(r.push(t[e]),delete t[e],--s);return r},r.max=function(t){return e.apply(null,t)},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Num=function(){function i(){throw new Error("Num can't create instance")}var n=t.parseFloat,e=Math.random,r=Math.floor,s=Math.PI,o=i;return o.ONE_DEG=s/180,o.ONE_RAD=180/s,o.FORTY_FIVE=s/4,o.NINETY=s/2,o.ONE_EIGHTY=s,o.THREE_SIXTY=2*s,o.is=function(t){return!isNaN(n(t))&&isFinite(t)},o.random=function(t,i){return o.is(i)||(i=t,t=0),t+r(e()*(i-t+1))},o.deg2rad=function(t){return t*o.ONE_DEG},o.rad2deg=function(t){return t*o.ONE_RAD},i}()}(window),function(t){"use strict";var i=t.Sankaku;i.Distribute=function(){function t(){throw new Error("Distribute can't create instance")}var i=Math.sqrt,n=Math.sin,e=Math.cos,r=Math.random,s=2*Math.PI,o=t;return o.circle=function(t,o,a){var h,c;return h=i(r())*t,c=r()*s,{x:.5*o+e(c)*h,y:.5*a+n(c)*h}},t}()}(window),function(t){"use strict";var i=t.Sankaku,n=t.Math;i.Vector2D=function(){function t(t,i){this.x=t||0,this.y=i||0}var i=n.floor,e=n.ceil,r=n.round,s=n.cos,o=n.sin,a=n.atan2,h=n.sqrt,c=n.min,u=n.acos,l=t.prototype;return l.constructor=t,l.draw=function(t){return t.beginPath(),t.moveTo(0,0),t.lineTo(this.x,this.y),t.closePath(),this},l.clone=function(){return new t(this.x,this.y)},l.zero=function(){return this.x=0,this.y=0,this},l.isZero=function(){return 0===this.x&&0===this.y},l.set=function(t,i){return this.x=t,this.y=i,this},l.setX=function(t){return this.x=t,this},l.setY=function(t){return this.y=t,this},l.copy=function(t){return this.x=t.x,this.y=t.y,this},l.add=function(t){return this.x+=t.x,this.y+=t.y,this},l.addScalar=function(t){return this.x+=t,this.y+=t,this},l.addNew=function(i){return new t(this.x+i.x,this.y+i.y)},l.addVector=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},l.sub=function(t){return this.x-=t.x,this.y-=t.y,this},l.subNew=function(i){return new t(this.x-i.x,this.y-i.y)},l.subVector=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},l.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},l.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},l.multiplyNew=function(i){return new t(this.x*i.x,this.y*i.y)},l.divide=function(t){return this.x/=t.x,this.y/=t.y,this},l.divideScalar=function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i}else this.x=0,this.y=0;return this},l.divideNew=function(i){return new t(this.x/i.x,this.y/i.y)},l.min=function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},l.max=function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},l.clamp=function(t,i){return this.min(t),this.max(i),this},l.clampScalar=function(i,n){var e,r;return e=new t,r=new t,e.set(i,i),r.set(n,n),this.clamp(e,r)},l.floor=function(){return this.x=i(this.x),this.y=i(this.y),this},l.ceil=function(){return this.x=e(this.x),this.y=e(this.y),this},l.round=function(){return this.x=r(this.x),this.y=r(this.y),this},l.roundToZero=function(){return this.x=this.x<0?e(this.x):i(this.x),this.y=this.y<0?e(this.y):i(this.y),this},l.negate=function(){return this.multiplyScalar(-1)},l.dot=function(t){return this.x*t.x+this.y*t.y},l.lengthSq=function(){return this.x*this.x+this.y*this.y},l.length=function(){return h(this.lengthSq())},l.setLength=function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},l.setAngle=function(t){var i=this.length();return i=i||.001,this.x=s(t)*i,this.y=o(t)*i,this},l.angle=function(){return a(this.y,this.x)},l.normalize=function(){return this.divideScalar(this.length())},l.distanceSq=function(t){var i=this.x-t.x,n=this.y-t.y;return i*i+n*n},l.distance=function(t){return h(this.distanceSq(t))},l.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},l.equals=function(t){return t.x===this.x&&t.y===this.y},l.fromArray=function(t){return this.x=t[0],this.y=t[1],this},l.toArray=function(){return[this.x,this.y]},l.truncate=function(t){var i=c(t,this.length());return this.setLength(i)},l.reverse=function(){return this.negate(),this},l.isNormalize=function(){return 1===this.length()},l.perpendicular=function(){return new t(-this.y,this.x)},l.sign=function(t){return this.perpendicular().dot(t)<0?-1:1},t.angleBetween=function(t,i){return t.isNormalize()||(t=t.clone().normalize()),i.isNormalize()||(i=i.clone().normalize()),u(t.dot(i))},t}()}(window),function(t){"use strict";var i=t.Math,n=t.Sankaku;n.Triangle=function(){function t(t,i,s){this.a=t,this.b=i,this.c=s;var o,a,h,c,u,l,f=i.x-t.x,d=i.y-t.y,_=s.x-t.x,p=s.y-t.y,v=f*(t.x+i.x)+d*(t.y+i.y),y=_*(t.x+s.x)+p*(t.y+s.y),g=2*(f*(s.y-i.y)-d*(s.x-i.x));n(g)<1e-6?(o=e(t.x,i.x,s.x),a=e(t.y,i.y,s.y),h=.5*(r(t.x,i.x,s.x)-o),c=.5*(r(t.y,i.y,s.y)-a),this.x=o+h,this.y=a+c,this.r=h*h+c*c):(u=(p*v-d*y)/g,l=(f*y-_*v)/g,h=u-t.x,c=l-t.y,this.x=u,this.y=l,this.r=h*h+c*c)}var n=i.abs,e=i.min,r=i.max,s=i.round,o=t.prototype;return o.constructor=t,o.draw=function(t){var i=this.a,n=this.b,e=this.c;t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(n.x,n.y),t.lineTo(e.x,e.y),t.closePath()},o.centroid=function(){return{x:s((this.a.x+this.b.x+this.c.x)/3),y:s((this.a.y+this.b.y+this.c.y)/3)}},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Delaunay=function(){function t(){throw new Error("Sankaku can't create instance.")}var n=i.Triangle,e=t;return e.triangulate=function(t){if(t.length<3)return[];var i,e,r,s,o,a,h,c,u,l,f,d,_,p,v,y,g,b,w,m=function(t,i){return i.x-t.x},x=function(t){var i,n,e,r,s,o=t.length;t:for(;o;)for(n=t[--o],i=t[--o],e=o;e;)if(s=t[--e],r=t[--e],i===r&&n===s||i===s&&n===r){t.splice(o,2),t.splice(e,2),o-=2;continue t}};for(t.sort(m),e=t.length-1,i=t[e],r=i.x,s=t[0].x,o=i.y,a=o;e--;)i.y<o&&(o=i.y),i.y>a&&(a=i.y);for(h=s-r,c=a-o,u=h>c?h:c,l=.5*(s+r),f=.5*(a+o),d=[new n({x:l-20*u,y:f-u,__sentinel:!0},{x:l,y:f+20*u,__sentinel:!0},{x:l+20*u,y:f-u,__sentinel:!0})],_=[],v=[],e=t.length;e--;){for(v.length=0,y=d.length,i=t[e];y--;)w=d[y],h=i.x-w.x,h>0&&h*h>w.r?(_.push(w),d.splice(y,1)):(c=i.y-w.y,h*h+c*c>w.r||(v.push(w.a,w.b,w.b,w.c,w.c,w.a),d.splice(y,1)));for(x(v),y=v.length;y;)b=v[--y],g=v[--y],d.push(new n(g,b,i))}for(Array.prototype.push.apply(_,d),e=_.length;e--;)p=_[e],(p.a.__sentinel||p.b.__sentinel||p.c.__sentinel)&&_.splice(e,1);return _},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Object2D=function(){function t(){this._position=new r,this.x=0,this.y=0,this.rotation=0,this.width=20,this.height=10,this.scale=1,this.scene=null,this.parent=null,this.children=[],this.visible=!0,this._alpha=1,this._mask=null}var n=Math.cos,e=Math.sin,r=i.Vector2D,s=i.Num,o=i.Iro,a=t.prototype;return a.constructor=t,i.EventDispatcher.initialize(a),a.clone=function(){return this._clone()},a._clone=function(){var i=new t;return i.setPosition(this._position.clone()),i.width=this.width,i.height=this.height,i.rotation=this.rotation,i.scale=this.scale,i.parent=parent&&parent.clone(),i._alpha=this._alpha,i.visible=this.visible,i.children=this.children.splice(),i.setColor(this._color),i.setMask(this.mask().clone()),i},a.setColor=function(t){var i;return this._color=t,i=o.hex2rgb(t),i&&(i.a=this._alpha,this._rgb=i),this},a.setRGB=function(t){var i=this._rgb;return i.r=t.r,i.g=t.g,i.b=t.b,this._color=o.rgb2hex(t.r,t.g,t.b),this},a.rgba=function(){return this._rgb},a.setAlpha=function(t){return this._alpha=t,this.setColor(this._color)},a.alpha=function(){return this._alpha},a.setPosition=function(t){return this._position=t,this.x=t.x,this.y=t.y,this},a.position=function(){return this._position},a.setX=function(t){return this.x=t,this._position.x=t,this},a.setY=function(t){return this.y=t,this._position.y=t,this},a.setRotate=function(t){return this.rotation=s.deg2rad(t),this},a.rotate=function(){return s.rad2deg(this.rotation)},a.radian=function(){return this.rotation},a.setMask=function(t){return t.parent=this,t.maskMode=!0,this._mask=t,this.add(t),this},a.removeMask=function(){var t=this._mask;return t.parent=null,t.maskMode=!1,this._mask=null,this},a.mask=function(){return this._mask},a.bounding=function(){var t,i,r,s,o,a,h,c,u,l,f,d,_,p,v,y,g,b,w,m,x,k,E,S=this.parent,T=this.x,A=this.y,R=this.width*this.scale,O=this.height*this.scale,D=.5*R,L=.5*O,M=this.rotation;return o={scale:this.scale,rotation:this.rotation,alpha:this._alpha,visible:this.visible,x:this.x,y:this.y},S&&this.scene!==S&&(E=S.bounding(),o.visible=E.e.visible,o.visible&&(T*=E.e.scale,A*=E.e.scale,R=this.width*E.e.scale,O=this.height*E.e.scale,D=.5*R,L=.5*O,M=E.e.rotation+this.rotation,d=S.x+T*n(E.e.rotation)-A*e(E.e.rotation),_=S.y+T*e(E.e.rotation)+A*n(E.e.rotation),T=d,A=_,o.scale=E.e.scale*this.scale,o.alpha=E.e.alpha*this._alpha,o.rotation=M)),l=e(M),f=n(M),a=-D,h=-L,c=D,u=L,p=f*a,v=f*h,y=l*h,g=l*a,b=f*c,w=f*u,m=l*c,x=l*u,t={x:p-y+T,y:v+g+A},i={x:b-y+T,y:v+m+A},r={x:b-x+T,y:w+m+A},s={x:p-x+T,y:w+g+A},o.x=T,o.y=A,k={a:t,b:i,c:r,d:s,e:o},this._bounding=k,k},a.add=function(t){if(t===this)return this;t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);var i=this.scene;return i&&i.addChild(t),this},a.remove=function(t){var i,n;return i=this.children.indexOf(t),-1===i?this:(t.parent=null,this.children.splice(i,1),n=this.scene,n&&n.removeChild(t),this)},a.draw=function(t){this.visible&&0!==this._alpha&&0!==this.scale&&(!this._mask||this._mask&&this._mask.ready)&&(this.beginDraw(t),this._draw(t),this.exitDraw(t));var i,n,e=this.children;for(i=0,n=e.length;n>i;i++)e[i].draw(t);return this},a._draw=function(){},a.beginDraw=function(){},a.exitDraw=function(){},a.inside=function(t,i){this.visible&&(i=this._inside(t,i));var n,e,r=this.children;for(n=0,e=r.length;e>n;n++)i=r[n].inside(t,i);return i},a._area=function(t,i,n){return n.x*i.y-i.x*n.y-(n.x*t.y-t.x*n.y)+(i.x*t.y-t.x*i.y)},a._inside=function(t,i){var n=this.bounding();return this._area(n.a,n.b,t)>0||this._area(n.b,n.c,t)>0||this._area(n.c,n.d,t)>0||this._area(n.d,n.a,t)>0?i:(i.push(this),i)},a.swap=function(t,i){var n=this.children,e=n.indexOf(t),r=n.indexOf(i);return-1!==e&&-1!==r&&(n[r]=t,n[e]=i),this},a.highest=function(t){var i=this.children,n=i.indexOf(t);return-1!==n&&(i.splice(n,1),i.push(t)),this},a.render=function(t,i){this.beginRender(t,i);var n,e,r=this.children;for(n=0,e=r.length;e>n;n++)r[n].render(t,i);return this},a.beginRender=function(t,i){this.prepareRender(t,i)},a.prepareRender=function(){},a._rgba=function(t,i){var n=t;return{r:n.r,g:n.g,b:n.b,a:n.a*i}},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Scene=function(){function t(){n.call(this),this.scene=this}var n=i.Object2D;i.extend(n,t);var e=t.prototype;return e.constructor=t,e.addChild=function(t){t.scene=this},e.removeChild=function(t){t.scene=null},e.inside=function(t,i){var n,e,r=this.children;for(n=0,e=r.length;e>n;n++)i=r[n].inside(t,i);return i},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Shape=function(){function t(i,e,r,s,o,a){n.call(this),this.setX(i),this.setY(e),this.width=r||20,this.height=s||10,this._fill=a||t.STROKE,this._line=1,this._rgb={r:0,g:0,b:0},o=o||"#000000",this._color=o,this.setColor(o),this.setBorder(this.setLine,this._color)}var n=i.Object2D,e=i.Vector2D,r=i.Iro;i.extend(n,t),t.FILL="shape_fill",t.STROKE="shape_stroke",t.BOTH="shape_both";var s=t.prototype;return s.constructor=t,s.clone=function(){var i=new t(this.x,this.y,this.width,this.height,this._color,this._fill);return i.rotation=this.rotation,i.scale=this.scale,i.visible=this.visible,i._alpha=this._alpha,i._rgb=Object.create(this._rgb),i._line=this._line,i._border={setLine:this._border.setLine,rgb:this._border.rgb},this._mask&&i.setMask(this.mask().clone()),i},s.radius=function(){var t=this.bounding(),i=t.a,n=t.c;return.5*new e(i.x,i.y).distance(new e(n.x,n.y))},s.setBorder=function(t,i){var n=r.hex2rgb(i);return n&&(n.a=this._alpha,this._border={setLine:t,rgb:n}),this},s.setMode=function(t){return this._fill=t,this},s.mode=function(){return this._fill},s.setLine=function(t){return this._line=t,this},s.line=function(){return this._line},s._draw=function(i){var n,e,r=this.paint(i),s=r.e;if(s.visible&&0!==s.alpha&&0!==s.scale)switch(n=this._rgba(this._rgb,r.e.alpha),this._fill){case t.STROKE:this.stroke(i,this._line,n);break;case t.FILL:this.fill(i,n);break;case t.BOTH:e=this._rgba(this._border._rgb,r.e.alpha),this.stroke(i,this._border._line,e),this.fill(i,n)}},s.fill=function(t,i){t.fillStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",t.fill()},s.stroke=function(t,i,n){t.lineWidth=i,t.strokeStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",t.stroke()},s.paint=function(t){var i=this.bounding(),n=i.a,e=i.b,r=i.c,s=i.d;return i.e.visible&&(t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(e.x,e.y),t.lineTo(r.x,r.y),t.lineTo(s.x,s.y),t.lineTo(n.x,n.y),t.closePath()),i},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Circle=function(){function t(t,i,n,e,s){r.call(this,t,i,2*n,2*n,e,s),this._radius=n||this.width}var n=2*Math.PI,e=Math.pow,r=i.Shape,s=i.Vector2D;i.extend(r,t);var o=t.prototype;return o.constructor=t,o.radius=function(){return this._radius*this.scale},o.clone=function(){var i=new t(this.x,this.y,this._radius,this._color,this._fill);return i.rotation=this.rotation,i.scale=this.scale,i.visible=this.visible,i._alpha=this._alpha,i._rgb=Object.create(this._rgb),i._line=this._line,i._border={line:this._border.line,rgb:this._border.rgb},i},o.paint=function(t){var i=this.bounding(),e=i.e;return e.visible&&(t.beginPath(),t.arc(e.x,e.y,this._radius*e.scale,0,n,!1),t.closePath()),i},o._inside=function(t,i){var n=this._radius;return e(this.x-t.x,2)+e(this.y-t.y,2)<n*n&&i.push(this),i},o.contain=function(t){var i=[];return this._inside(t,i),i.length>0},o.intersect=function(t){var i,n,e,r,o,a,h,c,u,l,f,d,_,p,v,y,g=t.segment(),b=g.start,w=g.end;return i=b.bounding().e,n=w.bounding().e,e=new s(i.x,i.y),r=new s(n.x,n.y),this.contain(e)?!0:this.contain(r)?!0:(o=this.radius(),a=this.bounding(),h=a.e,d=h.x-o,_=h.x+o,p=h.y-o,v=h.y+o,i.x<d&&n.x<d||i.x>_&&n.x>_?!1:i.y<p&&n.y<p||i.y>v&&n.y>v?!1:(y=new s(h.x,h.y),c=e.distance(y),u=r.distance(y),l=e.distance(r),f=Math.sqrt((l+u+c)*(l-u+c)*(-l+u+c)*(l+u-c)/(4*l*l)),o>=f))},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Tripod=function(){function t(t,i,e,r,s,o){n.call(this,t,i,e,r,s,o)}var n=i.Shape;i.extend(n,t);var e=t.prototype;return e.constructor=t,e.clone=function(){var i=new t(this.x,this.y,this.width,this.height,this._color,this._fill);return i.rotation=this.rotation,i.scale=this.scale,i.visible=this.visible,i._alpha=this._alpha,i._rgb=Object.create(this._rgb),i._line=this._line,i._border={line:this._border.line,rgb:this._border.rgb},i},e.paint=function(t){var i=this.bounding(),n=i.a,e=i.b,r=i.c,s=i.d;return i.e.visible&&(t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(.5*(e.x+r.x),.5*(e.y+r.y)),t.lineTo(s.x,s.y),t.lineTo(n.x,n.y),t.closePath()),i},e._inside=function(t,i){var n=this.bounding(),e=n.b,r=n.c,s={x:.5*(e.x+r.x),y:.5*(e.y+r.y)};return this._area(n.a,s,t)>0||this._area(s,n.d,t)>0||this._area(n.d,n.a,t)>0?i:(i.push(this),i)},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Star=function(){function t(t,i,n,e,s,o,a){r.call(this,t,i,n,n,e,s),this._radius=n||this.width,this._points=o||5,this._inner=a||.475*n}var n=Math.sin,e=Math.cos,r=i.Shape,s=i.Num;i.extend(r,t);var o=t.prototype;return o.constructor=t,o.radius=function(){return this._radius},o.clone=function(){var i=new t(this.x,this.y,this._radius,this._color,this._fill,this._points);return i.rotation=this.rotation,i.scale=this.scale,i.visible=this.visible,i._alpha=this._alpha,i._rgb=Object.create(this._rgb),i._line=this._line,i._border={line:this._border.line,rgb:this._border.rgb},i},o.paint=function(t){var i,r,o,a,h,c,u,l,f,d,_,p,v,y=this.bounding(),g=y.e;if(g.visible){for(i=this._points,r=2*i,o=s.ONE_EIGHTY/i,a=s.NINETY,h=g.scale,c=this._radius*h,u=this._inner*h,l=g.x,f=g.y,d=g.rotation,t.beginPath(),_=0;r>=_;++_)p=_*o-a+d,v=_%2?u:c,t.lineTo(l+v*e(p),f+v*n(p));t.closePath()}return y},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Line=function(){function t(t,i,r,s){n.call(this),this._v1=t,this._v2=i,this._fill=e.STROKE,s=s||1,this._line=s,this._rgb={r:0,g:0,b:0},r=r||"#000000",this._color=r,this.setColor(r)}var n=i.Object2D,e=i.Shape;i.extend(n,t);var r=t.prototype;return r.constructor=t,r._clone=function(){var i=new t(this._v1,this._v2,this._color,this._line);return i.setAlpha(this._alpha),i.scale=this.scale,i.visible=this.visible,i.setColor(this._color),i},r.segment=function(){return{start:this._v1,end:this._v2}},r.setPosition=function(){return this},r.setX=function(){return this},r.setY=function(){return this},r.setRotate=function(){return this},r.add=function(){return this},r.remove=function(){return this},r.bounding=function(){var t,i,n=this.parent;return i={scale:this.scale,rotation:this.rotation,alpha:this._alpha,x:this.x,y:this.y},n&&this.scene!==n&&(i.scale=n.scale*this.scale,i.alpha=n.alpha()*this._alpha),t={e:i,a:this._v1.bounding().e,b:this._v2.bounding().e},this._bounding=t,t},r._inside=function(t,i){return i},r._draw=function(t){var i=this.paint(t),n=this._rgba(this._rgb,i.e.alpha);this.stroke(t,this._line,n)},r.stroke=function(t,i,n){t.lineWidth=i,t.strokeStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",t.stroke()},r.paint=function(t){var i=this._v1,n=i.bounding(),e=n.e,r=this._v2,s=r.bounding(),o=s.e,a=this.bounding();return t.beginPath(),t.lineTo(e.x,e.y),t.lineTo(o.x,o.y),t.closePath(),a},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Bitmap=function(){function t(t,r,s,o,a){n.call(this,t,r,s,o);var h=this.onLoad.bind(this),c=this.onError.bind(this);this._boundLoad=h,this._boundError=c,this._fill=n.FILL,this._img=a,this._bitmap=null,this.ready=!1,a.constructor===i.LoadImage?(a.addEventListener(e.COMPLETE,h),a.addEventListener(e.ERROR,c),a.load()):a.constructor===Image&&(this._bitmap=a)}var n=i.Shape,e=i.LoadImage;i.extend(n,t);var r=t.prototype;return r.constructor=t,r.dispose=function(){var t=this._img;t.removeEventListener(e.COMPLETE,this._boundLoad),t.removeEventListener(e.ERROR,this._boundError)},r.onLoad=function(t){this.dispose(),this._bitmap=t.img},r.onError=function(){this.dispose()},r.clone=function(){var n,e,r=this._img;return r.constructor===i.LoadImage?n=r.clone():(n=new Image,n.src=r.src),e=new t(this.x,this.y,this.width,this.height,n),e.rotation=this.rotation,e.scale=this.scale,e.visible=this.visible,e._alpha=this._alpha,e},r.setMode=function(){},r._draw=function(t){if(this._bitmap){var i=this.bounding(),n=i.e;this.ready=!0,n.visible&&n.alpha>0&&n.scale>0&&this.fill(t,i,this._bitmap)}},r.fill=function(t,i,n){var e,r,s,o,a=i.e,h=a.alpha,c=a.rotation,u=a.scale,l=!1;e=this.width*u,r=this.height*u,s=a.x-.5*e,o=a.y-.5*r,(this.maskMode||1>h||0!==c)&&(t.save(),l=!0,1>h&&(t.globalAlpha=h),0!==c&&(t.setTransform(1,0,0,1,0,0),t.translate(a.x,a.y),t.rotate(c),s=.5*-e,o=.5*-r),this.maskMode&&(t.globalCompositeOperation="destination-in")),t.drawImage(n,0,0,n.width,n.height,s,o,e,r),l&&t.restore()},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Vehicle=function(){function t(i){r.call(this),this._velocity=new e,this._mass=1,this._speed=10,this._behavior=t.BOUNCE,this.left=0,this.top=0,this.right=0,this.bottom=0,this.maskMode=!1,this.setView(i||new s(this.x,this.y,this.width,this.height))}var n=Math.abs,e=i.Vector2D,r=i.Object2D,s=i.Tripod;i.extend(r,t),t.WRAP="vehicle_wrap",t.BOUNCE="vehicle_bounce";var o=t.prototype;return o.constructor=t,i.EventDispatcher.initialize(o),o.setView=function(t){t.setPosition(this._position),this.width=t.width,this.height=t.height,this.rotation=t.rotation,this.alpha=t.alpha,this.scale=t.scale,this._view=t},o.view=function(){return this._view},o.clone=function(){var i=new t(this._view.clone());return i.setPosition(this._position.clone()),i.width=this.width,i.height=this.height,i.rotation=this.rotation,i.scale=this.scale,i._velocity=this._velocity.clone(),i._mass=this._mass,i._speed=this._speed,i._behavior=this._behavior,i},o.setPadding=function(t,i,n,e){return i=i||t,n=n||t,e=e||t,this.top=t,this.right=i,this.bottom=n,this.left=e,this},o.setMass=function(t){return this._mass=t,this},o.mass=function(){return this._mass},o.setSpeed=function(t){return this._speed=t,this},o.speed=function(){return this._speed},o.setBehavior=function(t){return this._behavior=t,this},o.behavior=function(){return this._behavior},o.setVelocity=function(t){return this._velocity=t,this},o.velocity=function(){return this._velocity},o.draw=function(t){this.visible&&this._alpha>0&&this.scale>0&&this._view.draw(t)},o.update=function(t,i){this._update(t,i)},o._update=function(i,e){var r=this._velocity,s=this._position,o=this._view;switch(i-=this.right,e-=this.bottom,r.truncate(n(this._speed)),s.add(r),this._behavior){case t.WRAP:this.wrap(i,e);break;default:this.bounce(i,e)}this.x=s.x,this.y=s.y,this.rotation=r.angle(),o.x=s.x,o.y=s.y,o.rotation=r.angle(),o.width=this.width,o.height=this.height},o.wrap=function(t,i){var n=this._position,e=!1,r=this.left,s=this.top;n.x>t&&(n.x=r,e=!0),n.x<r&&(n.x=t,e=!0),n.y>i&&(n.y=s,e=!0),n.y<s&&(n.y=i,e=!0),e&&this.dispatchEvent({type:"wrap",currentTarget:this})},o.bounce=function(t,i){var n=this._velocity,e=this._position,r=!1,s=this.left,o=this.top;e.x>t?(e.x=t,n.x*=-1,r=!0):e.x<s&&(e.x=s,n.x*=-1,r=!0),e.y>i?(e.y=i,n.y*=-1,r=!0):e.y<o&&(e.y=o,n.y*=-1,r=!0),r&&this.dispatchEvent({type:"bounce",currentTarget:this})},o.beginRender=function(t,i){this.prepareRender(),this.update(t,i)},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.SteeredVehicle=function(){function t(t){e.call(this,t),this._force=new r,this._force_max=1,this._force_arrival=100,this._avoid_distance=300,this._avoid_buffer=20,this._avoid_insight=200,this._avoid_close=60}var n=.5*Math.PI,e=i.Vehicle,r=i.Vector2D;i.extend(e,t);var s=t.prototype;return s.constructor=t,s.clone=function(){var t=Object.create(this);return t.setView(this._view.clone()),t._force=this._force.clone(),t.setPosition(this._position.clone()),t},s.max=function(){return this._force_max},s.setMax=function(t){return this._force_max=t,this},s.arrival=function(){return this._force_arrival},s.setArrival=function(t){return this._force_arrival=t,this},s.setForce=function(t){return this._force=t,this},s.force=function(){return this._force},s.setBuffer=function(t){return this._avoid_buffer=t,this},s.buffer=function(){return this._avoid_buffer},s.setInsight=function(t){return this._avoid_insight=t,this},s.insight=function(){return this._avoid_insight},s.setClose=function(t){return this._avoid_close=t,this},s.close=function(){return this._avoid_close},s.setAvoidDistance=function(t){return this._avoid_distance=t,this},s.avoidDistance=function(){return this._avoid_distance},s.update=function(t,i){this._force.truncate(this._force_max).divideScalar(this._mass),this._velocity.add(this._force),this._force=new r,this._update(t,i)},s.seek=function(t){var i=t.subNew(this._position);i.normalize().multiplyScalar(this._speed).sub(this._velocity),this._force.add(i)},s.flee=function(t){var i=t.subNew(this._position);i.normalize().multiplyScalar(this._speed).sub(this._velocity),this._force.sub(i)},s.arrive=function(t){var i,n=t.subNew(this._position),e=this._force_arrival;n.normalize(),i=this._position.distance(t),n.multiplyScalar(i>e?this._speed:this._speed*i/e),n.sub(this._velocity),this._force.add(n)},s.pursue=function(t){var i=this._position.distance(t.position()),n=t.position().clone();n.add(t._velocity.multiplyNew(i)),this.seek(n)},s.evade=function(t){var i=this._position.distance(t.position())/this._speed,n=t.position().clone();n.sub(t._velocity.multiplyNew(i)),this.flee(n)},s.avoid=function(t){var i,e,r,s,o,a,h,c,u,l,f;for(l=0,f=t.length;f>l;l++)i=t[l],e=this._velocity.clone().normalize(),r=i.position().subNew(this._position),s=r.dot(e),s>0&&(a=e.clone(),a.multiplyScalar(this._avoid_distance),h=e.clone(),h.multiplyScalar(s),o=h.subNew(r).length(),o<i.radius()+this._avoid_buffer&&h.length()<a.length()&&(c=e.clone(),c.multiplyScalar(this._speed),c.setAngle(c.angle()+r.sign(this._velocity)*n),u=h.length()/a.length(),c.multiplyScalar(1-u),this._force.add(c),this._velocity.multiplyScalar(u)))},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Wander=function(){function t(t){e.call(this,t),this._wander_angle=0,this._wander_distance=10,this._wnder_radius=5,this._wander_range=1,this._wander_range2=.5*this._wander_range}var n=Math.random,e=i.SteeredVehicle,r=i.Vector2D;i.extend(e,t);var s=t.prototype;return s.constructor=t,s.clone=function(){var t=Object.create(this);return t.setView(this._view.clone()),t},s.setWanderAngle=function(t){return this._wander_angle=t,this},s.wanderAngle=function(){return this._wander_angle},s.setWanderDistance=function(t){return this._wander_distance=t,this},s.wanderDistance=function(){return this._wander_distance},s.setWanderRadius=function(t){return this._wnder_radius=t,this},s.wanderRadius=function(){return this._wnder_radius},s.setWanderRange=function(t){return this._wander_range=t,this._wander_range2=.5*t,this},s.wanderRange=function(){return this._wander_range},s.wander=function(){var t=this._velocity.clone().normalize().multiplyScalar(this._wander_distance),i=new r;i.setLength(this._wnder_radius),i.setAngle(this._wander_angle),this._wander_angle+=n()*this._wander_range-this._wander_range2,t.add(i),this._force.add(t)},s.beginRender=function(t,i){this.prepareRender(),this.wander(this._paths,this._loop),this.update(t,i)},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Flock=function(){function t(t){n.call(this,t),this._flock_flockInsight=200,this._flock_flockClose=60}var n=i.SteeredVehicle,e=i.Vector2D;i.extend(n,t);var r=t.prototype;return r.constructor=t,r.clone=function(){var t=Object.create(this);return t.setView(this._view.clone()),t.position(this._position.clone()),t._velocity=this._velocity.clone(),t._force=this._force.clone(),t},r.setFlockInsight=function(t){return this._flock_flockInsight=t,this},r.flockInsight=function(){return this._flock_flockInsight},r.setFlockClose=function(t){return this._flock_flockClose=t,this},r.flockClose=function(){return this._flock_flockClose},r.flock=function(t){var i,n,r,s=this._velocity.clone(),o=new e,a=0;for(n=0,r=t.length;r>n;n++)i=t[n],i!==this&&this.tooInsight(i)&&(s.add(i.velocity()),o.add(i.position()),this.tooClose(i)&&this.flee(i.position()),++a);a>0&&(s.divideScalar(a),o.divideScalar(a),this.seek(o),this._force.add(s.sub(this._velocity)))},r.tooInsight=function(t){var i,n,e;return this._position.distance(t._position)>this._flock_flockInsight?!1:(i=this._velocity.clone().normalize(),n=t._position.subNew(this._position),e=n.dot(i),0>e)},r.tooClose=function(t){return this._position.distance(t._position)<this._flock_flockClose},r.setFlocks=function(t){return this._flocks=t,this},r.beginRender=function(t,i){this.prepareRender(),this.flock(this._flocks),this.update(t,i)},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.FollowPath=function(){function t(t){n.call(this,t),this._index=0,this._threshold=20}var n=i.SteeredVehicle;i.extend(n,t);var e=t.prototype;return e.constructor=t,e.clone=function(){var t=Object.create(this);return t.setView(this._view.clone()),t.position(this._position.clone()),t._velocity=this._velocity.clone(),t._force=this._force.clone(),t},e.follow=function(t,i){i=!!i;
var n,e=t[this._index];e&&(n=t.length-1,this._position.distance(e)<this._threshold&&(this._index>=n?i&&(this._index=0):this._index++),this._index>=n&&!i?this.arrive(e):this.seek(e))},e.setPath=function(t){return this._paths=t,this},e.setLoop=function(t){return this._loop=t,this},e.beginRender=function(t,i){this.prepareRender(),this.follow(this._paths,this._loop),this.update(t,i)},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Zanzo=function(){function t(t){this._limit=t,this._objects=[]}var i=t.prototype;return i.constructor=t,i.setLimit=function(t){this._limit=t},i.add=function(t){var i,n,e,r=this._objects,s=[];for(this._limit>0&&r.length>=this._limit&&r.shift(),n=0,e=t.length;e>n;n++)i=t[n],s.push(i.clone());this._objects.push(s)},i.draw=function(t,i){var n,e,r,s,o,a,h,c,u=this._objects;for(a=u.length,r=1/(a+1),t.save(),o=0;a>o;o++)for(n=u[o],s=r*(o+1),t.globalAlpha=s,h=0,c=n.length;c>h;h++)e=n[h],e.draw(t),i&&i.call(t);t.restore()},i.length=function(){return this._objects.length},i.clear=function(){return this._objects=[],this},t}()}(window),function(t){"use strict";var i=t.Sankaku;i.Inside=function(){function t(t){this._scene=t,this._contains=[]}var i=t.prototype;return i.constructor=t,i.check=function(t){var i=this._contains;return i.length=0,i=this._scene.inside(t,i),i.reverse()},t}()}(window);